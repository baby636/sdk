
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>API Reference</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>

    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">

    <script src="javascripts/bsv.browser.min.js"></script>
    <script src="javascripts/run.browser.min.js"></script>

    <style>
      .emoji {
        width: 14px
      }
    </style>
  </head>

  <body class="index" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#getting-started" class="toc-h1 toc-link" data-title="Getting Started">Getting Started</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#getting-started-installation" class="toc-h2 toc-link" data-title="Installation">Installation</a>
                  </li>
                  <li>
                    <a href="#getting-started-setup" class="toc-h2 toc-link" data-title="Setup">Setup</a>
                  </li>
                  <li>
                    <a href="#getting-started-creating-jigs" class="toc-h2 toc-link" data-title="Creating Jigs">Creating Jigs</a>
                  </li>
                  <li>
                    <a href="#getting-started-loading-jigs" class="toc-h2 toc-link" data-title="Loading Jigs">Loading Jigs</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#jigs" class="toc-h1 toc-link" data-title="Jigs">Jigs</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#jigs-creating" class="toc-h2 toc-link" data-title="Creating">Creating</a>
                  </li>
                  <li>
                    <a href="#jigs-updating" class="toc-h2 toc-link" data-title="Updating">Updating</a>
                  </li>
                  <li>
                    <a href="#jigs-sending" class="toc-h2 toc-link" data-title="Sending">Sending</a>
                  </li>
                  <li>
                    <a href="#jigs-syncing" class="toc-h2 toc-link" data-title="Syncing">Syncing</a>
                  </li>
                  <li>
                    <a href="#jigs-interactivity" class="toc-h2 toc-link" data-title="Interactivity">Interactivity</a>
                  </li>
                  <li>
                    <a href="#jigs-destroying" class="toc-h2 toc-link" data-title="Destroying">Destroying</a>
                  </li>
                  <li>
                    <a href="#jigs-backing" class="toc-h2 toc-link" data-title="Backing">Backing</a>
                  </li>
                  <li>
                    <a href="#jigs-checking-parameters" class="toc-h2 toc-link" data-title="Checking Parameters">Checking Parameters</a>
                  </li>
                  <li>
                    <a href="#jigs-adding-an-icon" class="toc-h2 toc-link" data-title="Adding an Icon">Adding an Icon</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#code" class="toc-h1 toc-link" data-title="Code">Code</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#code-deploying" class="toc-h2 toc-link" data-title="Deploying">Deploying</a>
                  </li>
                  <li>
                    <a href="#code-loading" class="toc-h2 toc-link" data-title="Loading">Loading</a>
                  </li>
                  <li>
                    <a href="#code-extending" class="toc-h2 toc-link" data-title="Extending">Extending</a>
                  </li>
                  <li>
                    <a href="#code-syncing" class="toc-h2 toc-link" data-title="Syncing">Syncing</a>
                  </li>
                  <li>
                    <a href="#code-updating" class="toc-h2 toc-link" data-title="Updating">Updating</a>
                  </li>
                  <li>
                    <a href="#code-upgrading" class="toc-h2 toc-link" data-title="Upgrading">Upgrading</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#tokens" class="toc-h1 toc-link" data-title="Tokens">Tokens</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#tokens-defining" class="toc-h2 toc-link" data-title="Defining">Defining</a>
                  </li>
                  <li>
                    <a href="#tokens-minting" class="toc-h2 toc-link" data-title="Minting">Minting</a>
                  </li>
                  <li>
                    <a href="#tokens-sending" class="toc-h2 toc-link" data-title="Sending">Sending</a>
                  </li>
                  <li>
                    <a href="#tokens-combining" class="toc-h2 toc-link" data-title="Combining">Combining</a>
                  </li>
                  <li>
                    <a href="#tokens-redeeming" class="toc-h2 toc-link" data-title="Redeeming">Redeeming</a>
                  </li>
                  <li>
                    <a href="#tokens-blacklisting" class="toc-h2 toc-link" data-title="Blacklisting">Blacklisting</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#advanced-usage" class="toc-h1 toc-link" data-title="Advanced Usage">Advanced Usage</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#advanced-usage-standard-metadata" class="toc-h2 toc-link" data-title="Standard Metadata">Standard Metadata</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-batch-transactions" class="toc-h2 toc-link" data-title="Batch Transactions">Batch Transactions</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-caller-variable" class="toc-h2 toc-link" data-title="Caller Variable">Caller Variable</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-private-properties" class="toc-h2 toc-link" data-title="Private Properties">Private Properties</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-auth-method" class="toc-h2 toc-link" data-title="Auth Method">Auth Method</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-code-presets" class="toc-h2 toc-link" data-title="Code Presets">Code Presets</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-berries" class="toc-h2 toc-link" data-title="Berries">Berries</a>
                  </li>
                  <li>
                    <a href="#advanced-usage-locks" class="toc-h2 toc-link" data-title="Locks">Locks</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#tips-and-tricks" class="toc-h1 toc-link" data-title="Tips and Tricks">Tips and Tricks</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#tips-and-tricks-limiting-supply" class="toc-h2 toc-link" data-title="Limiting Supply">Limiting Supply</a>
                  </li>
                  <li>
                    <a href="#tips-and-tricks-dynamic-whitelists" class="toc-h2 toc-link" data-title="Dynamic Whitelists">Dynamic Whitelists</a>
                  </li>
                  <li>
                    <a href="#tips-and-tricks-atomic-swaps" class="toc-h2 toc-link" data-title="Atomic Swaps">Atomic Swaps</a>
                  </li>
                  <li>
                    <a href="#tips-and-tricks-using-run-on-a-server" class="toc-h2 toc-link" data-title="Using Run on a Server">Using Run on a Server</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#tips-and-tricks-using-run-on-a-server-increase-cache-limits" class="toc-h3 toc-link" data-title="Increase Cache Limits">Increase Cache Limits</a>
                          </li>
                          <li>
                            <a href="#tips-and-tricks-using-run-on-a-server-persist-the-cache" class="toc-h3 toc-link" data-title="Persist the Cache">Persist the Cache</a>
                          </li>
                          <li>
                            <a href="#tips-and-tricks-using-run-on-a-server-avoid-race-conditions" class="toc-h3 toc-link" data-title="Avoid Race Conditions">Avoid Race Conditions</a>
                          </li>
                          <li>
                            <a href="#tips-and-tricks-using-run-on-a-server-load-only-safe-code" class="toc-h3 toc-link" data-title="Load Only Safe Code">Load Only Safe Code</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#tips-and-tricks-debugging" class="toc-h2 toc-link" data-title="Debugging">Debugging</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#tips-and-tricks-debugging-writing-unit-tests" class="toc-h3 toc-link" data-title="Writing Unit Tests">Writing Unit Tests</a>
                          </li>
                          <li>
                            <a href="#tips-and-tricks-debugging-too-long-mempool-chain" class="toc-h3 toc-link" data-title="too-long-mempool-chain">too-long-mempool-chain</a>
                          </li>
                          <li>
                            <a href="#tips-and-tricks-debugging-getting-help" class="toc-h3 toc-link" data-title="Getting Help">Getting Help</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#how-it-works" class="toc-h1 toc-link" data-title="How It Works">How It Works</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#how-it-works-overview" class="toc-h2 toc-link" data-title="Overview">Overview</a>
                  </li>
                  <li>
                    <a href="#how-it-works-transaction" class="toc-h2 toc-link" data-title="Transaction">Transaction</a>
                  </li>
                  <li>
                    <a href="#how-it-works-json-payload" class="toc-h2 toc-link" data-title="JSON Payload">JSON Payload</a>
                  </li>
                  <li>
                    <a href="#how-it-works-serialization" class="toc-h2 toc-link" data-title="Serialization">Serialization</a>
                  </li>
                  <li>
                    <a href="#how-it-works-sandboxing" class="toc-h2 toc-link" data-title="Sandboxing">Sandboxing</a>
                  </li>
                  <li>
                    <a href="#how-it-works-safety-checks" class="toc-h2 toc-link" data-title="Safety Checks">Safety Checks</a>
                  </li>
                  <li>
                    <a href="#how-it-works-ownership-rules" class="toc-h2 toc-link" data-title="Ownership Rules">Ownership Rules</a>
                  </li>
                  <li>
                    <a href="#how-it-works-privacy" class="toc-h2 toc-link" data-title="Privacy">Privacy</a>
                  </li>
                  <li>
                    <a href="#how-it-works-backwards-compatibility" class="toc-h2 toc-link" data-title="Backwards Compatibility">Backwards Compatibility</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#api-reference" class="toc-h1 toc-link" data-title="API Reference">API Reference</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#api-reference-run" class="toc-h2 toc-link" data-title="Run">Run</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-run-constructor-options" class="toc-h3 toc-link" data-title="constructor(options)">constructor(options)</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-activate" class="toc-h3 toc-link" data-title="activate()">activate()</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-deploy-code" class="toc-h3 toc-link" data-title="deploy(code)">deploy(code)</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-import-rawtx-options" class="toc-h3 toc-link" data-title="import(rawtx, options)">import(rawtx, options)</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-load-location-options" class="toc-h3 toc-link" data-title="load(location, options)">load(location, options)</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-sync" class="toc-h3 toc-link" data-title="sync()">sync()</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-transaction-f" class="toc-h3 toc-link" data-title="transaction(f)">transaction(f)</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-trust-txid" class="toc-h3 toc-link" data-title="trust(txid)">trust(txid)</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-app" class="toc-h3 toc-link" data-title="app">app</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-blockchain" class="toc-h3 toc-link" data-title="blockchain">blockchain</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-cache" class="toc-h3 toc-link" data-title="cache">cache</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-inventory" class="toc-h3 toc-link" data-title="inventory">inventory</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-logger" class="toc-h3 toc-link" data-title="logger">logger</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-owner" class="toc-h3 toc-link" data-title="owner">owner</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-purse" class="toc-h3 toc-link" data-title="purse">purse</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-timeout" class="toc-h3 toc-link" data-title="timeout">timeout</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-jig" class="toc-h3 toc-link" data-title="static Jig">static Jig</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-code" class="toc-h3 toc-link" data-title="static Code">static Code</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-berry" class="toc-h3 toc-link" data-title="static Berry">static Berry</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-creation" class="toc-h3 toc-link" data-title="static Creation">static Creation</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-transaction" class="toc-h3 toc-link" data-title="static Transaction">static Transaction</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-plugins" class="toc-h3 toc-link" data-title="static plugins">static plugins</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-extra" class="toc-h3 toc-link" data-title="static extra">static extra</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-api" class="toc-h3 toc-link" data-title="static api">static api</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-util" class="toc-h3 toc-link" data-title="static util">static util</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-configure-env-network" class="toc-h3 toc-link" data-title="static configure(env, network)">static configure(env, network)</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-protocol" class="toc-h3 toc-link" data-title="static protocol">static protocol</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-version" class="toc-h3 toc-link" data-title="static version">static version</a>
                          </li>
                          <li>
                            <a href="#api-reference-run-static-instance" class="toc-h3 toc-link" data-title="static instance">static instance</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-jig" class="toc-h2 toc-link" data-title="Jig">Jig</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-jig-init" class="toc-h3 toc-link" data-title="init()">init()</a>
                          </li>
                          <li>
                            <a href="#api-reference-jig-sync-options" class="toc-h3 toc-link" data-title="sync(options)">sync(options)</a>
                          </li>
                          <li>
                            <a href="#api-reference-jig-destroy" class="toc-h3 toc-link" data-title="destroy()">destroy()</a>
                          </li>
                          <li>
                            <a href="#api-reference-jig-auth" class="toc-h3 toc-link" data-title="auth()">auth()</a>
                          </li>
                          <li>
                            <a href="#api-reference-jig-static-load-location" class="toc-h3 toc-link" data-title="static load(location)">static load(location)</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-code" class="toc-h2 toc-link" data-title="Code">Code</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-code-sync-options" class="toc-h3 toc-link" data-title="sync(options)">sync(options)</a>
                          </li>
                          <li>
                            <a href="#api-reference-code-destroy" class="toc-h3 toc-link" data-title="destroy()">destroy()</a>
                          </li>
                          <li>
                            <a href="#api-reference-code-auth" class="toc-h3 toc-link" data-title="auth()">auth()</a>
                          </li>
                          <li>
                            <a href="#api-reference-code-upgrade-t" class="toc-h3 toc-link" data-title="upgrade(T)">upgrade(T)</a>
                          </li>
                          <li>
                            <a href="#api-reference-code-deps" class="toc-h3 toc-link" data-title="deps">deps</a>
                          </li>
                          <li>
                            <a href="#api-reference-code-sealed" class="toc-h3 toc-link" data-title="sealed">sealed</a>
                          </li>
                          <li>
                            <a href="#api-reference-code-upgradable" class="toc-h3 toc-link" data-title="upgradable">upgradable</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-berry" class="toc-h2 toc-link" data-title="Berry">Berry</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-berry-init" class="toc-h3 toc-link" data-title="init()">init()</a>
                          </li>
                          <li>
                            <a href="#api-reference-berry-static-pluck-path-fetch" class="toc-h3 toc-link" data-title="static pluck(path, fetch)">static pluck(path, fetch)</a>
                          </li>
                          <li>
                            <a href="#api-reference-berry-static-load-path" class="toc-h3 toc-link" data-title="static load(path)">static load(path)</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-creation" class="toc-h2 toc-link" data-title="Creation">Creation</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-creation-origin" class="toc-h3 toc-link" data-title="origin">origin</a>
                          </li>
                          <li>
                            <a href="#api-reference-creation-location" class="toc-h3 toc-link" data-title="location">location</a>
                          </li>
                          <li>
                            <a href="#api-reference-creation-nonce" class="toc-h3 toc-link" data-title="nonce">nonce</a>
                          </li>
                          <li>
                            <a href="#api-reference-creation-owner" class="toc-h3 toc-link" data-title="owner">owner</a>
                          </li>
                          <li>
                            <a href="#api-reference-creation-satoshis" class="toc-h3 toc-link" data-title="satoshis">satoshis</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-transaction" class="toc-h2 toc-link" data-title="Transaction">Transaction</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-transaction-update-callback" class="toc-h3 toc-link" data-title="update(callback)">update(callback)</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-publish-options" class="toc-h3 toc-link" data-title="publish(options)">publish(options)</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-export-options" class="toc-h3 toc-link" data-title="export(options)">export(options)</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-pay" class="toc-h3 toc-link" data-title="pay()">pay()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-sign" class="toc-h3 toc-link" data-title="sign()">sign()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-rollback" class="toc-h3 toc-link" data-title="rollback()">rollback()</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-outputs" class="toc-h3 toc-link" data-title="outputs">outputs</a>
                          </li>
                          <li>
                            <a href="#api-reference-transaction-deletes" class="toc-h3 toc-link" data-title="deletes">deletes</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-plugins" class="toc-h2 toc-link" data-title="Plugins">Plugins</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-plugins-runconnect" class="toc-h3 toc-link" data-title="RunConnect">RunConnect</a>
                          </li>
                          <li>
                            <a href="#api-reference-plugins-browsercache" class="toc-h3 toc-link" data-title="BrowserCache">BrowserCache</a>
                          </li>
                          <li>
                            <a href="#api-reference-plugins-inventory" class="toc-h3 toc-link" data-title="Inventory">Inventory</a>
                          </li>
                          <li>
                            <a href="#api-reference-plugins-localcache" class="toc-h3 toc-link" data-title="LocalCache">LocalCache</a>
                          </li>
                          <li>
                            <a href="#api-reference-plugins-localowner" class="toc-h3 toc-link" data-title="LocalOwner">LocalOwner</a>
                          </li>
                          <li>
                            <a href="#api-reference-plugins-localpurse" class="toc-h3 toc-link" data-title="LocalPurse">LocalPurse</a>
                          </li>
                          <li>
                            <a href="#api-reference-plugins-mattercloud" class="toc-h3 toc-link" data-title="MatterCloud">MatterCloud</a>
                          </li>
                          <li>
                            <a href="#api-reference-plugins-mockchain" class="toc-h3 toc-link" data-title="Mockchain">Mockchain</a>
                          </li>
                          <li>
                            <a href="#api-reference-plugins-payserver" class="toc-h3 toc-link" data-title="PayServer">PayServer</a>
                          </li>
                          <li>
                            <a href="#api-reference-plugins-viewer" class="toc-h3 toc-link" data-title="Viewer">Viewer</a>
                          </li>
                          <li>
                            <a href="#api-reference-plugins-whatsonchain" class="toc-h3 toc-link" data-title="WhatsOnChain">WhatsOnChain</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-extras" class="toc-h2 toc-link" data-title="Extras">Extras</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-extras-asm" class="toc-h3 toc-link" data-title="asm">asm</a>
                          </li>
                          <li>
                            <a href="#api-reference-extras-b" class="toc-h3 toc-link" data-title="B">B</a>
                          </li>
                          <li>
                            <a href="#api-reference-extras-expect" class="toc-h3 toc-link" data-title="expect">expect</a>
                          </li>
                          <li>
                            <a href="#api-reference-extras-group" class="toc-h3 toc-link" data-title="Group">Group</a>
                          </li>
                          <li>
                            <a href="#api-reference-extras-hex" class="toc-h3 toc-link" data-title="Hex">Hex</a>
                          </li>
                          <li>
                            <a href="#api-reference-extras-token" class="toc-h3 toc-link" data-title="Token">Token</a>
                          </li>
                          <li>
                            <a href="#api-reference-extras-tx" class="toc-h3 toc-link" data-title="Tx">Tx</a>
                          </li>
                          <li>
                            <a href="#api-reference-extras-txo" class="toc-h3 toc-link" data-title="txo">txo</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-apis" class="toc-h2 toc-link" data-title="APIs">APIs</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-apis-blockchain" class="toc-h3 toc-link" data-title="Blockchain">Blockchain</a>
                          </li>
                          <li>
                            <a href="#api-reference-apis-cache" class="toc-h3 toc-link" data-title="Cache">Cache</a>
                          </li>
                          <li>
                            <a href="#api-reference-apis-lock" class="toc-h3 toc-link" data-title="Lock">Lock</a>
                          </li>
                          <li>
                            <a href="#api-reference-apis-logger" class="toc-h3 toc-link" data-title="Logger">Logger</a>
                          </li>
                          <li>
                            <a href="#api-reference-apis-owner" class="toc-h3 toc-link" data-title="Owner">Owner</a>
                          </li>
                          <li>
                            <a href="#api-reference-apis-purse" class="toc-h3 toc-link" data-title="Purse">Purse</a>
                          </li>
                      </ul>
                  </li>
                  <li>
                    <a href="#api-reference-util" class="toc-h2 toc-link" data-title="Util">Util</a>
                      <ul class="toc-list-h3">
                          <li>
                            <a href="#api-reference-util-commonlock" class="toc-h3 toc-link" data-title="CommonLock">CommonLock</a>
                          </li>
                          <li>
                            <a href="#api-reference-util-install-t" class="toc-h3 toc-link" data-title="install(T)">install(T)</a>
                          </li>
                          <li>
                            <a href="#api-reference-util-metadata-rawtx" class="toc-h3 toc-link" data-title="metadata(rawtx)">metadata(rawtx)</a>
                          </li>
                          <li>
                            <a href="#api-reference-util-unify-creations" class="toc-h3 toc-link" data-title="unify(...creations)">unify(...creations)</a>
                          </li>
                      </ul>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#tools" class="toc-h1 toc-link" data-title="Tools">Tools</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#tools-explorer" class="toc-h2 toc-link" data-title="Explorer">Explorer</a>
                  </li>
                  <li>
                    <a href="#tools-deploy" class="toc-h2 toc-link" data-title="Deploy">Deploy</a>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li>version 0.6.11</li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduction'>Introduction</h1>
<p>Run is a platform to build apps and tokens on Bitcoin. Developers create applications using interactive objects, called jigs. Jigs allow you to build almost anything you can dream up: tokens, contracts, interfaces, elections, games, digital pets, and more — all run on Bitcoin.</p>

<p>Run supports full object-oriented programming and arbitrary code today. It is secure and performant for real applications. These docs will help you get started!</p>
<h1 id='getting-started'>Getting Started</h1><h2 id='getting-started-installation'>Installation</h2>
<blockquote>
<p>Load both <code>bsv</code> and Run in the browser</p>
</blockquote>
<pre class="highlight html tab-html"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"bsv.browser.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"run.browser.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre>
<blockquote>
<p>Load Run in Node.js</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">Run</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'./dist/run.node.min'</span><span class="p">)</span>
</code></pre>
<p>If you&#39;re new to Run, let the <a href="https://run.network">tutorial series</a> guide your journey to get acquainted. You can write code without installing anything. The web browser Console will be your playground.</p>

<p>The details written here in the Docs have example code in the sidebar on the right-hand side. Anything you read in paragraphs, you can preview in-action over there. ⇥</p>

<p>Run works everywhere including all major browsers, on desktop and mobile, as well as Node.js 10+ on <a href="#advanced-usage-using-run-on-a-server">servers</a>. Run is written in JavaScript ES6 and uses the <a href="https://github.com/moneybutton/bsv"><strong>bsv</strong> library</a> to build and sign transactions. To get started:</p>

<ul>
<li>For a webpage: Add <code>bsv.browser.min.js</code> and <code>run.browser.min.js</code> to the <code>&lt;head&gt;</code> tag.</li>
<li>For Node.js: Execute <code>npm install bsv</code> to install <strong>bsv</strong>, then import <code>run.node.min.js</code>.</li>
</ul>

<p>And that&#39;s it. All your code and jigs will be saved on-chain and Run will use public APIs to interact with the Bitcoin network. You don&#39;t need to deploy any servers with Run. All the logic works client-side.</p>
<h2 id='getting-started-setup'>Setup</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">network</span><span class="p">:</span> <span class="s1">'mock'</span> <span class="p">})</span>
</code></pre>
<p>The Run instance manages your communication with the Bitcoin network. The default network is <code>main</code> (Mainnet), but for development and testing, we recommend <code>mock</code>. Mock is an in-memory simulation blockchain that does not require funds to use. We like to call it the <em>mockchain</em>. For more configuration options, see <a href="#api-reference-run">API Reference: Run</a>.</p>
<h2 id='getting-started-creating-jigs'>Creating Jigs</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">SimpleStore</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">set</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">jig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleStore</span><span class="p">()</span>

<span class="nx">jig</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'Satoshi Nakamoto'</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">jig</span><span class="p">.</span><span class="nx">owner</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">jig</span><span class="p">.</span><span class="nx">location</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">jig</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
</code></pre>
<p>Let&#39;s begin with a basic jig that stores a value in a variable. Create a jig called <code>SimpleStore</code>. By extending from <code>Jig</code>, the instances of your class will automatically sync to the blockchain. Every jig has an <code>owner</code>. Any code may read jigs but only its <code>owner</code> can update it. The <code>owner</code> is typically a Bitcoin address, and the private key is required to update it.</p>

<p>In addition to <code>owner</code>, every jig has a <code>location</code>. A jig&#39;s <code>location</code> is the pairing of a Bitcoin transaction ID and an output index, and it represents a particular state in time of an object or class on Bitcoin. When you check the <code>location</code> property of a jig, you get its current location. If you wish to get the location where the jig was first deployed, that is called its <code>origin</code>. The <code>origin</code> is unique and will not change, however <code>location</code> changes with every update. After a method call, your jig will have a new <code>location</code> pointing to a Bitcoin transaction containing the last method call.</p>
<h2 id='getting-started-loading-jigs'>Loading Jigs</h2>
<blockquote>
<p>Loading all jigs</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">simpleStore</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">jigs</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">x</span> <span class="o">=&gt;</span> <span class="nx">x</span> <span class="k">instanceof</span> <span class="nx">SimpleStore</span><span class="p">)</span>

<span class="nx">simpleStore</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>Loading a specific jig</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">specificJig</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">simpleStore</span><span class="p">.</span><span class="nx">location</span><span class="p">)</span>

<span class="nx">specificJig</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'abc'</span><span class="p">)</span>

<span class="c1">// Fast-forward the jig to its latest state</span>
<span class="nx">await</span> <span class="nx">specificJig</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
</code></pre>
<p>The simplest way to load your jigs is to call <code>run.inventory.sync()</code> and then access <code>run.inventory.jigs</code>. <code>run.inventory.sync()</code> will find and load all objects owned by <code>run.owner</code> and place them in the <code>jigs</code> array. Once loaded, you may call methods and use them normally. Alternatively, you may wish to load a particular jig or load a jig in a historical state. To do either, pass the <code>location</code> of the jig you wish to load into <code>run.load()</code>.</p>

<p>If you&#39;ve loaded a historical location so that your jig is in a previous state, you&#39;ll need to first catch up to the latest state before you&#39;ll be allowed to make a method call. <code>sync()</code> will handily fast-forward a jig to its latest state on the blockchain <em>without</em> triggering a Bitcoin transaction. In the example on the sidebar, if <code>specificJig</code> was in a historical state, you would call <code>specificJig.sync()</code> and then call <code>specificJig.set(&#39;abc&#39;)</code>. When you accidentally try to update a jig without the jig being in its latest state, Run will safely abort before publishing a Bitcoin transaction and inform you with an error. In that case, you&#39;ll just need to add the preceding <code>sync()</code> call and execute your code again. The best practice is to write code in such a way that jigs are always up-to-date in their latest state. Run manages the heavy lifting for you.</p>

<p><code>sync()</code> also acts as a debugging tool since it surfaces any errors your jigs have after you&#39;ve made changes to them. If you notice your app acting funny, a well-placed preceding <code>specificJig.sync()</code> can help you uncover the error. You may also call <code>sync()</code> on the Run instance, like this: <code>run.sync()</code>. That&#39;ll help you search out any errors from your entire app in <em>all</em> of the jigs you own.</p>
<h1 id='jigs'>Jigs</h1>
<p>Jigs are interactive objects on Bitcoin. You define a jig with a JavaScript class and that class determines exactly what the jig can do. Every instance of a jig is unique. Each one has an owner and only that owner can update the jig. How is that secured? Bitcoin! Let&#39;s explore how you create a jig.</p>
<h2 id='jigs-creating'>Creating</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Post</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> 
    <span class="nx">init</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nx">Post</span><span class="p">(</span><span class="s1">'Hello, world'</span><span class="p">)</span>
</code></pre>
<p>Let&#39;s create a new jig class called <code>Post</code> for represents comments on a message board. In JavaScript, your constructor is called <code>constructor</code> but for jigs, this method is called <code>init</code>. Think of them the same way. If <code>init</code> throws an exception, the jig will never be created, just like constructors. You create jigs by calling <code>new</code> as you would with normal JavaScript objects and they get deployed onto the Bitcoin network. Pretty cool.</p>
<h2 id='jigs-updating'>Updating</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">EditablePost</span> <span class="kr">extends</span> <span class="nx">Post</span> <span class="p">{</span>
    <span class="nx">edit</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">editablePost</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EditablePost</span><span class="p">(</span><span class="s1">'Hello, world'</span><span class="p">)</span>

<span class="nx">editablePost</span><span class="p">.</span><span class="nx">edit</span><span class="p">(</span><span class="s1">'Hello, BitCoin'</span><span class="p">)</span>
</code></pre>
<p>Jigs are updated by calling methods. In fact, that is the only way to update jigs. Your jig class defines the ways that your jig instances may evolve, so be sure to think ahead. When you call a method, Run publishes a Bitcoin transaction with data in an <code>op_return</code> that includes the method name and its arguments. The state may be recomputed simply by playing back every update one-by-one. For more information about how it works, see <a href="#how-it-works">How It Works</a>.</p>
<h2 id='jigs-sending'>Sending</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Dragon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">send</span><span class="p">(</span><span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">owner</span> <span class="o">=</span> <span class="nx">to</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nx">Dragon</span><span class="p">().</span><span class="nx">send</span><span class="p">(</span><span class="nx">address</span><span class="p">)</span>
</code></pre>
<p>Jigs may be sent to someone else by changing the <code>owner</code> property of a jig. Simply set the owner to the new owner, which may be a Bitcoin address, a public key, or a custom <a href="#advanced-usage-locks">Lock</a>. The new owner will be able to update the jig starting in the next transaction.</p>
<h2 id='jigs-syncing'>Syncing</h2>
<blockquote>
<p>Wait for updates to complete</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">LoyaltyCard</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
    <span class="nx">init</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">stamps</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">}</span>
    <span class="nx">stamp</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">stamps</span> <span class="o">+=</span><span class="mi">1</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">card</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">LoyaltyCard</span><span class="p">()</span>
<span class="nx">await</span> <span class="nx">card</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="nx">card</span><span class="p">.</span><span class="nx">stamp</span><span class="p">()</span>
<span class="nx">await</span> <span class="nx">card</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
</code></pre>
<blockquote>
<p>Sync a jig from its origin to its latest state</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">card2</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">card</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>

<span class="nx">await</span> <span class="nx">card2</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
</code></pre>
<p>Run is asynchronous. When you create or update jigs, Run creates Bitcoin transactions for you in the background and broadcasts them to the network. As with any network request, the request may sometimes fail. Your connection may go down or a node on the network may reject your transaction.</p>

<p>Run updates your jig&#39;s state with each method call you make. However, it does <em>not</em> continuously update your jigs. Because if it did, as a developer you&#39;d feel like you were on shifting sand. Instead, you&#39;ve got a reliable and steady state for each jig that you&#39;re working with. Therefore, depending on the app you&#39;ve built and actions of the owner of the jig, you might need to catch up a jig to its latest state because it could have been modified outside of your app.</p>

<p>Every jig has <code>sync()</code> available to ensure your local state is the same as that on the network. Calling <code>await jig.sync()</code> returns when:</p>

<ol>
<li>All pending local transactions have been published successfully, and </li>
<li>The jig has been caught up with any new transactions from the network.</li>
</ol>

<p>Any errors in validation or network requests will throw an error.</p>

<p>When testing ideas out in the browser, you won&#39;t need to call <code>sync()</code> very much. Run will happily execute method calls on jigs in their latest state. However, in a production app, the best practice is to call <code>sync()</code> after <em>every method call</em> to ensure that you catch errors early and handle them gracefully. Calling <code>sync()</code> will force any error to show up at that particular line in the code.</p>
<h2 id='jigs-interactivity'>Interactivity</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Event</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">createTicket</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">Ticket</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">Ticket</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="nx">event</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Event</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">Ticket</span> <span class="p">}</span>
</code></pre>
<p>Jigs are designed to interact together. Jigs may create other jigs. Jigs may call methods on other jigs. Jigs may read properties and even store other jigs on them. These are all types of interactions, and there are many more!</p>

<p>Calling <code>new</code> to construct a jig within a method of another jig will create a new output in the transaction. Sometimes you will create new jigs that are of the same class, but many times you will want to create jigs that are of a different class. Because Jig code runs in a sandbox without access to other code, you set the <code>deps</code> property on your jig class to specify any dependencies. Dependencies will be made available code as globals.</p>

<p>Jigs may store other jigs as properties too. Think of these as standard JavaScript object references that you may read or write. However, if stored jigs are updated by calling methods, then their owners must also sign the Bitcoin transaction that updates their state. For more information on the jig rules, see <a href="#how-it-works">How It Works</a>.</p>
<h2 id='jigs-destroying'>Destroying</h2>
<blockquote>
<p>Destroy a jig</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">giftCard</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
</code></pre>
<blockquote>
<p>Override destroy to finlize a jig</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">GiftCard</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span>
  <span class="p">}</span>

  <span class="nx">destroy</span><span class="p">()</span> <span class="p">{</span>
    <span class="kr">super</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Not all jigs are designed to live forever. You may wish to delete jigs you no longer need and or consume jigs for another purpose. Calling <code>destroy()</code> on the jig creates a new transaction that removes the jig&#39;s UTXO and owner and makes it un-updatable.</p>

<p>Destroyed jigs still have locations. They can still be loaded using <code>run.load</code> and their information is still on the blockchain. However, destroyed jigs can no longer be updated and they are marked as being destroyed with a <code>null</code> owner. They are forever locked in their final state. The locations for destroyed jigs are the pairing of its final transaction ID and a unique index for that destroyed jig.</p>

<p>By default, every jig has a destroy method. If you wish to prevent a jig from being destroyed, create your own destroy method and throw an error. You can call destroy from outside the jig or from another method. You can also override destroy to put the jig into its final state, as seen to the right. The <a href="#api-reference-extra-token">Token</a> class is a good example that does all of this.</p>
<h2 id='jigs-backing'>Backing</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Tip</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">pubkey</span><span class="p">,</span> <span class="nx">amount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">owner</span> <span class="o">=</span> <span class="nx">pubkey</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">satoshis</span> <span class="o">=</span> <span class="nx">amount</span>
  <span class="p">}</span>

  <span class="nx">withdraw</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">satoshis</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nx">Tip</span><span class="p">(</span><span class="s1">'I like your videos'</span><span class="p">,</span> <span class="nx">pubkey</span><span class="p">,</span> <span class="mi">100000</span><span class="p">)</span>
</code></pre>
<p>Jigs may be backed by bitcoins. When a jig is backed, it means that the output associated with that jig has a non-dust value in it. Backed jigs let users send money between each other and provide a baseline value for items. To back a jig, set the <code>satoshis</code> property to a number. Your purse will automatically deposit that amount into the jig. When the <code>satoshis</code> property is later decreased, those Bitcoins will be withdrawn to the current Run purse.</p>

<p>It is important to remember that these are <em>backed</em> jigs and not smart contracts. The jig&#39;s owner may always melt the satoshis out of the jig and in doing so destroy the jig.</p>

<aside class="notice">
<b>Note:</b> All bitcoin outputs must have an amount at least the dust limit, currently 546 satoshis, to be accepted by the network. Run will choose the greater of the `satoshis` property and this dust limit when building outputs.
</aside>
<h2 id='jigs-checking-parameters'>Checking Parameters</h2>
<blockquote>
<p>Attaching an item</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Hat</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">}</span>

<span class="kr">class</span> <span class="nx">Person</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">wear</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">item</span><span class="p">).</span><span class="nx">toBeInstanceOf</span><span class="p">(</span><span class="nx">Hat</span><span class="p">)</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">item</span> <span class="o">=</span> <span class="nx">item</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Person</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">Hat</span><span class="p">,</span> <span class="na">expect</span><span class="p">:</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">extra</span><span class="p">.</span><span class="nx">expect</span> <span class="p">}</span>
</code></pre>
<p>Jigs should always validate their parameters. For your convenience, Run provides the <code>expect</code> sidekick. <code>expect</code> is like assertions you might use in Jest or Chai unit tests. It lets you to check many things, including if a jig is a certain class, if a number is greater than another number, or if a parameter is of a certain type. To get started, add <code>expect</code> as a dependency to your jig as seen to the right. Then, check out the <a href="#api-reference-extras-expect">expect</a> documention to review the available methods.</p>

<p>Sometimes you may wish to check if a class is part of a changing set. For example, a game may have a list of item classes that may change over time. For that, see the <a href="#tips-and-tricks-dynamic-whitelists">Dynamic Whitelists</a> section.</p>
<h2 id='jigs-adding-an-icon'>Adding an Icon</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">emoji</span> <span class="o">=</span> <span class="s1">'🦖'</span>

<span class="kr">const</span> <span class="nx">image</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">B</span><span class="p">.</span><span class="nx">loadWithMetadata</span><span class="p">(</span><span class="s1">'ca64bd8d129332513540d15b73519bf905e0863982a2f00f63deb38c6a44f546_o1'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'T Rex skull icon'</span><span class="p">,</span>
  <span class="na">license</span><span class="p">:</span> <span class="s1">'[CC BY 3.0](http://creativecommons.org/licenses/by/3.0)'</span><span class="p">,</span>
  <span class="na">author</span><span class="p">:</span> <span class="s1">'[Delapouite](https://delapouite.com/)'</span><span class="p">,</span>
  <span class="na">source</span><span class="p">:</span> <span class="s1">'[game-icons.net](https://game-icons.net/1x1/delapouite/t-rex-skull.html)'</span>
<span class="p">})</span>

<span class="kr">class</span> <span class="nx">DinoPet</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">}</span>

<span class="nx">DinoPet</span><span class="p">.</span><span class="nx">metadata</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">emoji</span><span class="p">,</span> <span class="nx">image</span> <span class="p">}</span>

<span class="k">new</span> <span class="nx">DinoPet</span><span class="p">()</span>
</code></pre>
<p>You may optionally set an emoji, image, or both onto a jig. These icons will appear in explorers, exchanges, and wallets, whenever your jig is displayed. To attach an icon, set the <code>metadata</code> property on your jig class with the desired fields. See the example to the right.</p>

<p><strong>Setting an emoji</strong>: To add an emoji, set the <code>emoji</code> field on <code>metadata</code> to a single emoji character. You can find an appropriate emoji on <a href="https://emojipedia.org/">Emojipedia</a>.</p>

<p><strong>Setting an image</strong>: To set an image, you must first upload an image file on-chain. You can use <a href="https://www.bitcoinfiles.org">Bitcoin Files</a> to upload an image from your local PC or phone onto the blockchain. Bitcoin Files stores your file using a special transaction format for data called the B:// protocol. The B:// data you uploaded can then be loaded and set as an image using the <a href="#api-reference-extras-b">B</a> berry class as seen to the right. Simply set the berry loaded to the <code>image</code> field on <code>metadata</code>. Currently Run supports SVG and PNG images, with SVG recommended in most cases.</p>

<p>Other metadata besides emoji and image are supported too. See <a href="#advanced-usage-standard-metadata">Standard Metadata</a> for more.</p>
<h1 id='code'>Code</h1>
<p>Run supports interactive code on Bitcoin. Just like you can own jig objects, you can deploy and own JavaScript classes and functions too. We call these on-chain classes and functions <a href="#api-reference-code">Code</a> with a capital C. Using Code, you can define new kinds of jigs, create reusable helper functions, share your server logic for auditability, discover algorithms from other apps, and much more. In fact, did you know you&#39;ve already been using Code? Every jig object requires a jig class, which is Code! Code is the foundation for jigs, but you&#39;ll see that it also useful in its own right.</p>

<p>There are two major kinds of Code: <em>jig code</em> and <em>sidekicks</em>. Jig code are classes that extend from <a href="#api-reference-jig">Jig</a> and are themselves jigs. You can use them to create jig objects as we&#39;ve already seen, but you can also call methods to record updates to them on the blockchain. These evolve over time according to same <a href="#how-it-works-ownership-rules">jig ownership rules</a> as objects. Sidekicks are your helpers. They are classes or functions that don&#39;t extend from <code>Jig</code> and are used instead for more supporting roles. When you call a method on a sidekick, nothing gets recorded on-chain. But you can use sidekicks inside jigs and even your own app. Using jig code and sidekicks, you have a powerful repertoire for building extensible apps.</p>
<h2 id='code-deploying'>Deploying</h2>
<blockquote>
<p>Deploy a jig class with a dependency</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Reward</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="kr">class</span> <span class="nx">LootBox</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">reward</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Reward</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">LootBox</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">Reward</span> <span class="p">}</span>

<span class="kr">const</span> <span class="nx">LootBoxCode</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">LootBox</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">LootBoxCode</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
</code></pre>
<blockquote>
<p>Deploy a sidekick function</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kd">function</span> <span class="nx">sha256</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">sha256</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
</code></pre>
<p>To upload your class or function to Bitcoin, you <em>deploy</em> it. Call <code>run.deploy</code> and pass in your local class or function. Run will publish a new Bitcoin transaction that assigns your code a location and makes you the owner. Being the owner allows you to perform actions using the code. Code is not always static, as we&#39;ll see!</p>

<p>When <code>deploy</code> returns, it returns to you the Code version of your class or function. This Code version looks just like your original class or function, except that it is securely sandboxed, and it gets various Code methods and properties that allow you to use it on the blockchain. You can call <code>sync()</code> on it right away to make sure that it deployed successfully.</p>

<p>Because Code you deploy is sandboxed, you have to tell Run about any dependencies. If you use another class or function in code, tell Run about it by setting the <code>deps</code> property, as seen to the right. Run will link the two types together on-chain when they are deployed.</p>

<p>We recommend you deploy all of your code in advance so your users and your app have a stable library to work with. You can either do this yourself using a script, or give the <a href="#tools-deploy">Deploy Tool</a> a try.</p>
<h2 id='code-loading'>Loading</h2>
<blockquote>
<p>Load the Data class from another instance</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">Data</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">'&lt;class-location-goes-here&gt;'</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Data</span><span class="p">(</span><span class="s1">'abc'</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>Find a class you own in the inventory</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">code</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">C</span> <span class="o">=&gt;</span> <span class="nx">C</span><span class="p">.</span><span class="nx">origin</span> <span class="o">===</span> <span class="nx">myClassOrigin</span><span class="p">)</span>
</code></pre>
<p>You may wish to download and use code that has already been deployed. For example, you might create instances of a particular jig class, or use code from third-parties in your application like a more secure NPM. <code>run.load</code>, in addition to loading jigs, is also able to download, install and sandbox Code from the blockchain. Simply pass in the location of the code you wish to download.</p>

<p>Alternatively, <code>run.inventory.sync()</code> will load all of Code that you own and place it in the <code>run.inventory.code</code> array. You can filter that array to find the code you want to use. Be careful not to filter code by name though! Because anyone can create Code with any name and send it to you.</p>
<h2 id='code-extending'>Extending</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">EditablePost</span> <span class="kr">extends</span> <span class="nx">Post</span> <span class="p">{</span>
  <span class="nx">edit</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>You can extend classes to add or change behavior. This is especially useful for jigs, when you might want to create a hierarchy of related types! Think for example a game where a base Weapon class is extended to create many types of weapons. Subclasses can use <code>super</code> to call parent methods just as you would in normal JavaScript classes too.</p>

<p>By default, extending code requires its owner&#39;s approval. This ensures <code>instanceof</code> is secure! Because if you didn&#39;t require owner approval, third-parties could extend from a class to bypass your <code>instanceof</code> checks. However, sometimes you may want third-parties to extend from you. In that case, set the <code>sealed</code> property to <code>false</code> before you deploy. This will allow anyone to extend from your class.</p>
<h2 id='code-syncing'>Syncing</h2>
<blockquote>
<p>Load a jig class using its origin and sync it to the latest state</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">DigitalPet</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">'&lt;digital-pet-class-origin&gt;'</span><span class="p">)</span>

<span class="nx">await</span> <span class="nx">DigitalPet</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
</code></pre>
<p>When you call <code>code.sync()</code>, it works just like <code>jig.sync()</code>. If there are pending transactions, they will be published to the blockchain, and if there are network updates you haven&#39;t received, Run will download and apply them. We always recommend calling <code>sync()</code> after every code update catch errors too. For more, see <a href="#api-reference-jigs-syncing">Jigs: Syncing</a>. If you load a class by its origin, it is best to call <code>sync()</code> right after to make sure you have the latest state.</p>
<h2 id='code-updating'>Updating</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Weapon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">setPower</span><span class="p">(</span><span class="nx">power</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">power</span> <span class="o">=</span> <span class="nx">power</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">WeaponCode</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">Weapon</span><span class="p">)</span>

<span class="nx">WeaponCode</span><span class="p">.</span><span class="nx">setPower</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="c1">// WeaponCode.power === 100</span>
</code></pre>
<p>Code can evolve over time just like jig objects. It is important to think of Code as living objects with their own history. Both jig and sidekick code can be upgraded, destroyed, and authed. Every time some Code is updated, Run publishes a Bitcoin transaction with the update and assigns it a new location. Other jigs that use your Code will see your updates when they sync their jigs.</p>

<p>With a jig class, you can also call methods to change its properties. To write a jig class method, just put <code>static</code> before the method name and it will apply to the class itself, as seen on the right. You can use this to change properties, call other class methods, and create instances. You can even change the owner to send the code to someone else!</p>
<h2 id='code-upgrading'>Upgrading</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">WeaponCode</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">'&lt;weapon-class-location&gt;'</span><span class="p">)</span>

<span class="kr">class</span> <span class="nx">Weapon</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span>

<span class="nx">WeaponCode</span><span class="p">.</span><span class="nx">upgrade</span><span class="p">(</span><span class="nx">Weapon</span><span class="p">)</span>

<span class="nx">await</span> <span class="nx">WeaponCode</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
</code></pre>
<p>After your code is deployed, you may discover that it is missing an important feature or that it has a bug. In other blockchains, this is a terminal failure! But in Run, you can call <code>upgrade()</code> on your Code and pass in a replacement class or function. That replacement will become the new code. You can use this to add new functionality, fix bugs, or change rules over time. Make sure that all methods and properties you want are still on the new code, just as if you deployed it for the first time!</p>

<p>When other jigs or code that use your code are synced, your upgrades will be automatically applied. You cannot change past behavior though; you can only change the future.</p>

<p>If you wish to provably prevent upgrades, you can set <code>upgradable</code> to false on the class. This is useful if you wish to show others that your code will not fundamentally change.</p>

<p>With great power comes great responsibility! Be careful.</p>
<h1 id='tokens'>Tokens</h1>
<p>Using jigs, you can create tokens similar to ERC-20. These can be used for stablecoins, in-game currencies, tradable reward points, shares of stock, and more. Unlike ERC-20 however, where different users interact through a smart contract, in Run each user owns their own tokens. This makes them more like native bitcoin.</p>

<p>In Run, tokens are just jigs that are <em>fungible</em>, meaning that you can divide them into smaller pieces and combine them back together, like cash. Tokens can be minted, owned, sent, and redeemed. And while you could write your own token class to implement this functionality, Run provides a base <code>Token</code> standard for your convenience. Simply extend from <code>Token</code> to create your own fungible token. As the owner of the class, only you will be able to mint new coins for your users.</p>

<p>Here we will guide you through a few use cases. For more, see <a href="#api-reference-extras-token"><code>API Reference: Token</code></a>.</p>
<h2 id='tokens-defining'>Defining</h2>
<blockquote>
<p>Deploy a new token class</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="nx">owner</span> <span class="p">})</span>

<span class="c1">// Define the token class</span>
<span class="kr">class</span> <span class="nx">USDCoin</span> <span class="kr">extends</span> <span class="nx">Token</span> <span class="p">{</span> <span class="p">}</span>
<span class="nx">USDCoin</span><span class="p">.</span><span class="nx">decimals</span> <span class="o">=</span> <span class="mi">6</span>
<span class="nx">USDCoin</span><span class="p">.</span><span class="nx">symbol</span> <span class="o">=</span> <span class="s1">'USDC'</span>
<span class="nx">USDCoin</span><span class="p">.</span><span class="nx">backingBank</span> <span class="o">=</span> <span class="s1">'HSBC'</span>
<span class="nx">USDCoin</span><span class="p">.</span><span class="nx">bankAccount</span> <span class="o">=</span> <span class="s1">'12345'</span>

<span class="c1">// Deploy</span>
<span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">USDCoin</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="c1">// Write this down</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">USDCoin</span><span class="p">.</span><span class="nx">location</span><span class="p">)</span>
</code></pre>
<p>Each new kind of token requires its own token class. Extend from <code>Token</code> and give your class a good name! Then configure it using the <code>symbol</code> and <code>decimals</code> properties, as well as any other properties that describe your token. See the <a href="#advanced-usage-standard-metadata">Standard Metadata</a> section for various other metadata we recommend.</p>

<p>Next, decide who will be the owner of your token class. The class owner is solely able to mint new tokens so it should be very secure. You may assign your token class to a private key or a more complex ownership script. Consider assigning your token to a <a href="#api-reference-extras-group">Group</a> lock to require multiple parties to sign off for mints.</p>

<p>Once you&#39;ve defined all the properties for your token class and chosen an owner, use ether the <a href="#tools-deploy">Deploy Tool</a> or <code>run.deploy</code> in a script to deploy your class to the blockchain. Be sure to write down its location afterward. Now let&#39;s mint some tokens!</p>
<h2 id='tokens-minting'>Minting</h2><pre class="highlight javascript tab-javascript"><code><span class="c1">// Load and sync your token class</span>
<span class="kr">const</span> <span class="nx">USDCoin</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">tokenClassLocation</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">USDCoin</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="c1">// Mint new coins to users. Only USDCoin.owner may do this</span>
<span class="kr">const</span> <span class="nx">mintedCoin</span> <span class="o">=</span> <span class="nx">USDCoin</span><span class="p">.</span><span class="nx">mint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nx">address</span><span class="p">)</span>
<span class="nx">await</span> <span class="nx">mintedCoin</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">mintedCoin</span><span class="p">.</span><span class="nx">amount</span><span class="p">)</span> <span class="c1">// 100</span>
</code></pre>
<p>Minting tokens is as simple as calling <code>mint()</code> on your token class and passing in the amount of tokens to mint along with the address to mint to. If you don&#39;t specify an address, you will mint tokens to yourself. Let&#39;s talk about some of the edge cases.</p>

<p>You may wish to mint to several users in a single transaction. To do this, use <code>run.transaction()</code> to perform them all at once. You may also wish to mint whenever a user sends you the appropriate amount of BSV. To do this, you might host a Node server that responds to blockchain events. When you start-up your server, call <code>run.load</code> to load your token class once and then <code>run.sync</code> to sync it, so that every subsequent mint happens quickly.</p>

<p>Sometimes you only want to mint a limited supply. In this case when you are finished minting all tokens, you can call <code>destroy()</code> on your token class to provably halt any further mints. Calling destroy prevents new tokens from being created in your name even in the event that your keys get hacked.</p>
<h2 id='tokens-sending'>Sending</h2><pre class="highlight javascript tab-javascript"><code><span class="c1">// Send part of a coin to someone else and keep the change</span>
<span class="kr">const</span> <span class="nx">sentCoin</span> <span class="o">=</span> <span class="nx">coinToSend</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</code></pre>
<p>Users that own your tokens can freely send them to others. To send a token, they simply call <code>send()</code> and pass in the new owner and the amount to send. A new token will be split off from the current one with the amount and owner specified. If they send the full amount, then the <code>coinToSend</code> is destroyed.</p>
<h2 id='tokens-combining'>Combining</h2>
<blockquote>
<p>Combine and send in a single transaction</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">tokens</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">jigs</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">jig</span> <span class="o">=&gt;</span> <span class="nx">jig</span> <span class="k">instanceof</span> <span class="nx">USDCoin</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">()</span>
<span class="nx">tx</span><span class="p">.</span><span class="nx">update</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">combine</span><span class="p">(</span><span class="nx">tokens</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
<span class="nx">tx</span><span class="p">.</span><span class="nx">update</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">send</span><span class="p">(</span><span class="nx">amount</span><span class="p">,</span> <span class="nx">address</span><span class="p">))</span>
<span class="nx">await</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">publish</span><span class="p">()</span>
</code></pre>
<p>After users have received several tokens, they may want to combine them into a single token containing their combined amount. We recommend wallets combine tokens regularly before every send to minimize the number of objects that need to be loaded. To combine tokens, call the <code>combine()</code> method on one token and pass in the other tokens that should be merged into it. You can even combine and send in a single transaction, as seen to the right.</p>
<h2 id='tokens-redeeming'>Redeeming</h2>
<blockquote>
<p>Redeem a token as bitcoin</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">sender</span> <span class="o">=</span> <span class="nx">token</span><span class="p">.</span><span class="nx">sender</span>
<span class="kr">const</span> <span class="nx">satoshiValue</span> <span class="o">=</span> <span class="nx">tokensToSatoshis</span><span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">amount</span><span class="p">)</span>

<span class="kr">class</span> <span class="nx">Payment</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">owner</span><span class="p">,</span> <span class="nx">satoshis</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">owner</span> <span class="o">=</span> <span class="nx">owner</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">satoshis</span> <span class="o">=</span> <span class="nx">satoshis</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">()</span>
<span class="nx">tx</span><span class="p">.</span><span class="nx">update</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">token</span><span class="p">.</span><span class="nx">destroy</span><span class="p">())</span>
<span class="nx">tx</span><span class="p">.</span><span class="nx">update</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">Payment</span><span class="p">(</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">satoshiValue</span><span class="p">))</span>
<span class="nx">await</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">publish</span><span class="p">()</span>
</code></pre>
<p>Tokens often need to be redeemed back into their underlying asset. A stablecoin for example might be converted into its backing currency. To do this, the user will send their token to an address you control. You should monitor this address and redeem their tokens when you receive them. The <code>Token</code> class has a <code>sender</code> property that specifies the last owner of that token. When users send you their tokens, you can use the <code>sender</code> to determine who to redeem to. Then you can destroy that token so that it is no longer in circulation. See the example to the right.</p>
<h2 id='tokens-blacklisting'>Blacklisting</h2>
<p>You may need to blacklist individual tokens. For example, a user may lose their keys and request that you reissue their tokens. Or law enforcement may come to you to request blacklisting if your tokens are being used illegally. In both cases, the recommended solution is to keep a list of token locations that are blacklisted and not redeem any token that is on that blacklist. You will need to track descendant UTXOs too and blacklist them as well. But stay tuned! A simpler solution is coming.</p>
<h1 id='advanced-usage'>Advanced Usage</h1><h2 id='advanced-usage-standard-metadata'>Standard Metadata</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">DigitalPet</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">}</span>

<span class="nx">DigitalPet</span><span class="p">.</span><span class="nx">metadata</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">author</span><span class="p">:</span> <span class="s1">'Maximus'</span><span class="p">,</span>
  <span class="na">license</span><span class="p">:</span> <span class="s1">'MIT'</span><span class="p">,</span>
  <span class="na">emoji</span><span class="p">:</span> <span class="s1">'🐉'</span>
<span class="p">}</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">DigitalPet</span><span class="p">)</span>
</code></pre>
<p>Wallets, explorers, and exchanges will want to show your jigs. You can add special metadata to any creation to help these services show them. This metadata is stored as an object called <code>metadata</code> on your jig, code, or berry and it contains properties that each mean something special. The following properties are considered <em>standard metadata</em>:</p>

<p><strong>Presentation</strong></p>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>name</code></td>
<td>string</td>
<td>String name to use in place of the class or function name</td>
</tr>
<tr>
<td><code>description</code></td>
<td>string</td>
<td>Short sentence, less than 80 characters, that describes the jig for users</td>
</tr>
<tr>
<td><code>emoji</code></td>
<td>string</td>
<td>Single UTF-8 emoji character to represent the jig</td>
</tr>
<tr>
<td><code>image</code></td>
<td><a href="#api-reference-extras-b">B</a> instance</td>
<td>Reference to an SVG or PNG image stored using B://</td>
</tr>
</tbody></table>

<p><strong>Attribution and Licensing</strong></p>

<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>author</code></td>
<td>string markdown</td>
<td>Name of the creator for the code or content</td>
</tr>
<tr>
<td><code>title</code></td>
<td>string markdown</td>
<td>Title of the content</td>
</tr>
<tr>
<td><code>source</code></td>
<td>string markdown</td>
<td>URL where the content was found</td>
</tr>
<tr>
<td><code>license</code></td>
<td>string markdown</td>
<td>License for the code or content</td>
</tr>
</tbody></table>

<p>You can start by setting these properties on your <em>jig classes</em>, as seen to the right. By convention, jig instances will automatically use the metadata from their class. However, jig instances may also have their own metadata that overrides its class metadata. You can put any information in <code>metadata</code> you deem important, even properties that are not listed above. More will become standard over time.</p>
<h2 id='advanced-usage-batch-transactions'>Batch Transactions</h2><pre class="highlight javascript tab-javascript"><code><span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">new</span> <span class="nx">CustomJig</span><span class="p">()</span>
  <span class="nx">anotherJig</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">address</span><span class="p">)</span>
<span class="p">})</span>
</code></pre>
<p>Multiple actions may be batched together into a single atomic Bitcoin transaction. In addition to making these actions all-or-nothing, batching also reduces fees. Any number of updates may be batched together from different jigs. Call <code>run.transaction()</code> and pass in a callback function that includes all of the actions that you want batched together. Note that owners must still sign off on every update to a jig, so if you just created a jig, you can&#39;t yet call a method on it, and if you just sent a jig to someone, they can&#39;t use it until the next transaction. If you need more advanced transaction control, see the <a href="#api-reference-transaction">Transaction API</a></p>
<h2 id='advanced-usage-caller-variable'>Caller Variable</h2>
<blockquote>
<p>Storing the parent jig</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Child</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">caller</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<blockquote>
<p>Enforcing a method may only be called by certain classes</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Database</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">rootUser</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">rootUser</span> <span class="o">=</span> <span class="nx">rootUser</span>
  <span class="p">}</span>

  <span class="nx">deleteAll</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">caller</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">rootUser</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'only the root user may delete the database'</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">User</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">deleteDatabase</span><span class="p">(</span><span class="nx">database</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">database</span><span class="p">.</span><span class="nx">deleteAll</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Within Jig code, there is a special <code>caller</code> variable that is available. This variable is the jig that called this jig&#39;s methods or <code>null</code> if the jig&#39;s method was invoked from application code. Sidekicks do not get recorded so are never part of the caller stack.</p>

<p>You can use <code>caller</code> to keep track of where a jig came from by storing the parent jig inside of a child jig. You can also enforce that a child jig is created by a specific parent, or enforce that certain methods can only be called by certain jigs.</p>
<h2 id='advanced-usage-private-properties'>Private Properties</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Dragon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_numberOfCrashLandings</span> <span class="o">=</span> <span class="mi">88</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">InsurancePolicy</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">dragon</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Throws an error !</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">dragon</span><span class="p">.</span><span class="nx">_numberOfCrashLandings</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">chargeMoreMoney</span><span class="p">()</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Jigs may have private fields and private methods. These private properties prevent other jigs from depending on certain parts of your code. They allow you to better control the interface that users and other jigs rely on. Simply prefix your properties with an underscore to hide them. Run will enforce it.</p>

<p>Private variables may only be read inside a jig from one of its methods. If another kind of class attempts to read a private variable, Run will throw an error. Private variables may however be read externally in non-jig code, for example in the browser Console. You can use that ability to help you debug and check the values of private properties while you&#39;re developing your app.</p>

<p>Private methods are similar. They may only be called as helper methods from within the same jig, a jig of the same class, or the jig class itself. However, unlike private variables, you cannot call a private method externally in the web Console. If you think about it, that makes sense, because calling a private method externally would execute code with unintended consequences. Run keeps you safe.</p>

<aside class="warning">
<b>Warning:</b> Private properties are not encrypted. They are a tool to control access, not a feature for secrecy.
</aside>
<h2 id='advanced-usage-auth-method'>Auth Method</h2>
<blockquote>
<p>Limit the creation of jig instances by forcing the class to auth</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">SingleTonMonster</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">SingleTonMonster</span><span class="p">.</span><span class="nx">auth</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>Every jig and every code has an  <code>auth()</code> method on it. To <em>auth</em> means to spend a jig. Authing a jig forces its owner to sign off on any actions performed. It also ensures that the jig&#39;s state is the latest. You may use <code>auth()</code> for many purposes, such as to have a class approve of the creation of instances, as seen to the right. You can also use it to get approval from several jigs before performing some action. For example, several players in a game may need to auth using their characters for some shared action to take place, like moving on to the next round. Authing is a fundamental action that will probably become more useful to you over time.</p>
<h2 id='advanced-usage-code-presets'>Code Presets</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Dragon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">set</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Use the deploy tool to deploy the Dragon class and generate these presets</span>

<span class="nx">Dragon</span><span class="p">.</span><span class="nx">presets</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">main</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">origin</span><span class="p">:</span> <span class="s1">'bee45c75c37a289517f33ebfa051601c9610ccc56fbddfbabc44413db5b0bc1b_o1'</span>
    <span class="na">location</span><span class="p">:</span> <span class="s1">'bee45c75c37a289517f33ebfa051601c9610ccc56fbddfbabc44413db5b0bc1b_o1'</span><span class="p">,</span>
    <span class="na">nonce</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="na">owner</span><span class="p">:</span> <span class="s1">'13amCautaFqwbWV6MoC86xrh96W4fXGfDV'</span><span class="p">,</span>
    <span class="na">satoshis</span><span class="p">:</span> <span class="mi">0</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p>When you wish to create an instance of a jig from a class you&#39;ve already deployed, you have two options. Either you can load the class from the blockchain via <code>run.load</code> and then create an instance, or you can create an instance from a local class that has <em>presets</em> applied. When a local class has presets, Run doesn&#39;t have to download the code from the blockchain. Presets are a great way to share jig classes in NPM libraries.</p>

<p>You can use the <a href="#tools-deploy">Deploy Tool</a> to generate presets. However, you can also create them manually. To do this, upload your code to each Bitcoin network you wish to support using <code>run.deploy</code> in a script. The presets are <code>origin</code>, <code>location</code>, <code>nonce</code>, <code>owner</code>, and <code>satoshis</code> set onto a presets object for the given network. Run will detect these presets and automatically use the origins and locations on the appropriate network.</p>
<h2 id='advanced-usage-berries'>Berries</h2>
<blockquote>
<p>Load a metanet node</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">txid</span> <span class="o">=</span> <span class="s1">'2f24d7edb8de0ef534d8e0bc2413eddda451b4accc481519a1647d7af79d8e88'</span>
<span class="kr">const</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">txid</span><span class="p">,</span> <span class="nx">MetanetNode</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>Define the MetanetNode Berry</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">MetanetNode</span> <span class="kr">extends</span> <span class="nx">Berry</span> <span class="p">{</span>
  <span class="c1">// Its constructor can only be called by its pluck function. Run guarantees this.</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">pnode</span><span class="p">,</span> <span class="nx">parent</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">pnode</span> <span class="o">=</span> <span class="nx">pnode</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">parent</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span>
  <span class="p">}</span>

  <span class="c1">// Run calls this pluck function when you call run.load with a Berry class.</span>
  <span class="kr">static</span> <span class="nx">async</span> <span class="nx">pluck</span><span class="p">(</span><span class="nx">location</span><span class="p">,</span> <span class="nx">fetch</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">txo</span><span class="p">(</span><span class="nx">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">location</span><span class="p">))</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s1</span> <span class="o">===</span> <span class="s1">'meta'</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">pnode</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s2</span>
      <span class="kr">const</span> <span class="nx">txidParent</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s3</span>
      <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s4</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">data</span> <span class="o">===</span> <span class="s1">'METANET_ROOT'</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">MetanetNode</span><span class="p">(</span><span class="nx">pnode</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">parentNode</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">MetanetNode</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">txidParent</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">MetanetNode</span><span class="p">(</span><span class="nx">pnode</span><span class="p">,</span> <span class="nx">parentNode</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">MetanetNode</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="na">txo</span><span class="p">:</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">extra</span><span class="p">.</span><span class="nx">txo</span> <span class="p">}</span>
</code></pre>
<p>Third-party protocols, like Twetch, B, and Metanet, may be used within Run with Berries. Berries are JavaScript objects that capture arbitrary data on the blockchain. If you can write code to parse an OP_RETURN, you can create Berries. Berries are more than data though. They are objects. They can have methods, their types can be checked, they can be passed into jigs, stored as properties, cached, and more.</p>

<p>To load berries for an existing Berry protocol, simply call <code>BerryClass.load</code> and pass in the path to load. Run will be shipping with several built-in Berry protocols in the near future.</p>

<p>To define a new Berry protocol, simply extend from the <a href="#api-reference-berry">Berry</a> class and implement the static <code>pluck</code> method. Run calls your <code>pluck</code> method to load data at that location into a JavaScript object. Run fetches transaction data raw hex format, but you can parse it using the <a href="#api-reference-extras-txo">txo</a> or <a href="#api-reference-extras-tx">Tx</a> helpers. Berry classes get deployed on-chain too making them fully deterministic.</p>

<p>Once loaded, berries have locations that are extended to include both their protocol location and data location in the form: `<berry_class_location>?berry=<path>&amp;hash=<state-hash>&amp;version=<protocol>. This is a unique identifier and allows them to be cached securely.</p>

<aside class="notice">
<b>Note:</b> If this seems complex, don't worry! We expect most users will not have to write their own berries, and like plugins, there will be many berry protocols to choose from in the future. Stay tuned.
</aside>
<h2 id='advanced-usage-locks'>Locks</h2>
<blockquote>
<p>Send a token to a P2PK output script</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">PubkeyLock</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">pubkey</span> <span class="o">=</span> <span class="nx">pubkey</span> <span class="p">}</span>
  <span class="nx">script</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">asm</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">pubkey</span><span class="p">}</span><span class="s2"> OP_CHECKSIG`</span><span class="p">)</span> <span class="p">}</span>
  <span class="nx">domain</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">74</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nx">PubkeyLock</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">asm</span> <span class="p">}</span>

<span class="nx">token</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">PubkeyLock</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">))</span>
</code></pre>
<blockquote>
<p>A provably unspendable lock</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Unspendable</span> <span class="p">{</span>
  <span class="nx">script</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">asm</span><span class="p">(</span><span class="s1">'OP_RETURN'</span><span class="p">)</span> <span class="p">}</span>
  <span class="nx">domain</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">0</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Unspendable</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">asm</span> <span class="p">}</span>
</code></pre>
<p>The default owner for a jig is a Bitcoin address. This is a great default, but sometimes you&#39;ll want more advanced ownership. For example, you may want a group to own a jig, so that no one party has exclusive control. Or you may wish for a jig to be provably owned by nobody. Both of these and more are possible with <em>locks</em>.</p>

<p>A <em>lock</em> is an object that produces a Bitcoin output script. You can set one as the <code>owner</code> on your jigs. Run ships with a <a href="#api-reference-extras-group">Group</a> lock class for multi-sig ownership, and you may also create your own locks by implementing the <a href="#api-reference-apis-lock">Lock API</a>. Your class will have two methods: <code>script()</code> and <code>domain()</code>. After implementing these methods, set the owner of a jig to an instance of your lock, and Run will produce an output with your script.</p>

<p>You&#39;ll probably also want to unlock your jigs to update them. To do that, create a corresponding key by implementing the <a href="#api-reference-apis-owner">Owner API</a>. Your implementation of <code>Owner</code> will need to implement to methods: <code>sign()</code> and <code>nextOwner()</code>.</p>

<p><code>Locks</code> are deterministic, typed, and run in a sandbox environment. This means they can be safely used inside jigs. But this also means they can&#39;t use the <code>bsv</code> library or similar external code. Run provides an <a href="#api-reference-extras-asm">asm</a> helper function to fill the gap when building custom scripts inside Lock classes.</p>

<aside class="notice">
<b>Note:</b> If this seems complex, don't worry! There will be many types of locks to choose from in the future, and most users won't need to write their own. Stay tuned.
</aside>
<h1 id='tips-and-tricks'>Tips and Tricks</h1><h2 id='tips-and-tricks-limiting-supply'>Limiting Supply</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Weapon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">owner</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Only the GameItems class can mint Weapon instances</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">caller</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">GameItems</span><span class="p">)</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">owner</span> <span class="o">=</span> <span class="nx">owner</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">GameItems</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">createWeapon</span><span class="p">(</span><span class="nx">owner</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">weaponCount</span><span class="o">++</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">weaponCount</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'too many weapons'</span><span class="p">)</span>

    <span class="k">return</span> <span class="k">new</span> <span class="nx">Weapon</span><span class="p">(</span><span class="nx">owner</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">GameItems</span><span class="p">.</span><span class="nx">weaponCount</span> <span class="o">=</span> <span class="mi">0</span>

<span class="nx">GameItems</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">Weapon</span><span class="p">,</span> <span class="nx">expect</span> <span class="p">}</span>
<span class="nx">Weapon</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">GameItems</span><span class="p">,</span> <span class="nx">expect</span> <span class="p">}</span>
</code></pre>
<p>The supply of a jig class may be limited through the use of a <em>minter</em>. The <em>minter</em> is a separate jig that regulates the number of <em>mintee</em> jigs produced. In the example on the right, the <code>GameItems</code> jig class is the <em>minter</em> and is owned by the game. The <code>Weapon</code> jig object is the <em>mintee</em> and is owned by a player. The <code>Weapon</code> class enforces that it can only be created by <code>GameItems</code>, and the <code>GameItems</code> class limits the supply of <code>Weapon</code>.</p>

<p>In <code>Weapon.init</code>, we check that the weapon is being created by a <code>GameItems</code> instance using the <a href="#advanced-usage-caller">caller</a> special property. <code>caller</code> is the jig that called the current method being executed. If a player tried to create a <code>Weapon</code> instance independent of <code>GameItems</code>, Run would throw an error because the <code>caller</code> property would be <code>null</code>.</p>

<p>In <code>GameItems</code>, we check that there are no more than 10 items created by the game in <code>createWeapon(owner)</code>. This limits the supply. However, we also have to check that <code>GameItems</code> is only able to be created by the game company. This is to prevent users from creating their own <code>GameItems</code> classes to mint their own weapons.</p>
<h2 id='tips-and-tricks-dynamic-whitelists'>Dynamic Whitelists</h2>
<blockquote>
<p>A dynamic whitelist to support new tokens over time</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">SupportedClasses</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">classes</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Set</span><span class="p">()</span> <span class="p">}</span>
  <span class="nx">add</span><span class="p">(</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">classes</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">T</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">whitelist</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SupportedClasses</span><span class="p">()</span>

<span class="kr">class</span> <span class="nx">Game</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">items</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Set</span><span class="p">()</span> <span class="p">}</span>

  <span class="nx">use</span><span class="p">(</span><span class="nx">jig</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">Game</span><span class="p">.</span><span class="nx">whitelist</span><span class="p">.</span><span class="nx">classes</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">jig</span><span class="p">.</span><span class="nx">constructor</span><span class="p">)).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">jig</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Account</span><span class="p">.</span><span class="nx">whitelist</span> <span class="o">=</span> <span class="nx">whitelist</span> 
</code></pre>
<p>An app may want to allow third-party developers to create new classes of jigs. Those jigs can freely interact with existing jigs once approved. For this, you can create a dynamic whitelist of approved classes that jigs can check. See the example to the right 🠮</p>

<aside class="notice">
<b>Note:</b> Dynamic blacklists pose more challenges than whitelists. Solutions coming soon.
</aside>
<h2 id='tips-and-tricks-atomic-swaps'>Atomic Swaps</h2>
<blockquote>
<p>Atomically swapping two items with different owners</p>

<p>Machine 1</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">mine</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">myLocation</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">theirs</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">theirLocation</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">me</span> <span class="o">=</span> <span class="nx">mine</span><span class="p">.</span><span class="nx">owner</span>
<span class="kr">const</span> <span class="nx">them</span> <span class="o">=</span> <span class="nx">theirs</span><span class="p">.</span><span class="nx">owner</span>

<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">()</span>
<span class="nx">tx</span><span class="p">.</span><span class="nx">update</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">mine</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">them</span><span class="p">))</span>
<span class="nx">tx</span><span class="p">.</span><span class="nx">update</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">theirs</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">me</span><span class="p">))</span>
<span class="kr">const</span> <span class="nx">rawtx</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">tx</span><span class="p">.</span><span class="kr">export</span><span class="p">()</span>
</code></pre>
<blockquote>
<p>Machine 2</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="nx">rawtx</span><span class="p">)</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nx">outputs</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// TODO: Inspect the transaction to be sure it atomically swaps</span>
<span class="p">}</span>

<span class="nx">await</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">publish</span>
</code></pre>
<p>Run supports atomically updating jigs with different owners using the Transaction API. One application for this is atomic swaps, where two jigs owned by different users are exchanged in a single transaction.</p>

<p>The general process for an atomic swap is for one user to start a Run transaction by calling <code>new Run.Transaction()</code>. Then, this user performs all updates inside an <code>update()</code> call on the transaction, including calling methods on jigs they don&#39;t own. Run allows this user to build the transaction even if they won&#39;t be able to sign for every jig. Finally, this first user calls <code>tx.export()</code> to export the transaction, which will pay and sign for it in the process. The transaction is now built and must now be handed to other parties for them to sign. The other party then calls <code>run.import()</code> to load the transaction they received. They may then want to check the transaction by inspecting <code>tx.outputs</code> and <code>Run.util.metadata</code>. If they approve, then they may call <code>tx.publish()</code> to sign and publish. If more signatures are needed, they can export the transaction instead of publishing.</p>

<p>The Transaction API may also be used to simulate state channels and propose changes to other jigs. See the <a href="#api-reference-transaction">Transaction API</a> for more information.</p>
<h2 id='tips-and-tricks-using-run-on-a-server'>Using Run on a Server</h2>
<p>You may want to use Run on your server. For example you can:</p>

<ul>
<li>Issue tokens to users who send you BSV</li>
<li>Index user jigs to allow searching in your app</li>
<li>Take actions automatically as in a game server</li>
<li>Gather statistics about your user&#39;s behaviors</li>
<li>Administrative tasks like managing a blacklist</li>
</ul>

<p>The architecture you choose will depend on your application. You might create a REST service using <code>express</code> that allows users to make requests. Or you might index all jigs using a Planaria crawler. Or you might deploy a serverless function that responds to events. Run supports all of these architectures.</p>

<p>No matter the approach, you&#39;ll likely use Node on your servers. Run requires at least version 10 of Node. You can check which version you are using with <code>node --version</code>. If you are using Google Functions, be sure to set <code>{ &quot;engine&quot;: 10 }</code> in your <code>package.json</code>, because it defaults to Node 8.</p>

<p>Here are a few more tips:</p>
<h3 id='tips-and-tricks-using-run-on-a-server-increase-cache-limits'>Increase Cache Limits</h3>
<blockquote>
<p>Increase the state cache size</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">run</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">sizeMB</span> <span class="o">=</span> <span class="mi">1000</span>
</code></pre>
<p>The <code>Cache</code> stores jig state and blockchain transactions. By default, it caches 10MB of data in memory. This can be increased by setting <code>run.cache.sizeMB</code>. Alternatively, you can choose to <a href="#advanced-usage-using-run-on-a-server-persist-state">persist state</a> on disk rather than in memory.</p>

<p>After increasing these limits, you may also need to increase Node&#39;s memory limits. If you launch your server by starting node manually, you can increase its memory via: <code>node --max-old-space-size=8192</code>.</p>
<h3 id='tips-and-tricks-using-run-on-a-server-persist-the-cache'>Persist the Cache</h3>
<blockquote>
<p>Save state into a Firestore collection</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Firestore</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">entry</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'state'</span><span class="p">).</span><span class="nx">doc</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">get</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">exists</span><span class="p">)</span> <span class="k">return</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">data</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="nx">async</span> <span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'state'</span><span class="p">).</span><span class="nx">doc</span><span class="p">(</span><span class="nx">key</span><span class="p">).</span><span class="nx">set</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">cache</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Firestore</span><span class="p">()</span> <span class="p">})</span>
</code></pre>
<p>It is a good idea to persist your cache in a database so your backend never needs to load the same jig twice. It is even more important when using multiple servers because you can share this database. Simply implement the <a href="#api-reference-apis-cache">Cache</a> API.</p>

<p>Run will automatically call <code>get</code> on your <code>Cache</code> implementation when values are needed, and <code>set</code> when values are ready to be cached. Cached values will never change for a given key. Just implement these two methods to load and save the cache into your preferred key-value database: Redis, Firestore, DynamoDB, etc.</p>

<p>To the right is an example of persisting in Google Firestore. You may want to tweak it so that it uses an in-memory local cache first and then a fallback to Google Firestore if that misses.</p>
<h3 id='tips-and-tricks-using-run-on-a-server-avoid-race-conditions'>Avoid Race Conditions</h3>
<p>If you are seeing server errors about <code>Missing inputs</code> or <code>txn-mempool-conflict</code>, it is likely that you have encountered a race condition. Two pieces of code are likely attempting to update the same jig at the same time, and are attemping to spend the same Bitcoin outputs. The network can only accept one. To solve this, here are a few recommendations:</p>

<p><strong>Load jigs once at the start</strong>: If you have jigs you are reused across many request handlers, then load those jigs once upon starting your server, rather than loading them each time they are used. This will let Run track the output as a single object, and successive updates on that object will be correctly enqueued.</p>

<p><strong>Separate server, separate purses</strong>: Every Run instance has its own internal update queue, so it is unlikely that the purse will be double-spent on a single server. But on multiple servers, if a purse key is shared, then it is very likely that double-spend errors will occur. To avoid this, use different purse keys on different servers.</p>

<p><strong>Sync after every update</strong>: Call <code>await jig.sync()</code> on jigs after you call a method to be sure that the updates were applied before continuing on.</p>

<p><strong>Serialize risky updates</strong>: If a request handler makes updates to multiple jigs, and these updates can conflict if interleaved across multiple users, then consider serializing these updates. The most reliable approach is to bundle all jig updates together in a <a href="#advanced-usage-batch-transactions">batch</a>, so that the operation is all-or-nothing. An alternative is to put updates into a task queue like <code>p-limit</code>.</p>

<p><strong>Add retry logic</strong>: If the above changes do not fix a race condition, consider adding retry logic.</p>
<h3 id='tips-and-tricks-using-run-on-a-server-load-only-safe-code'>Load Only Safe Code</h3>
<p>Even with sandboxing, arbitrary code has the potential for infinite loops and infinite memory attacks that can take down your server. Avoid running code that you do not trust. You should only add transaction IDs to your trusted set that you know are safe. Also, it is generally not recommended to call <code>run.inventory.sync()</code> on servers, because that will load UTXOs you receive from others.</p>
<h2 id='tips-and-tricks-debugging'>Debugging</h2>
<p>Sometimes you will be faced with errors you don&#39;t understand. Don&#39;t fret! Here are some tips:</p>

<ul>
<li>Grab the latest Run SDK from <a href="https://www.run.network">run.network</a></li>
<li>Redeploy any jigs from older versions of Run</li>
<li>Use Node 10+ or a modern web browser like Chrome, Firefox, Edge, or Safari</li>
<li>Use the mockchain to check that it is not a connection or server-side error</li>
<li>Enable Run&#39;s internal logs by passing <code>{ logger: console }</code> into <code>Run</code></li>
</ul>
<h3 id='tips-and-tricks-debugging-writing-unit-tests'>Writing Unit Tests</h3>
<p>It is always a good idea to write unit tests for your jigs. We recommend using a framework like <code>mocha</code> or <code>jest</code>, and running your tests using the mockchain. The mockchain will be faster and will isolate your Jig logic from any network errors.</p>
<h3 id='tips-and-tricks-debugging-too-long-mempool-chain'>too-long-mempool-chain</h3>
<p>If you see a <code>too-long-mempool-chain</code> error, it means that you&#39;ve hit a BSV network limitation. Today, only 25 transactions may be chained together in each Bitcoin block, and because of how Run works, you are likely to hit this in one of two ways:</p>

<ol>
<li>You update a jig 25 times in a ~10 minute block window</li>
<li>You create ~250 separate jigs in a ~10 minute block window using the same purse</li>
</ol>

<p>For #1, our best advice is to see if you can rearchitect your Jigs to avoid this case. We will provide a built-in solution in the future to avoid this limit.</p>

<p>For #2, we recommend switching between purses. Run automatically splits your UTXOs into 10 pieces, so you usually will be able to make over 200 transactions per block for each purse. You can increase this limit by setting <code>run.purse.splits = 100</code>.</p>
<h3 id='tips-and-tricks-debugging-getting-help'>Getting Help</h3>
<p>Please reach out to @niv in the BSV slack channels. We are happy to help you debug and fix any issues you encounter. If you can, see if you can reproduce the issue in the browser using <code>getting_started.html</code>.</p>
<h1 id='how-it-works'>How It Works</h1><h2 id='how-it-works-overview'>Overview</h2>
<p>A jig is a JavaScript object that Run syncs with the blockchain. All of its code and method calls are stored on-chain in <code>op_return</code> metadata. Run can reconstruct the state of jigs by loading the code and replaying every method call. Every jig is paired with a Bitcoin output and only the owner of that output can make changes to the jig. All updates taken together form a transaction chain that enables consensus through user verification. This design is similar to other Layer-2 UTXO-based token systems because miners don&#39;t verify the JavaScript code. If anyone publishes an incorrect update, it not only destroys the jig but also leaves an immutable record.</p>
<h2 id='how-it-works-transaction'>Transaction</h2>
<blockquote>
<p>Sample code for a transaction</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Dragon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">}</span>

<span class="kr">const</span> <span class="nx">dragon</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dragon</span><span class="p">()</span>
</code></pre>
<p>A transaction in Run is an atomic update to jigs or code.</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Inputs -&gt; Computation -&gt; Outputs</p>

<p>Inputs are the jigs and code which will be updated. Computation is stored as executable statements in an <code>op_return</code>. The Run Virtual Machine executes these statements and produces outputs which are the jigs and code updated or created fresh. There may also be payment inputs and outputs too that are not used by Run but part of the transaction. Here is the transaction format for the example to the right:</p>

<table><thead>
<tr>
<th>Inputs</th>
<th>Outputs</th>
</tr>
</thead><tbody>
<tr>
<td>1. payment</td>
<td>1. op_return: Run metadata</td>
</tr>
<tr>
<td></td>
<td>2. p2pkh: Dragon Class</td>
</tr>
<tr>
<td></td>
<td>3. p2pkh: dragon jig instance</td>
</tr>
<tr>
<td></td>
<td>4. change output for payment</td>
</tr>
</tbody></table>

<blockquote>
<p>Inspecting Run metadata</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">rawtx</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">txid</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">metadata</span> <span class="o">=</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">metadata</span><span class="p">(</span><span class="nx">rawtx</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">metadata</span><span class="p">)</span>
</code></pre>
<p>The <code>op_return</code> data is made up of both push data and a JSON payload. It has the following structure:</p>

<p><code>[op_false] [op_return] &#39;run&#39; &lt;version&gt; &#39;&lt;app-id&gt;&#39; &#39;&lt;json-payload&gt;&#39;</code></p>

<ul>
<li>Each data field starts with an <code>op_push</code> specifying its length.</li>
<li>The protocol version is currently 0x05.</li>
<li>The <code>app-id</code> field enables applications to identify their Run transactions.</li>
<li>Strings are UTF-8 encoded.</li>
<li><code>[op_false] [op_return]</code> is the standard prefix for metadata on Bitcoin SV since the Quasar hard fork.</li>
</ul>

<p>You can easily identify Run transactions and its outputs using the <code>op_return</code> metadata.</p>
<h2 id='how-it-works-json-payload'>JSON Payload</h2>
<blockquote>
<p>Sample JSON payload</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="p">{</span>
    <span class="s2">"in"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">"ref"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"native://Jig"</span>
    <span class="p">],</span>
    <span class="s2">"out"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"e494cd3d0c33615620c22f44cddf85f2bf613fd608dbfc53822664581205d198"</span><span class="p">,</span>
        <span class="s2">"9a99596f417e8925cb25f2acf99abe28f014aaad47ce93c427ee3afd3bcc5084"</span>
    <span class="p">],</span>
    <span class="s2">"del"</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">"cre"</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">"mhhHzeLjRTD4cjuygJFjqmCHCFpDKGrp75"</span><span class="p">,</span>
        <span class="s2">"mhhHzeLjRTD4cjuygJFjqmCHCFpDKGrp75"</span>
    <span class="p">],</span>
    <span class="s2">"exec"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"op"</span><span class="p">:</span> <span class="s2">"DEPLOY"</span><span class="p">,</span>
            <span class="s2">"data"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"class Dragon extends Jig { }"</span><span class="p">,</span> <span class="p">{</span> <span class="s2">"deps"</span><span class="p">:</span> <span class="p">{</span> <span class="s2">"Jig"</span><span class="p">:</span> <span class="p">{</span> <span class="s2">"$jig"</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">"op"</span><span class="p">:</span> <span class="s2">"NEW"</span><span class="p">,</span>
            <span class="s2">"data"</span><span class="p">:</span> <span class="p">[{</span> <span class="s2">"$jig"</span><span class="p">:</span> <span class="mi">1</span> <span class="p">},</span> <span class="p">[]]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre>
<p>The JSON payload stores Run-specific metadata. To the right is a JSON payload for the example above. Its fields are:</p>

<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>in</td>
<td>Number of jig and code inputs</td>
</tr>
<tr>
<td>ref</td>
<td>Array of references to jigs and code used by not spent</td>
</tr>
<tr>
<td>out</td>
<td>State hashes of jigs and code in transaction outputs</td>
</tr>
<tr>
<td>del</td>
<td>State hashes of jigs and code deleted</td>
</tr>
<tr>
<td>cre</td>
<td>New owners of jigs and code created</td>
</tr>
<tr>
<td>exec</td>
<td>Statements to execute on the jigs</td>
</tr>
</tbody></table>

<p>The <code>exec</code> field in particular contains the statements for Run to execute. There are 4 opcodes supported by Run in 0.6:</p>

<table><thead>
<tr>
<th>Opcode</th>
<th>Description</th>
<th>Data Format</th>
</tr>
</thead><tbody>
<tr>
<td>DEPLOY</td>
<td>Upload new code</td>
<td><code>[&lt;src1&gt;, &lt;props1&gt;, &lt;src2&gt;, &lt;props2&gt;, ...]</code></td>
</tr>
<tr>
<td>NEW</td>
<td>Instantiate a jig</td>
<td><code>[&lt;jig class&gt;, &lt;args&gt;]</code></td>
</tr>
<tr>
<td>CALL</td>
<td>Call a method on a jig</td>
<td><code>[&lt;jig&gt;, &lt;method&gt;, &lt;args&gt;]</code></td>
</tr>
<tr>
<td>UPGRADE</td>
<td>Replace code with new code</td>
<td><code>[&lt;code&gt;, &lt;src&gt;, &lt;props&gt;]</code></td>
</tr>
</tbody></table>

<p>The state hashes used in the <code>out</code> and <code>del</code> arrays are calculated by taking the sha-256 of the JSON serialization of the jigs. This state cache format will also be documented soon.  Finally, the Run VM provides certain <em>native</em> classes, like <code>Jig</code> and <code>Code</code>, that are built-in to its virtual machine. Eventually this virtual machine will be stored on-chain too ensuring total trustlessness.</p>

<p>The protocol will be documented more in a coming spec. Reach out for any questions!</p>
<h2 id='how-it-works-serialization'>Serialization</h2>
<blockquote>
<p>Pass a sidekick object in by value</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Person</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">creationDate</span><span class="p">,</span> <span class="nx">profilePicture</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">creationDate</span> <span class="o">=</span> <span class="nx">creationDate</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">profilePicture</span> <span class="o">=</span> <span class="nx">profilePicture</span>
    <span class="p">}</span>

    <span class="nx">valid</span><span class="p">()</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">class</span> <span class="nx">SocialGroup</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">members</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">}</span>

    <span class="nx">add</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">person</span><span class="p">).</span><span class="nx">toBeInstanceOf</span><span class="p">(</span><span class="nx">Person</span><span class="p">)</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">person</span><span class="p">.</span><span class="nx">valid</span><span class="p">()).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">members</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">SocialGroup</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">Person</span><span class="p">,</span> <span class="nx">expect</span> <span class="p">}</span>

<span class="kr">const</span> <span class="nx">group</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SocialGroup</span><span class="p">()</span>

<span class="nx">group</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">Person</span><span class="p">(</span><span class="s1">'Li'</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span> <span class="kc">null</span><span class="p">))</span>
</code></pre>
<p>Every jig, every argument to a method, and every static property of a class, must be serialized so that it can be restored later. Run uses a custom serialization format that is similar to JSON. The following data types are supported:</p>

<ul>
<li>Numbers (IEEE-754)</li>
<li>Strings (UTF-8)</li>
<li>Booleans</li>
<li>Objects (Basic and Sidekicks)</li>
<li>Null and Undefined</li>
<li>Arrays</li>
<li>Uint8Arrays</li>
<li>Maps</li>
<li>Sets</li>
<li>Jigs</li>
<li>Code</li>
<li>Berries</li>
</ul>

<p>All JavaScript IEEE 754 numbers types are serializable, including Infinity, NaN, and -0. Properties may be safely set on Sets, Maps, and Arrays, including any of the above types. Circular references are OK. </p>

<p>Symbols are not however serializable and will not be supported. Other JavaScript objects that are not currently supported include Date, WeakMap, Promise, Error, Float32Array, and BigInt.</p>

<p><em>Sidekick objects</em> are JavaScript objects whose constructor is a sidekick class. Whereas jigs have blockchain locations and owners, and Run enforces that their state progresses from their method calls, sidekick objects are much simpler. They are stored by-value in their current state. A lock instance is an example of a sidekick object. In effect, they are data blobs with methods from on-chain code.</p>
<h2 id='how-it-works-sandboxing'>Sandboxing</h2>
<p>All Code is sandboxed so that it does not have access to your application code, including your private keys! This provides security and also determinism when replaying a jig&#39;s history because a jig should evaluate the same in every environment. Run uses <a href="https://github.com/Agoric/ses-shim">Agoric SES</a>, the gold standard in secure JavaScript evalution, combined with the <code>vm</code> library in node and hidden <code>iframes</code> in the browser, to perform this sandboxing. Despite this, it is recommended you avoid running untrusted code.</p>
<h2 id='how-it-works-safety-checks'>Safety Checks</h2>
<p>Run also protects you from performing updates on your jigs that will not be valid by others. For example, Run will throw an error if you try to change a property on a jig directly rather than call a method, or if you attempt to set a function as a property on a jig. Only top-level method calls may change a jig&#39;s state which is also enforced by Run. In addition, every Run transaction is pre-verified before it is published on your local machine.</p>
<h2 id='how-it-works-ownership-rules'>Ownership Rules</h2>
<p>Jigs are special objects that have ownership rules which Run enforces. These include:</p>

<ul>
<li>Ownership grants the right to change the jig’s state through an action.</li>
<li>Ownership grants the right to create new jigs from the jig, where those new jigs have the same owner as the creator jig.</li>
<li>Ownership grants the right to enact actions on other jigs from the jig that change the states of those other jigs, as long as the owners of those changed jigs approve.</li>
</ul>

<p>Likewise, without ownership, the above actions cannot be performed. Proving ownership requires spending a Bitcoin output, so when ownership changes on a jig, further updates to that jig must occur in a new transaction. There is also a fourth rule of ownership that is a right granted to all jigs:</p>

<ul>
<li>A jig may reference or read the state of another jig with or without its owner’s approval.</li>
</ul>
<h2 id='how-it-works-privacy'>Privacy</h2>
<p>All jigs and jig code are stored on-chain and are open for everyone to read. This enables anyone to reconstruct the state of any jig. Privacy is achieved similar to Bitcoin UTXOs. For maximum privacy, public keys should not be re-used. In the future, we will introduce <em>private jigs</em> that are visible only to the current owners, but by their nature, they will not work as well with explorers, analytics and other services.</p>
<h2 id='how-it-works-backwards-compatibility'>Backwards Compatibility</h2>
<p>Starting in Run 0.6, which uses protocol 0x05, all jigs will be backwards-compatible. This means jigs you launch today will always be supported into the future by the Run library. This is our promise and we have taken multiple steps to ensure it. Every jig is connected to its protocol version, so as Run is updated, older jigs can be kept operational with their original behavior. In addition, we run tests on on-chain jigs with every update to ensure that your jigs continue to work.</p>
<h1 id='api-reference'>API Reference</h1><h2 id='api-reference-run'>Run</h2>
<p><code>class Run { ... }</code></p>

<p>A Run instance coordinates activity between the application, its jigs and other creations, and the blockchain. You always create a Run instance when you use the Run library. This stores your settings, creates and signs transactions, loads jigs and code, connects to the blockchain network, securely sandboxes code, keeps an inventory of jigs, keeps a cache for fast loads, and more.</p>

<aside class="notice">
<b>Note:</b> You may create multiple Run instances, but there is only ever one <i>active</i> Run instance at a time, which is by default the last instance created. The active Run instance is the one whose configuration is being used.
</aside>
<h3 id='api-reference-run-constructor-options'>constructor(options)</h3>
<blockquote>
<p>Create a Run instance on Mocknet. The purse will be auto-funded.</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">network</span><span class="p">:</span> <span class="s1">'mock'</span> <span class="p">})</span>
</code></pre>
<blockquote>
<p>Create a run instance on Testnet</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Create a run instance on testnet</span>
<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span>
  <span class="na">network</span><span class="p">:</span> <span class="s1">'test'</span><span class="p">,</span>
  <span class="na">owner</span><span class="p">:</span> <span class="s1">'cTMHbJULREfbsUFsuJLMrNbJ7VrASgWeYfFF6EgJMy49ARnNed3d'</span><span class="p">,</span>
  <span class="na">purse</span><span class="p">:</span> <span class="s1">'cQP1h2zumWrCr2zxciuNeho61QUGtQ4zBKWFauk7WEhFb8kvjRTh'</span>
<span class="p">})</span>
</code></pre>
<p><code>constructor(options: object): Run</code></p>

<p>Creates a new Run instance.</p>

<p>The constructor takes many possible options, but the three most important options are <code>network</code>, <code>owner</code>, and <code>purse</code>. The network indicates which Bitcoin network to connect to. The <code>owner</code> and the <code>purse</code> are generally both private keys. The <code>owner</code> stores the user&#39;s jigs. Each live jig has a UTXO associated with it assigned to the owner&#39;s address. The <code>purse</code> is a separate private key used to pay the mining fees for Run transactions. It is best if the <code>owner</code> and <code>purse</code> are separate accounts so that jigs and money are kept in different wallets.</p>

<p>Creating a new <code>Run</code> instance will automatically activate it. See <code>run.activate()</code> for more information.</p>
<h4 id='api-reference-run-constructor-options-options'>Options</h4>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>api</code></td>
<td>string</td>
<td>One of &#39;run&#39;, &#39;mattercloud&#39;, or &#39;whatsonchain&#39;</td>
<td>&#39;run&#39;</td>
</tr>
<tr>
<td><code>apiKey</code></td>
<td>string</td>
<td>Blockchain API key for MatterCloud or WhatsOnChain.</td>
<td>undefined</td>
</tr>
<tr>
<td><code>app</code></td>
<td>string</td>
<td>Application id to distinguish Run transactions. See <a href="#how-it-works">How It Works</a>.</td>
<td>Empty string</td>
</tr>
<tr>
<td><code>blockchain</code></td>
<td><code>Blockchain</code></td>
<td>Blockchain implementation for interacting with the Bitcoin network. If specified, then <code>network</code>, <code>api</code>, and <code>apiKey</code> are ignored.</td>
<td><code>RunConnect</code></td>
</tr>
<tr>
<td><code>cache</code></td>
<td><code>Cache</code></td>
<td>Cache API implementation that Run will use instead of the default</td>
<td><code>LocalCache</code> or  <code>BrowserCache</code></td>
</tr>
<tr>
<td><code>client</code></td>
<td>boolean</td>
<td>Whether to only load jigs from the cache and not replay transactions</td>
<td>false</td>
</tr>
<tr>
<td><code>logger</code></td>
<td><code>Logger</code></td>
<td>Logging object for internal run messages. If <code>logger</code> is null, then nothing will be logged. You may pass <code>console</code> as the logger to log everything.</td>
<td>Logs warnings and errors to the console</td>
</tr>
<tr>
<td><code>network</code></td>
<td>string</td>
<td>Bitcoin network, either <code>main</code>, <code>test</code>, <code>stn</code>, or <code>mock</code>.</td>
<td><code>main</code></td>
</tr>
<tr>
<td><code>networkTimeout</code></td>
<td>number</td>
<td>Timeout for network requests in milliseconds</td>
<td>10000</td>
</tr>
<tr>
<td><code>networkRetries</code></td>
<td>number</td>
<td>Number of times to retry network requests</td>
<td>2</td>
</tr>
<tr>
<td><code>owner</code></td>
<td>string or <code>Owner</code></td>
<td>Private key, public key, address, or <a href="#advanced-usage-locks">custom lock</a> used to own jigs and sign transactions</td>
<td>Randomly generated <code>LocalOwner</code></td>
</tr>
<tr>
<td><code>purse</code></td>
<td>string or <code>Purse</code></td>
<td>Private key or <code>Purse</code> API used to pay for transactions. On the mock network, the purse will be funded automatically. For other networks, the user must fund the purse.</td>
<td>Randomly generated <code>LocalPurse</code></td>
</tr>
<tr>
<td><code>timeout</code></td>
<td>number</td>
<td>Timeout for all Run actions in milliseconds</td>
<td>30000</td>
</tr>
<tr>
<td><code>trust</code></td>
<td><code>Array&lt;string&gt;</code> or &#39;*&#39;</td>
<td>IDs of transactions whose code is known not to be malicious</td>
<td>Empty array</td>
</tr>
<tr>
<td><code>wallet</code></td>
<td><code>Owner</code> and <code>Purse</code></td>
<td>A shorthand for a single object that implements both <code>Owner</code> and <code>Purse</code>. If specified, then <code>owner</code> and <code>purse</code> are ignored.</td>
<td>undefined</td>
</tr>
</tbody></table>
<h3 id='api-reference-run-activate'>activate()</h3>
<p><code>activate()</code></p>

<p>Sets this instance to <code>Run.instance</code>, the active <code>Run</code> instance. All jig instantiations, updates, and class deployments will occur on the active run instance. The owner of this instance will sign transactions and its blockchain and purse are the ones which will be used. <code>activate()</code> will also assign <code>bsv.Networks.defaultNetwork</code> to be the active Run&#39;s network configuration. </p>
<h3 id='api-reference-run-deploy-code'>deploy(code)</h3>
<blockquote>
<p>Upload a BigInteger class to the blockchain</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">BigInteger</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">BigInteger</span><span class="p">)</span>

<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
</code></pre>
<p><code>deploy(T: function): Code</code></p>

<p>Uploads code to the blockchain. Once deployment completes, the class or function will be assigned a <code>location</code> so that it may be downloaded later. It will also be assigned an <code>origin</code> and <code>owner</code>. <code>deploy</code> also sandboxes the class or function and returns it as <a href="#api-reference-code">Code</a> with special <code>Code</code> methods. Code uploaded does not necessarily need to be a Jig class — any class or function will work.</p>
<h3 id='api-reference-run-import-rawtx-options'>import(rawtx, options)</h3>
<blockquote>
<p>Import a Run transaction to update it</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="kr">import</span><span class="p">(</span><span class="nx">rawtx</span><span class="p">)</span>

<span class="nx">tx</span><span class="p">.</span><span class="nx">update</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">AnotherClass</span><span class="p">))</span>

<span class="kr">const</span> <span class="nx">updated</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">tx</span><span class="p">.</span><span class="kr">export</span><span class="p">()</span>
</code></pre>
<p><code>import(rawtx: string, options: ?object): Promise&lt;Transaction&gt;</code></p>

<p>Imports a Bitcoin transaction into a <a href="#api-reference-transaction">Run.Transaction</a> object that can be updated.</p>
<h4 id='api-reference-run-import-rawtx-options-options'>Options</h4>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>trust</code></td>
<td>boolean</td>
<td>Whether to automatically trust the transaction being imported</td>
<td>false</td>
</tr>
</tbody></table>
<h3 id='api-reference-run-load-location-options'>load(location, options)</h3>
<blockquote>
<p>Load a particular jig</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">ticketLocation</span> <span class="o">=</span> <span class="s1">'afc557ef2970af0b5fb8bc1a70a320af425c7a45ca5d40eac78475109563c5f8_o1'</span>
<span class="kr">const</span> <span class="nx">ticket</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">ticketLocation</span><span class="p">)</span>
</code></pre>
<blockquote>
<p>Load a code creation</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">classLocation</span> <span class="o">=</span> <span class="s1">'e4a9618d3a187448feeb95ff30f7ec6381a025316cdcae2cdf388ad3de7fab6f_o2'</span>
<span class="kr">const</span> <span class="nx">MyClass</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">classLocation</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyClass</span><span class="p">()</span>
</code></pre>
<p><code>load(location: string, options: ?object): Promise&lt;Creation&gt;</code></p>

<p>Universal load method to load any creation including jigs objects, jig classes, sidekick code, berries, and more. You pass in an on-chain <code>location</code>. The <code>location</code> is generally a transaction id and output index pair. This string should usually be the jig&#39;s or class&#39;s last known <code>location</code> property. However, it is also possible to load jigs at any state in the past using other <code>location</code>s, although these will be read-only. Downloaded code will be safely sandboxed before being returned.</p>
<h4 id='api-reference-run-load-location-options-options'>Options</h4>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>trust</code></td>
<td>boolean</td>
<td>Whether to automatically trust the transaction being imported</td>
<td>false</td>
</tr>
</tbody></table>
<h3 id='api-reference-run-sync'>sync()</h3>
<blockquote>
<p>Wait for all jigs to deploy and classes to upload before continuing</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">MyClass</span> <span class="p">{</span> <span class="p">}</span>
<span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">MyClass</span><span class="p">)</span>

<span class="kr">class</span> <span class="nx">MyObject</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">}</span>
<span class="kr">const</span> <span class="nx">jig</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyObject</span><span class="p">()</span>

<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'jig origin'</span><span class="p">,</span> <span class="nx">jig</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'class origin'</span><span class="p">,</span> <span class="nx">MyClass</span><span class="p">.</span><span class="nx">origin</span><span class="p">)</span>
</code></pre>
<p><code>sync(): Promise&lt;void&gt;</code></p>

<p>Returns a promise that completes when all pending transactions are published. After this completes, all jigs and classes will be assigned <code>location</code>s. Note: This method will not update the inventory with newly received UTXOs. For that, call <code>run.inventory.sync()</code>.</p>

<aside class="notice">
<b>Note:</b> If a pending transaction fails to publish, that transaction and all subsequent transactions are reverted and the sync throws an error.
</aside>
<h3 id='api-reference-run-transaction-f'>transaction(f)</h3>
<blockquote>
<p>Send two tokens and deploy a class all in the same transaction</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">token1</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">address</span><span class="p">)</span>
  <span class="nx">token2</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">address</span><span class="p">)</span>
  <span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">Trophy</span><span class="p">)</span>
<span class="p">})</span>
</code></pre>
<p><code>transaction(f: function): any</code></p>

<p>Shorthand for creating a new transaction, calling update with the function passed, and then calling publish.</p>
<h3 id='api-reference-run-trust-txid'>trust(txid)</h3>
<blockquote>
<p>Trust a third-party transaction before loading its code</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">codeTxId</span> <span class="o">=</span> <span class="nx">codeLocation</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>
<span class="nx">run</span><span class="p">.</span><span class="nx">trust</span><span class="p">(</span><span class="nx">codeTxId</span><span class="p">)</span>

<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">codeLocation</span><span class="p">)</span>
</code></pre>
<p><code>trust(txid: string)</code></p>

<p>Adds a transaction to the trusted set. By default, code that is not in the trusted set cannot be loaded.</p>
<h3 id='api-reference-run-app'>app</h3>
<p><code>app: string</code></p>

<p>An application ID to distinguish Run transactions. Application developers may wish to set this in <code>Run</code>&#39;s constructor in order to find their specific transactions in third-party tools and analytics, like <a href="https://trends.cash">trends.cash</a> or <a href="https://www.whatsonchain.com">WhatsOnChain</a>. This string will be UTF-8 encoded and stored in the 5th chunk of the <code>op_return</code> script. For more details about the protocol, see <a href="#how-it-works">How It Works</a>.</p>

<aside class="warning">
<b>Warning:</b> Anyone may set the <code>app</code> string to any value, including yours, so <code>app</code> is not a secure way to identify your app's transactions.
</aside>
<h3 id='api-reference-run-blockchain'>blockchain</h3>
<blockquote>
<p>Download a transaction from the blockchain</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">txid</span> <span class="o">=</span> <span class="s1">'afc557ef2970af0b5fb8bc1a70a320af425c7a45ca5d40eac78475109563c5f8'</span>
<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">txid</span><span class="p">)</span>
</code></pre>
<p><code>blockchain: Blockchain</code></p>

<p>Blockchain API to access the bitcoin network. See the <a href="#api-reference-apis-blockchain">Blockchain</a> API. You may change the blockchain anytime.</p>
<h3 id='api-reference-run-cache'>cache</h3>
<p><code>cache: Cache</code></p>

<p>Cache API used to save and load existing state. You may change the cache anytime.</p>
<h3 id='api-reference-run-inventory'>inventory</h3>
<p><code>inventory: Inventory</code></p>

<p><a href="#api-reference-plugins-inventory">Inventory</a> that tracks creations owned by the current owner. This is reset whenever the Run <code>owner</code> changes.</p>
<h3 id='api-reference-run-logger'>logger</h3>
<p><code>logger: Logger</code></p>

<p><a href="#api-reference-apis-logger">Logger</a> implementation that prints out Run information. You may change the logger anytime.</p>
<h3 id='api-reference-run-owner'>owner</h3>
<p><code>owner: Owner</code></p>

<p>The owner object used to update jigs and approve transactions. See the <a href="#api-reference-apis-owner">Owner</a> API. You may change the owner anytime.</p>
<h3 id='api-reference-run-purse'>purse</h3>
<p><code>purse: Purse</code></p>

<p>The purse used to pay for transactions. You may change the purse anytime.</p>
<h3 id='api-reference-run-timeout'>timeout</h3>
<p><code>timeout: number</code></p>

<p>Timeout for all Run actions in milliseconds. This applies to <code>load()</code>, <code>sync()</code>, <code>import()</code> and the inventory&#39;s <code>sync()</code>. If set to Infinity, then there is no timeout.</p>
<h3 id='api-reference-run-static-jig'>static Jig</h3>
<blockquote>
<p>Create a custom jig that extends the Jig base class</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">MyObject</span> <span class="kr">extends</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">Jig</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre>
<p><code>static Jig: Jig</code></p>

<p><code>Jig</code> class that is common for all <code>Run</code> instances. It is set as <code>Jig</code> at the global scope. You must extend from this base class to create a jig. See <a href="#api-reference-jig">Jig</a>.</p>
<h3 id='api-reference-run-static-code'>static Code</h3>
<p><code>static Code: Code</code></p>

<p><code>Code</code> base class that all deployed classes or functions inherit from. See <a href="#api-reference-code">Code</a>.</p>
<h3 id='api-reference-run-static-berry'>static Berry</h3>
<p><code>static Berry: Berry</code></p>

<p><code>Berry</code> base class that defines a method for loading third-party data and its structure. See <a href="#api-reference-berry">Berry</a>.</p>
<h3 id='api-reference-run-static-creation'>static Creation</h3>
<p><code>static Creation: Creation</code></p>

<p><code>Creation</code> base class that jigs, code, and berries all share. See <a href="#api-reference-creation">Creation</a>.</p>
<h3 id='api-reference-run-static-transaction'>static Transaction</h3>
<p><code>static Transaction: Transaction</code></p>

<p><code>Transaction</code> class used to manually create, update, and inspect Run transactions. See <a href="#api-reference-transaction">Transaction</a>.</p>
<h3 id='api-reference-run-static-plugins'>static plugins</h3>
<p><code>static plugins: object</code></p>

<p>Contains the plugins that ship with Run and may be used to configure Run. See <a href="#api-reference-plugins">Plugins</a></p>
<h3 id='api-reference-run-static-extra'>static extra</h3>
<p><code>static extra: object</code></p>

<p>Contains the standard library of code jigs that ship with Run. See <a href="#api-reference-extras">Extras</a>.</p>
<h3 id='api-reference-run-static-api'>static api</h3>
<p><code>static api: object</code></p>

<p>An object that contains all plugin APIs that a user may implement. See <a href="#api-reference-apis">APIs</a>.</p>
<h3 id='api-reference-run-static-util'>static util</h3>
<p><code>static util: object</code></p>

<p>Various utility functions and classes. See <a href="#api-reference-util">Util</a></p>
<h3 id='api-reference-run-static-configure-env-network'>static configure(env, network)</h3>
<blockquote>
<p>Configure Run from the command line</p>
</blockquote>
<pre class="highlight plaintext"><code>Run.configure(process.env)
</code></pre>
<p><code>static configure(env: object, network: ?string)</code></p>

<p>Configures Run&#39;s defaults with the provided environment object. This is typically <code>process.env</code>. This provides an easy way for apps to setup Run from the shell. When <code>Run</code> is instantiated, it will use these settings as defaults.</p>

<p>The network parameter is optional. If specified, it overrides the value in the environment variables. Run will pick the <code>PURSE</code> and <code>OWNER</code> keys for that specific network.</p>
<h4 id='api-reference-run-static-configure-env-network-environment-variables'>Environment variables</h4>
<table><thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Possible Values</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><strong>APP</strong></td>
<td>App string provided to Run</td>
<td>your app string</td>
<td><code>&#39;&#39;</code></td>
</tr>
<tr>
<td><strong>LOGGER</strong></td>
<td>Whether to log internal messages to the console</td>
<td><code>true</code>, <code>false</code>, <code>debug</code></td>
<td><code>false</code></td>
</tr>
<tr>
<td><strong>NETWORK</strong></td>
<td>Network string</td>
<td><code>mock</code>, <code>main</code>, <code>test</code>, <code>stn</code></td>
<td><code>mock</code></td>
</tr>
<tr>
<td><strong>PURSE</strong></td>
<td>Purse key used</td>
<td>your string privkey</td>
<td><code>undefined</code></td>
</tr>
<tr>
<td><strong>PURSE_[network]</strong></td>
<td>Purse key used on a specific network</td>
<td>your string privkey</td>
<td><code>undefined</code></td>
</tr>
<tr>
<td><strong>OWNER</strong></td>
<td>Owner key used</td>
<td>your string privkey</td>
<td><code>undefined</code></td>
</tr>
<tr>
<td><strong>OWNER_[network]</strong></td>
<td>Owner key used on a specific network</td>
<td>your string privkey</td>
<td><code>undefined</code></td>
</tr>
<tr>
<td><strong>API</strong></td>
<td>Blockchain API when using mainnet or testnet</td>
<td><code>run</code>, <code>mattercloud</code>, <code>whatsonchain</code></td>
<td><code>run</code></td>
</tr>
<tr>
<td><strong>APIKEY</strong></td>
<td>API key for the blockchain API</td>
<td>your string api key</td>
<td><code>undefined</code></td>
</tr>
<tr>
<td><strong>APIKEY_[api]</strong></td>
<td>API key used with a specific API</td>
<td>your string api key</td>
<td><code>undefined</code></td>
</tr>
</tbody></table>
<h3 id='api-reference-run-static-protocol'>static protocol</h3>
<p><code>static version: number</code></p>

<p>The version number of the Run protocol. Jigs that you deploy will be tied to a particular protocol. Jigs and other creations deployed using protocol v5 and above and guaranteed to be supported in the future.</p>
<h3 id='api-reference-run-static-version'>static version</h3>
<p><code>static version: string</code></p>

<p>Semantic version of the Run library.</p>
<h3 id='api-reference-run-static-instance'>static instance</h3>
<p><code>static instance: Run</code></p>

<p>The currently active <code>Run</code> instance. All jig instantiations, updates, and class deployments will occur on the active run instance. The owner of that instance will sign transactions and its blockchain and purse are the ones which will be used. You may change the active Run instance either by calling <code>run.activate()</code> or by creating a new <code>Run</code> instance.</p>
<h2 id='api-reference-jig'>Jig</h2>
<p><code>class Jig extends Creation { ... }</code></p>

<p>Base class for objects and code that can be <em>owned</em> on the blockchain and <em>updated</em> by calling methods. Jigs have various internal rules that ensure they are able to be safely composed together and called from each other. All classes that extend from <code>Jig</code> are themselves jigs as well as Code. Jigs are also <a href="#api-reference-creation">Creation</a>s and have <code>location</code>, <code>origin</code>, and <code>nonce</code> properties.</p>
<h3 id='api-reference-jig-init'>init()</h3>
<blockquote>
<p>Simple jig that takes two parameters in its constructor</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">SimpleStore</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">a</span> <span class="o">=</span> <span class="nx">a</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SimpleStore</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">store</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span> <span class="c1">// prints 2</span>
</code></pre>
<p><code>init()</code></p>

<p>The initialization method for jig objects. <code>init()</code> is to jigs as <code>constructor()</code> is to normal classes. Run will call init automatically when the class is instantiated, just like constructors, and <code>init()</code> cannot be called directly by users. You may pass parameters into <code>init()</code> and also call <code>super.init()</code> to call its parent initializer.</p>

<aside class="notice">
<b>Note:</b> Jigs are not allowed to have a <code>constructor()</code> method for security reasons. <code>init()</code> is used instead.
</aside>
<h3 id='api-reference-jig-sync-options'>sync(options)</h3>
<p><code>sync(options: ?object): Promise&lt;Jig&gt;</code></p>

<p>Synchronizes the jig object with the blockchain. If there are any pending transactions for this jig to publish, this method will wait for them to broadcast. If there are no pending transactions, then this method will update the jig and any internally-referenced jigs to their latest states on the blockchain.</p>

<p>This method supports two options: <code>forward</code> and <code>inner</code>. If you pass <code>{ forward: false }</code>, then only pending transactions will be published and new updates will not be downloaded. This may be useful for performance reasons or if the Blockchain API does not support forward syncing, as is the case with WhatsOnChain. If you pass <code>{ inner: false }</code>, then only the current jig will be updated and any internally-referenced creations will not be explicitly updated.</p>
<h4 id='api-reference-jig-sync-options-options'>Options</h4>
<table><thead>
<tr>
<th>Property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>forward</code></td>
<td>Whether to sync the jig forward to its latest on-chain state</td>
<td>undefined</td>
</tr>
<tr>
<td><code>inner</code></td>
<td>Whether to also sync any referenced creations</td>
<td>undefined</td>
</tr>
</tbody></table>
<h3 id='api-reference-jig-destroy'>destroy()</h3>
<p><code>destroy(): Jig</code></p>

<p>Destroys the jig. The destroyed jig will acquire a final location that ends with <code>_dN</code>, where N is the index of the destroyed jig in its final transaction. This location is uniquely identifiable and the jig may still be referenced. However, it can no longer be updated. You may override the <code>destroy()</code> method to perform custom destroy behavior.</p>
<h3 id='api-reference-jig-auth'>auth()</h3>
<p><code>auth(): Jig</code></p>

<p>Proves ownership over the current jig by spending its output in a transaction. You may override the <code>auth()</code> method.</p>
<h3 id='api-reference-jig-static-load-location'>static load(location)</h3>
<blockquote>
<p>Load a jig</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">Message</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">'4e146ac161324ef0b388798462867c29ad681ef4624ea4e3f7c775561af3ddd0_o1'</span><span class="p">)</span>
</code></pre>
<p><code>static load(location: string): Promise&lt;Berry&gt;</code></p>

<p>Loads a jig object that is an instance of the particular jig class. This is an alternative to <code>run.load()</code> for when you know the type of jig to load. This method is accessible when loading berries unlike <code>run.load()</code>.</p>
<h2 id='api-reference-code'>Code</h2>
<p><code>class Code extends Creation { ... }</code></p>

<p><code>Code</code> is the base class for classes and functions deployed on-chain. Unlike <code>Jig</code> however, you do not need to extend from Code yourself. When you call <code>run.deploy</code> on a class or function, the returned sandboxed code is a <code>Code</code> instance that gets all the functions and properties below. This lets you to upgrade, send and destroy code just like object jigs! All code are also <a href="#api-reference-creation">Creation</a>s and have <code>location</code>, <code>origin</code>, and <code>nonce</code> properties.</p>

<p>There are two kinds of <code>Code</code>: jig code and sidekick code. Jig code are classes that extend from <code>Jig</code> and behave just like jig objects, meaning their methods are protected and static function calls can update their state. Sidekick code are functions or classes that do not extend from Jig, and cannot be updated in that way over time. Sidekick code has no special rules unlike jigs and so is better suited for helper code. The Code base class is available via <code>Run.Code</code>. Both jig code and sidekick code however may be upgraded, destroyed, and signed.</p>
<h3 id='api-reference-code-sync-options'>sync(options)</h3>
<p><code>sync(options: ?object): Promise&lt;Code&gt;</code></p>

<p>Synchronizes code with the blockchain. If there are any pending transactions to publish, this method will wait for them to broadcast. If there are no pending transactions, then this method will update the code and any internally-referenced creations to their latest states on the blockchain.</p>

<p>This method supports two options: <code>forward</code> and <code>inner</code>. If you pass <code>{ forward: false }</code>, then only pending transactions will be published and new updates will not be downloaded. This may be useful for performance reasons or if the Blockchain API does not support forward syncing, as is the case with WhatsOnChain. If you pass <code>{ inner: false }</code>, then only the current jig will be updated and any internally-referenced creations will not be explicitily updated.</p>
<h4 id='api-reference-code-sync-options-options'>Options</h4>
<table><thead>
<tr>
<th>Property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>forward</code></td>
<td>Whether to sync the code forward to its latest on-chain state</td>
<td>undefined</td>
</tr>
<tr>
<td><code>inner</code></td>
<td>Whether to also sync any referenced creations</td>
<td>undefined</td>
</tr>
</tbody></table>
<h3 id='api-reference-code-destroy'>destroy()</h3>
<blockquote>
<p>Destroy a token class during deploy to stop future mints</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">GiftCard</span> <span class="kr">extends</span> <span class="nx">Token</span> <span class="p">{</span> <span class="p">}</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">GiftCard</span><span class="p">.</span><span class="nx">mint</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
  <span class="nx">GiftCard</span><span class="p">.</span><span class="nx">destroy</span><span class="p">()</span>
<span class="p">})</span>
</code></pre>
<p><code>destroy(): Code</code></p>

<p>Destroys the code so that it cannot be updated in the future. The destroyed code will acquire a final location that ends with <code>_dN</code>, where N is the index of the destroyed code in its final transaction. This location is uniquely identifiable and the code may still be referenced and instantiated. However, it may no longer be updated.</p>
<h3 id='api-reference-code-auth'>auth()</h3>
<blockquote>
<p>Enforce that only the owner of a jig class may create instances</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Coin</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">Coin</span><span class="p">.</span><span class="nx">auth</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p><code>auth(): Code</code></p>

<p>Proves ownership over the current code by spending its output in a transaction.</p>
<h3 id='api-reference-code-upgrade-t'>upgrade(T)</h3>
<blockquote>
<p>Upgrade a jig class to add a new method</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">DragonCode</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">classLocation</span><span class="p">)</span>

<span class="kr">class</span> <span class="nx">Dragon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">setName</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span> <span class="p">}</span>
  <span class="nx">setAge</span><span class="p">(</span><span class="nx">age</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="nx">age</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nx">DragonCode</span><span class="p">.</span><span class="nx">upgrade</span><span class="p">(</span><span class="nx">Dragon</span><span class="p">)</span>

<span class="nx">await</span> <span class="nx">DragonCode</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
</code></pre>
<p><code>upgrade(T: function)</code></p>

<p>Replaces the code with new behavior. With great power comes great responsibility. This method can completely change the behavior not just of the class but of any instances. It is best to use this feature to make bug fixes but not major changes. Once you are confident in the security of the code, you can set the <code>upgradable</code> property to false to prevent further upgrades. Jig objects, as instances of jig code, will be automatically upgraded to the new behavior when they call <code>sync()</code> and their class reference gets upgraded.</p>
<h3 id='api-reference-code-deps'>deps</h3>
<p><code>static deps: ?object</code></p>

<p>The dependencies of this code. These must be manually specified in order for Run to load them into the code sandbox. And properties on deps are added as globals within the sandbox.</p>
<h3 id='api-reference-code-sealed'>sealed</h3>
<p><code>sealed: true | false | &#39;owner&#39;</code></p>

<p>The <code>sealed</code> property defines the rules for how a class can be extended. If <code>true</code>, then no extensions are allowed. If <code>false</code>, then anyone may extend from the class. If <code>&#39;owner&#39;</code>, then the class&#39;s owner must authorize of any extensions to the class. The default value is <code>&#39;owner&#39;</code> so that a class hierarchy can be trusted and the <code>instanceof</code> keyword is safe by default.</p>
<h3 id='api-reference-code-upgradable'>upgradable</h3>
<p><code>upgradable: boolean</code></p>

<p>Whether the code is allowed to be upgraded. You may wish to set this value to false to prove that the behavior will not change. The default value is true.</p>
<h2 id='api-reference-berry'>Berry</h2>
<blockquote>
<p>Define a berry class</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">TwetchPost</span> <span class="kr">extends</span> <span class="nx">Berry</span> <span class="p">{</span>
    <span class="nx">init</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span>
    <span class="p">}</span>

    <span class="kr">static</span> <span class="nx">async</span> <span class="nx">pluck</span><span class="p">(</span><span class="nx">location</span><span class="p">,</span> <span class="nx">fetch</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">txo</span><span class="p">(</span><span class="nx">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">location</span><span class="p">))</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s2</span> <span class="o">===</span> <span class="s1">'19HxigV4QyBv3tHpQVcUEQyq1pzZVdoAut'</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// B protocol</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">TwetchPost</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s3</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">TwetchPost</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">txo</span> <span class="p">}</span>
</code></pre>
<p><code>class Berry extends Creation { ... }</code></p>

<p><code>Berry</code> is a base class for defining how data from third-party protocols should be loaded. Each class that extends from Berry defines a type of data. Berry instances, or simply berries, are read-only objects that represent this parsed data. Once loaded, but they may be used within jigs. All berries are also <a href="#api-reference-creation">Creation</a>s and have <code>location</code>, <code>origin</code>, and <code>nonce</code> properties.</p>
<h3 id='api-reference-berry-init'>init()</h3>
<p><code>init()</code></p>

<p>The initialization method for berry instances. You may pass parameters into <code>init()</code> and use those parameters to setup the berry. The <code>pluck()</code> method must create a new instance of the berry which will call <code>init()</code>.</p>
<h3 id='api-reference-berry-static-pluck-path-fetch'>static pluck(path, fetch)</h3>
<p><code>pluck(path: string, fetch: function): Promise&lt;Berry&gt;</code></p>

<p>Plucks a berry from the blockchain. You will override this method to load a berry instance. The berry class should fetch the transaction using <code>async fetch()</code>. This will return a raw transaction in hex format. The Berry should parse the transaction, perhaps using <a href="#api-reference-extras-tx">Tx</a> or <a href="#api-reference-extras-txo">txo</a>, and then instantiate a new Berry of the appropriate type with the data parsed out. If additional berries are required to build this one, they may be plucked recursively using <code>Berry.load()</code>.</p>
<h3 id='api-reference-berry-static-load-path'>static load(path)</h3>
<blockquote>
<p>Load a berry</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">post</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">TwetchPost</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">'4e146ac161324ef0b388798462867c29ad681ef4624ea4e3f7c775561af3ddd0'</span><span class="p">)</span>
</code></pre>
<p><code>static load(path: string): Promise&lt;Berry&gt;</code></p>

<p>Loads a berry of a particular type. Run internally calls the berry class&#39;s <code>pluck()</code> method to load the berry. <code>load()</code> may be also called recursively inside of <code>Berry.pluck()</code> to load sub-berries. You cannot override <code>load()</code>.</p>
<h2 id='api-reference-creation'>Creation</h2>
<blockquote>
<p>Check that objects are indeed creations</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">Token2</span> <span class="k">instanceof</span> <span class="nx">Creation</span>
<span class="c1">// true</span>

<span class="k">new</span> <span class="nx">Dragon</span><span class="p">()</span> <span class="k">instanceof</span> <span class="nx">Creation</span>
<span class="c1">// true</span>

<span class="nx">twetchPostBerry</span> <span class="k">instanceof</span> <span class="nx">Creation</span>
<span class="c1">// true</span>
</code></pre>
<p><code>class Creation { ... }</code></p>

<p>A JavaScript object that Run can be loaded from the blockchain. This includes jigs, code, and berries. The <code>Creation</code> class, available via <code>Run.Creation</code> is the effective base class for all creations. All creations have the location bindings <code>location</code>, <code>origin</code>, and <code>nonce</code> as well as UTXO bindings <code>owner</code> and <code>satoshis</code>. They can be passed into jig functions and referenced as properties. To load a creation, call <code>run.load</code> with its corresponding location.</p>
<h3 id='api-reference-creation-origin'>origin</h3>
<blockquote>
<p>Two different tickets have different origins</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Ticket</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">}</span>
<span class="kr">const</span> <span class="nx">ticket1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ticket</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">ticket2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ticket</span><span class="p">()</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>
<span class="c1">// ticket1.origin !== ticket2.origin</span>
</code></pre>
<p><code>origin: string</code></p>

<p>The unique blockchain location where the creation was initially deployed or loaded that distinguishes it from all other creations. The format for <code>origin</code> is generally <code>TXID_oN</code> where <code>TXID</code> is the bitcoin transaction ID where the creation was first deployed. <code>o</code> is shorthand for <em>output</em> and <code>N</code> is the zero-based index representing this creation. Deleted creations, instead of ending in <code>_oN</code>, end in <code>_odN</code> instead. Berries have additional query parameters in their origin. In any case, the origin is set automatically by Run after deploying or loading the creation and it becomes read-only thereafter. Jig methods may internally read the origin anytime after it is initially published.</p>
<h3 id='api-reference-creation-location'>location</h3>
<blockquote>
<p>The value of <code>location</code> changes with every update</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Weapon</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">upgrade</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">upgraded</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="k">return</span> <span class="k">this</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">const</span> <span class="nx">weapon</span> <span class="o">=</span> <span class="nx">await</span> <span class="k">new</span> <span class="nx">Weapon</span><span class="p">().</span><span class="nx">sync</span><span class="p">()</span>
<span class="c1">// weapon.origin === weapon.location</span>
<span class="nx">await</span> <span class="nx">weapon</span><span class="p">.</span><span class="nx">uprade</span><span class="p">().</span><span class="nx">sync</span><span class="p">()</span>
<span class="c1">// weapon.origin !== weapon.location</span>
</code></pre>
<p><code>location: string</code></p>

<p>The blockchain location that uniquely identifies the current state of the creation. This is in the same form as <code>origin</code>. However, unlike <code>origin</code>, <code>location</code> will update with every state change on the creation. When there is a pending change, reading <code>location</code> will throw an error. This is because the Bitcoin transaction ID is not yet known so its location is undetermined. To avoid this error, be sure to call <code>sync</code> before reading the location. Finally, note that location, like origin, is a read-only property that Run updates for you.</p>
<h3 id='api-reference-creation-nonce'>nonce</h3>
<p><code>nonce: number</code></p>

<p>The number of transactions this creation was updated in. This may be used to determine if one creation state is newer than another. Like <code>origin</code> and <code>location</code>, this is a read-only property that Run updates for you.</p>
<h3 id='api-reference-creation-owner'>owner</h3>
<blockquote>
<p>Transferring ownership of a code jig</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">FrequentFlyerRewards</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="kr">static</span> <span class="nx">transfer</span><span class="p">(</span><span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">owner</span> <span class="o">=</span> <span class="nx">to</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">FrequentFlyerRewards</span><span class="p">).</span><span class="nx">transfer</span><span class="p">(</span><span class="nx">address</span><span class="p">)</span>
</code></pre>
<p><code>owner: string|Lock</code></p>

<p>The owner is either a Bitcoin address string, a public key in hex, or a custom <a href="#api-reference-apis-lock">Lock</a> that creates an output script. A jig may change this property to change owners, but it is read-only from outside the creation.</p>
<h3 id='api-reference-creation-satoshis'>satoshis</h3>
<blockquote>
<p>Backing a jig with Bitcoin</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Item</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">satoshis</span> <span class="o">=</span> <span class="mi">10000</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p><code>satoshis: number</code></p>

<p>This number represents the amount of Bitcoin in satoshis that are backing this creation. It may be increased or decreased but it may not be set below zero. Increasing this value will deposit Bitcoin into the output for the jig from the Run purse. Decreasing it will withdraw Bitcoin to the Run purse.</p>
<h2 id='api-reference-transaction'>Transaction</h2><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Store</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">set</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Store</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">()</span>

<span class="nx">tx</span><span class="p">.</span><span class="nx">update</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">store</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'Hello, world'</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">await</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">publish</span><span class="p">()</span>
</code></pre>
<p><code>class Transaction { ... }</code></p>

<p>The Transaction class gives you to finer control over the current Bitcoin transaction being built by Run. This class is available via <code>Run.Transaction</code>. It allows you to:</p>

<ul>
<li>Batch many jig updates together</li>
<li>Load and inspect transactions</li>
<li>Export transactions for others to co-sign</li>
<li>Sign transactions involving your jigs</li>
<li>Propose atomic swaps and other updates that involve multiple parties</li>
</ul>

<p>Normally, when you update a jig that you own, Run will begin a transaction for you automatically. However, you can take control of this process by creating a new <code>Transaction</code> and calling <code>update()</code> on the transaction to perform the update yourself. When you are finished, you can call <code>publish()</code> to broadcast the transaction to the blockchain or <code>export()</code> to save the transaction locally. Alternatively, you may cancel the updates by calling <code>rollback</code>. Other parties may load your exported transaction by calling <code>run.import</code> and then inspecting its contents using <code>outputs</code> and <code>deletes</code> arrays. If they approve of the updates to their jigs, they may call <code>sign</code> and then <code>publish</code> to broadcast the transaction.</p>
<h3 id='api-reference-transaction-update-callback'>update(callback)</h3>
<blockquote>
<p>Deploy multiple jig classes in a single transaction</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">()</span>
<span class="nx">tx</span><span class="p">.</span><span class="nx">update</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">Picasso</span><span class="p">))</span>
<span class="nx">tx</span><span class="p">.</span><span class="nx">update</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">Monet</span><span class="p">))</span>
<span class="nx">tx</span><span class="p">.</span><span class="nx">update</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">VanGogh</span><span class="p">))</span>
<span class="nx">await</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">publish</span><span class="p">()</span>
</code></pre>
<p><code>update(callback: function)</code></p>

<p>Adds additional updates to the transaction. This may include calling a jig method, deploying code, upgrading code, destroying jigs, and more. The callback function passed in will be called to record the new changes.</p>
<h3 id='api-reference-transaction-publish-options'>publish(options)</h3>
<p><code>publish(options: ?object): Promise&lt;void&gt;</code></p>

<p>Finalizes the transaction and publishes it to the blockchain.</p>
<h4 id='api-reference-transaction-publish-options-options'>Options</h4>
<table><thead>
<tr>
<th>Property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>pay</td>
<td>Whether to pay for the transaction</td>
<td>true</td>
</tr>
<tr>
<td>sign</td>
<td>Whether to sign the transaction</td>
<td>true</td>
</tr>
</tbody></table>

<aside class="notice">
<b>Note:</b> If the transaction fails to post, then all updates in the batch are reverted.
</aside>
<h3 id='api-reference-transaction-export-options'>export(options)</h3>
<p><code>export(options: ?object): Promise&lt;string&gt;</code></p>

<p>Exports the in-progress transaction as a raw hex string. This transaction may be imported or broadcast afterward.</p>
<h4 id='api-reference-transaction-export-options-options'>Options</h4>
<table><thead>
<tr>
<th>Property</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td>pay</td>
<td>Whether to pay for the transaction</td>
<td>true</td>
</tr>
<tr>
<td>sign</td>
<td>Whether to sign the transaction</td>
<td>true</td>
</tr>
</tbody></table>
<h3 id='api-reference-transaction-pay'>pay()</h3>
<p><code>pay(): Promise&lt;void&gt;</code></p>

<p>Pays for the current transaction. This is performed automatically when <code>publish()</code> or <code>export()</code> is called, but you may wish to call it manually if you are paying with multiple purses or co-signing the transaction with others. If any additional updates are made to the transaction, including calling jig methods or deploying new code, then the transaction must be paid for again.</p>
<h3 id='api-reference-transaction-sign'>sign()</h3>
<p><code>sign(): Promise&lt;void&gt;</code></p>

<p>Signs all inputs involved in the current transaction using the active <code>Run</code> owner. The transaction should only be signed after all updates are added and the transaction has been paid for via <code>pay()</code>. After all required signatures are added, then the transaction may be broadcasted, and if the transaction requires signatures from multiple different owners, then it must be exported and imported by other parties to be signed. If any additional updates are made to the transaction, including calling jig methods or deploying new code, then the signatures are reset and the transaction must be paid for again and re-signed by all parties.</p>
<h3 id='api-reference-transaction-rollback'>rollback()</h3><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Store</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">set</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">store</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Store</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">()</span>

<span class="nx">tx</span><span class="p">.</span><span class="nx">update</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">store</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'Hello, world'</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">tx</span><span class="p">.</span><span class="nx">rollback</span><span class="p">()</span>

<span class="c1">// store.value is undefined again</span>
</code></pre>
<p><code>rollback()</code></p>

<p>Abandons the current transaction and reverts all changes to jigs and code. Any classes to be deployed will have their origins and locations cleared, and any jigs to be updated will revert to their prior state. Any jigs that are deployed for their first time will be reverted to an invalid state where they may no longer be used. </p>
<h3 id='api-reference-transaction-outputs'>outputs</h3>
<p><code>outputs: Array&lt;Creation&gt;</code></p>

<p>Jigs or code outputted from the transaction in their end state.</p>
<h3 id='api-reference-transaction-deletes'>deletes</h3>
<p><code>deletes: Array&lt;Creation&gt;</code></p>

<p>Jigs or code deleted within the transaction in their end state.</p>
<h2 id='api-reference-plugins'>Plugins</h2>
<p>This description describes various classes that ship with the Run library that may be used to manually configure Run. Each plugin is available under <code>Run.plugins</code>.</p>
<h3 id='api-reference-plugins-runconnect'>RunConnect</h3>
<blockquote>
<p>Connect to Run Connect Blockchain API</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">blockchain</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">RunConnect</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="nx">blockchain</span> <span class="p">})</span>
</code></pre>
<p><code>class RunConnect implements Blockchain { ... }</code></p>

<p>A <a href="#api-reference-apis-blockchain">Blockchain</a> implementation that connects to the Run Blockchain Server.</p>

<p><code>RunConnect</code> may be accessed via <code>Run.plugins.RunConnect</code>.</p>
<h4 id='api-reference-plugins-runconnect-constructor-options'>constructor(options)</h4>
<p><code>constructor(options: object): RunConnect</code></p>

<p>Creates a <code>RunConnect</code> instance with the provided configuration.</p>
<h5 id='api-reference-plugins-runconnect-constructor-options-options'>Options</h5>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>network</code></td>
<td>string</td>
<td>Either main or test</td>
<td>main</td>
</tr>
</tbody></table>
<h3 id='api-reference-plugins-browsercache'>BrowserCache</h3>
<blockquote>
<p>Create a BrowserCache with a higher in-memory cache size</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">BrowserCache</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">plugins</span>

<span class="kr">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BrowserCache</span><span class="p">({</span> <span class="na">maxMemorySizeMB</span><span class="p">:</span> <span class="mi">100</span> <span class="p">})</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="nx">cache</span> <span class="p">})</span>
</code></pre>
<p><code>class BrowserCache implements Cache { ... }</code></p>

<p>A multi-level <a href="#api-reference-apis-cache">Cache</a> implementation designed for web browsers that persists values across sessions.</p>

<p><code>BrowserCache</code> is the default implementation of the <code>Cache</code> API setup by Run when using browsers. <code>BrowserCache</code> is a wrapper around the <code>LocalCache</code> and an IndexedDB store. It uses the <code>LocalCache</code> to quickly store and access values from local memory and the IndexedDb store to persist values across browser sessions. When a value is written, it is written both to the <code>LocalCache</code> and to the IndexedDB store. </p>

<p><code>BrowserCache</code> may be accessed via <code>Run.plugins.BrowserCache</code>.</p>

<aside class="warning">
<b>Warning:</b> The IndexedDB store used internally may be flushed by the browser once its size reaches a maximum size determined by the browser. The <code>BrowserCache</code> does not attempt to manage this itself.
</aside>
<h4 id='api-reference-plugins-browsercache-constructor-options'>constructor(options)</h4>
<p><code>constructor(options: ?object)</code></p>

<p>Creates the browser cache. The options object may be used to configure the cache.</p>
<h5 id='api-reference-plugins-browsercache-constructor-options-options'>Options</h5>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>maxMemorySizeMB</code></td>
<td>number</td>
<td>Max size in megabytes (MB) of the cached data stored in memory</td>
<td>10 (10MB)</td>
</tr>
<tr>
<td><code>dbName</code></td>
<td>string</td>
<td>Database name</td>
<td>&#39;run-browser-cache&#39;</td>
</tr>
<tr>
<td><code>dbVersion</code></td>
<td>number</td>
<td>Database version</td>
<td>1</td>
</tr>
<tr>
<td><code>dbStore</code></td>
<td>string</td>
<td>Object storage name</td>
<td>&#39;run-objects&#39;</td>
</tr>
</tbody></table>
<h4 id='api-reference-plugins-browsercache-maxmemorysizemb'>maxMemorySizeMB</h4>
<p><code>maxMemorySizeMB: number</code></p>

<p>Size in megabytes (MB) of the in-memory cache. This value may be changed at runtime.</p>
<h3 id='api-reference-plugins-inventory'>Inventory</h3>
<p>Tracks jigs assigned to the current owner. An Inventory is automatically created with a new Run instance and assigned to <code>Run.inventory</code>.</p>
<h4 id='api-reference-plugins-inventory-jigs'>jigs</h4>
<blockquote>
<p>Load all jigs that are tickets</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Update the inventory's jigs</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="c1">// Find the ticket</span>
<span class="kr">const</span> <span class="nx">ticketClassOrigin</span> <span class="o">=</span> <span class="s1">'e4a9618d3a187448feeb95ff30f7ec6381a025316cdcae2cdf388ad3de7fab6f_o1'</span>
<span class="kr">const</span> <span class="nx">ticket</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">jigs</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">jig</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">origin</span> <span class="o">===</span> <span class="nx">ticketClassOrigin</span><span class="p">)</span>
</code></pre>
<p><code>jigs: Array&lt;Jig&gt;</code></p>

<p>Returns an array of all jig objects owned by the Run owner. This array is cached. To update it, call <code>run.inventory.sync()</code>.</p>
<h4 id='api-reference-plugins-inventory-code'>code</h4>
<blockquote>
<p>Load the user&#39;s classes</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Update the inventory's code</span>
<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="c1">// Find all classes we known that extend from a known origin</span>
<span class="kr">const</span> <span class="nx">itemBaseClassOrigin</span> <span class="o">=</span> <span class="s1">'e4a9618d3a187448feeb95ff30f7ec6381a025316cdcae2cdf388ad3de7fab6f_o2'</span>
<span class="kr">const</span> <span class="nx">ItemBase</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">itemBaseClassOrigin</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">itemClasses</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">code</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">T</span> <span class="o">=&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getPrototypeOf</span><span class="p">(</span><span class="nx">T</span><span class="p">)</span> <span class="o">===</span> <span class="nx">ItemBase</span><span class="p">)</span>
</code></pre>
<p><code>code: Array&lt;function&gt;</code></p>

<p>An array of all jig classes and functions owned by the Run owner. This array is cached. To update it, call <code>run.inventory.sync()</code>.</p>

<p>It is best to identify code using origins as seen on the right. Identifying classes by their names is not secure.</p>
<h4 id='api-reference-plugins-inventory-sync'>sync()</h4>
<p><code>sync(): Promise&lt;void&gt;</code></p>

<p>Updates the local jig objects and code with the latest UTXO set.</p>
<h3 id='api-reference-plugins-localcache'>LocalCache</h3>
<p><code>class LocalCache implements Cache { ... }</code></p>

<p>An in-memory LRU <a href="#api-reference-apis-cache">Cache</a> implementation with a maximum size. <code>LocalCache</code> is the default implementation of the <code>Cache</code> API when using Node. The <code>Run</code> class will create one automatically if no cache is provided.</p>

<p><code>LocalCache</code> may be accessed via <code>Run.plugins.LocalCache</code>.</p>
<h4 id='api-reference-plugins-localcache-constructor-options'>constructor(options)</h4>
<p><code>constructor(options: ?object)</code></p>

<p>Creates the local cache. The options object may be used to configure the cache.</p>
<h5 id='api-reference-plugins-localcache-constructor-options-options'>Options</h5>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>maxSizeMB</code></td>
<td>number</td>
<td>Max size in megabytes (MB) of the cached data stored in memory</td>
<td>10 (10MB)</td>
</tr>
</tbody></table>
<h4 id='api-reference-plugins-localcache-maxsizemb'>maxSizeMB</h4>
<p><code>maxSizeMB: number</code></p>

<p>The maximum amount of data stored in the state cache in megabytes.</p>

<p>If this value is less than the current size, the cache will be shrunk to fit.</p>
<h3 id='api-reference-plugins-localowner'>LocalOwner</h3>
<p><code>class LocalOwner implements Owner { ... }</code></p>

<p>The default <a href="#api-reference-apis-owner">Owner</a> implementation that uses a local private key to sign transactions. It is able to sign both standard locks (including addresses and public key strings) as well as group locks. Jigs created will all be assigned to the same address.</p>

<p><code>LocalOwner</code> may be accessed via <code>Run.plugins.LocalOwner</code>.</p>
<h4 id='api-reference-plugins-localowner-constructor-options'>constructor(options)</h4>
<p><code>constructor(options: object): LocalOwner</code></p>

<p>Creates a <code>LocalOwner</code> with the provided configuration.</p>
<h5 id='api-reference-plugins-localowner-constructor-options-options'>Options</h5>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>privkey</code></td>
<td>string or bsv.PrivateKey</td>
<td>Private key used to own jigs and other resources</td>
<td>Randomly generated</td>
</tr>
<tr>
<td><code>blockchain</code></td>
<td><code>Blockchain</code></td>
<td>Blockchain used to query UTXOs. If none is specified, then the inventory will not be synced.</td>
<td>None</td>
</tr>
</tbody></table>
<h4 id='api-reference-plugins-localowner-privkey'>privkey</h4>
<p><code>privkey: string</code></p>

<p>Hex private key string used to sign jig updates. This is read-only.</p>
<h4 id='api-reference-plugins-localowner-address'>address</h4>
<p><code>address: string</code></p>

<p>Address used to assign to new jigs. This is read-only.</p>
<h3 id='api-reference-plugins-localpurse'>LocalPurse</h3>
<p><code>class LocalPurse implements Purse { ... }</code></p>

<p>The <a href="#api-reference-apis-purse">Purse</a> implementation that Run uses by default to pay for transactions using a local wallet. This is an implementation of the <code>Purse</code> API.</p>

<p><code>LocalPurse</code> may be accessed via <code>Run.plugins.LocalPurse</code>.</p>
<h4 id='api-reference-plugins-localpurse-constructor-options'>constructor(options)</h4>
<p><code>constructor(options: object): LocalPurse</code></p>

<p>Creates a <code>LocalPurse</code> with the provided configuration.</p>
<h5 id='api-reference-plugins-localpurse-constructor-options-options'>Options</h5>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>privkey</code></td>
<td>string or bsv.PrivateKey</td>
<td>Private key used to own jigs and other resources</td>
<td><strong>Required</strong></td>
</tr>
<tr>
<td><code>blockchain</code></td>
<td><code>Blockchain</code></td>
<td>Blockchain used to query UTXOs</td>
<td><strong>Required</strong></td>
</tr>
<tr>
<td><code>splits</code></td>
<td>number</td>
<td>Number of UTXO splits to reduce mempool chain issues</td>
<td>10</td>
</tr>
<tr>
<td><code>feePerKb</code></td>
<td>number</td>
<td>Transaction fee in satoshis per kilobyte</td>
<td>1000</td>
</tr>
</tbody></table>
<h4 id='api-reference-plugins-localpurse-privkey'>privkey</h4>
<p><code>privkey: string</code></p>

<p>Private key used to sign the transaction.</p>
<h4 id='api-reference-plugins-localpurse-address'>address</h4>
<p><code>address: string</code></p>

<p>Address used to find UTXOs and receive payments.</p>
<h4 id='api-reference-plugins-localpurse-splits'>splits</h4>
<blockquote>
<p>Change the number of purse UTXO splits</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">run</span><span class="p">.</span><span class="nx">purse</span><span class="p">.</span><span class="nx">splits</span> <span class="o">=</span> <span class="mi">100</span>
</code></pre>
<p><code>splits: number</code></p>

<p>The minimum number of UTXOs that the purse must have. If the number of UTXOs is less than this value, then Run will automatically split your UTXOs the next time a Run transaction is generated. The default value for <code>splits</code> is 10.</p>

<p>Increasing this value may avoid the <code>too-long-mempool-chain</code> error. For more information, see <a href="#tips-and-tricks-debugging">Debugging Tips</a>.</p>
<h4 id='api-reference-plugins-localpurse-balance'>balance()</h4>
<blockquote>
<p>Querying the current balance</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Satoshis'</span><span class="p">,</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">purse</span><span class="p">.</span><span class="nx">balance</span><span class="p">())</span>
</code></pre>
<p><code>balance(): Promise&lt;number&gt;</code></p>

<p>Returns a promise that resolves to the current balance in satoshis of this purse. This is the sum of all satoshis in this purse&#39;s unspent outputs.</p>
<h4 id='api-reference-plugins-localpurse-utxos'>utxos()</h4>
<blockquote>
<p>Building a transaction using the purse</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">utxos</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">purse</span><span class="p">.</span><span class="nx">utxos</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">bsv</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">().</span><span class="nx">from</span><span class="p">(</span><span class="nx">utxos</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="nx">run</span><span class="p">.</span><span class="nx">purse</span><span class="p">.</span><span class="nx">address</span><span class="p">).</span><span class="nx">sign</span><span class="p">(</span><span class="nx">run</span><span class="p">.</span><span class="nx">purse</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">)</span>
</code></pre>
<p><code>utxos(): Promise&lt;{txid: string, vout: number, script: bsv.Script, satoshis: number}&gt;</code></p>

<p>Returns a promise that resolves to the current UTXOs of this purse.</p>
<h3 id='api-reference-plugins-mattercloud'>MatterCloud</h3>
<blockquote>
<p>Connect to MatterCloud Blockchain API with the given API key</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">blockchain</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">MatterCloud</span><span class="p">({</span> <span class="na">apiKey</span><span class="p">:</span> <span class="s1">'...'</span> <span class="p">})</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="nx">blockchain</span> <span class="p">})</span>
</code></pre>
<p><code>class MatterCloud implements Blockchain { ... }</code></p>

<p>A <a href="#api-reference-apis-blockchain">Blockchain</a> implementation that connects to the MatterCloud API. Only mainnet is supported.</p>

<p><code>MatterCloud</code> may be accessed via <code>Run.plugins.MatterCloud</code>.</p>
<h4 id='api-reference-plugins-mattercloud-constructor-options'>constructor(options)</h4>
<p><code>constructor(options: object): MatterCloud</code></p>

<p>Creates a <code>MatterCloud</code> instance with the provided configuration.</p>
<h5 id='api-reference-plugins-mattercloud-constructor-options-options'>Options</h5>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>apiKey</code></td>
<td>string</td>
<td>API key to use. Currently, only MatterCloud API supports this option.</td>
<td>undefined</td>
</tr>
</tbody></table>
<h3 id='api-reference-plugins-mockchain'>Mockchain</h3>
<blockquote>
<p>Getting the mockchain from a run instance</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">network</span><span class="p">:</span> <span class="s1">'mock'</span> <span class="p">})</span>

<span class="kr">const</span> <span class="nx">mockchain</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span>
</code></pre>
<blockquote>
<p>Creating a mockchain manually and passing it into <code>Run</code></p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">mockchain</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">Mockchain</span><span class="p">()</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">blockchain</span><span class="p">:</span> <span class="nx">mockchain</span> <span class="p">})</span>
</code></pre>
<p><code>class Mockchain implements Blockchain { ... }</code></p>

<p>The <em>mockchain</em> is a local simulation of a blockchain that stored entirely in memory. It implements the <a href="#api-reference-apis-blockchain">Blockchain API</a>. It accepts and validates real Bitcoin transactions using testnet settings. The mockchain simulates many aspects of a real Bitcoin API, including the 25 chained mempool limit, but everything happens locally.</p>

<p>We recommend using the mockchain during development and unit testing. The mockchain lets you simulate Run without requiring network connectivity and without spending real bitcoins. Note that when the program closes however, all mockchain data is lost, so it is not a substitute for a real network.</p>

<p>The class is accessible via <code>Run.plugins.Mockchain</code>, or as an instance in <code>run.blockchain</code> after setting the network to <code>mock</code>.</p>
<h4 id='api-reference-plugins-mockchain-constructor'>constructor()</h4>
<p><code>constructor()</code></p>

<p>Creates a new mockchain. There are no parameters.</p>
<h4 id='api-reference-plugins-mockchain-fund-address-satoshis'>fund(address, satoshis)</h4>
<p><code>fund(address: string, satoshis: number)</code></p>

<p>Directly funds an address with an amount of satoshis without requiring the spending of any inputs. The Run class will automatically fund the purse, but you may fund additional addresses using this method.</p>
<h4 id='api-reference-plugins-mockchain-block'>block()</h4>
<p><code>block()</code></p>

<p>Creates a new simulated block. This is useful when the 25 chained mempool limit is hit.</p>
<h3 id='api-reference-plugins-payserver'>PayServer</h3>
<blockquote>
<p>Create Run and use the testnet pay server</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">apiKey</span> <span class="o">=</span> <span class="s1">'&lt;your-api-key&gt;'</span>
<span class="kr">const</span> <span class="nx">payServer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">PayServer</span><span class="p">(</span><span class="nx">apiKey</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">network</span><span class="p">:</span> <span class="s1">'test'</span><span class="p">,</span> <span class="na">purse</span><span class="p">:</span> <span class="nx">payServer</span> <span class="p">})</span>
</code></pre>
<p><code>class PayServer implements Purse { ... }</code></p>

<p>A <a href="#api-reference-apis-purse">Purse</a> implementation that uses the Run Pay Server to pay for transactions.</p>

<p><code>PayServer</code> may be accessed via <code>Run.plugins.PayServer</code>.</p>
<h4 id='api-reference-plugins-payserver-constructor-apikey'>constructor(apiKey)</h4>
<p><code>constructor(apiKey: string)</code></p>

<p>Creates the PayServer with a given API key. The API key may be generated via <code>https://api.run.network/v1/test/pay/generate</code>. Only testnet is supported today.</p>
<h3 id='api-reference-plugins-viewer'>Viewer</h3>
<blockquote>
<p>Load the jigs owned by another user</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">viewer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">Viewer</span><span class="p">(</span><span class="nx">customLock</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">owner</span><span class="p">:</span> <span class="nx">viewer</span> <span class="p">})</span>

<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">sync</span><span class="p">()</span>

<span class="c1">// run.inventory.jigs will contain their jigs</span>
</code></pre>
<p><code>class Viewer implements Owner</code></p>

<p>An <a href="#api-reference-apis-owner">Owner</a> implementation for loading another user&#39;s jigs.</p>

<p>These resources will be read-only and the <code>Viewer</code> will not be able to sign for any updates.</p>

<p><code>Viewer</code> may be accessed via <code>Run.plugins.Viewer</code>.</p>
<h4 id='api-reference-plugins-viewer-constructor-owner'>constructor(owner)</h4>
<p><code>constructor(owner: string|Lock)</code></p>

<p>Creates a new viewer.</p>
<h3 id='api-reference-plugins-whatsonchain'>WhatsOnChain</h3>
<blockquote>
<p>Connect to WhatsOnChain API on testnet</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">blockchain</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">WhatsOnChain</span><span class="p">({</span> <span class="na">network</span><span class="p">:</span> <span class="s1">'testnet'</span> <span class="p">})</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="nx">blockchain</span> <span class="p">})</span>
</code></pre>
<p><code>class WhatsOnChain implements Blockchain { ... }</code></p>

<p>A <a href="#api-reference-apis-blockchain">Blockchain</a> implementation that connects to the WhatsOnChain API.</p>

<p><code>WhatsOnChain</code> may be accessed via <code>Run.plugins.WhatsOnChain</code>.</p>
<h4 id='api-reference-plugins-whatsonchain-constructor-options'>constructor(options)</h4>
<p><code>constructor(options: object): WhatsOnChain</code></p>

<p>Creates a <code>WhatsOnChain</code> with the provided configuration.</p>
<h5 id='api-reference-plugins-whatsonchain-constructor-options-options'>Options</h5>
<table><thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code>network</code></td>
<td>string</td>
<td>Either main or test</td>
<td>main</td>
</tr>
</tbody></table>
<h2 id='api-reference-extras'>Extras</h2>
<p>Run ships with several built-in code creations that are part of its standard library. These include the standard <code>Token2</code> class for numerical tokens and several other helpers. Each code below is predeployed and available under <code>Run.extra</code>.</p>
<h3 id='api-reference-extras-asm'>asm</h3>
<blockquote>
<p>Create a custom R-puzzle output script</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">asm</span><span class="p">(</span><span class="s2">`OP_DUP OP_3 OP_SPLIT OP_NIP OP_1 OP_SPLIT OP_SWAP OP_SPLIT OP_DROP OP_HASH160 </span><span class="p">${</span><span class="nx">rhash</span><span class="p">}</span><span class="s2"> OP_EQUALVERIFY OP_OVER OP_CHECKSIGVERIFY OP_CHECKSIG`</span><span class="p">)</span>
</code></pre>
<p><code>function asm(s: string): string</code></p>

<p>Converts a Bitcoin script string in ASM notation into its hex string format. This code is deterministic and safe to use within Jigs. It is often useful when creating <a href="#advanced-usage-locks">custom owner locks</a>.</p>

<p>It is available via <code>Run.extra.asm</code> and predeployed at the following locations:</p>

<table><thead>
<tr>
<th>Network</th>
<th>Location</th>
</tr>
</thead><tbody>
<tr>
<td>main</td>
<td>61e1265acb3d93f1bf24a593d70b2a6b1c650ec1df90ddece8d6954ae3cdd915_o1</td>
</tr>
<tr>
<td>test</td>
<td>1f0abf8d94477b1cb57629d861376616f6e1d7b78aba23a19da3e6169caf489e_o1</td>
</tr>
</tbody></table>
<h3 id='api-reference-extras-b'>B</h3>
<p><code>class B extends Berry { ... }</code></p>

<p>The <code>B</code> class loads file data stored on the blockchain into a JavaScript object. You may use <code>B</code> to load images, 3D models, CSS styles, and more, to attach to your jigs, to display in your apps, or for any other purpose. The B:// data format is well-established as a method for storing files on-chain, and services like <a href="www.bitcoinfiles.org">Bitcoin Files</a> allow you to upload and view them easily. Run uses B data to represent images for jigs. See <a href="#advanced-usage-standard-metadata">Standard Metadata</a> for more.</p>

<p>To load a <code>B</code> berry, call either <code>B.load()</code> or <code>B.loadWithMetadata()</code>. <code>B</code> will load the <em>first</em> output containing B data in the transaction.</p>

<p>It is available via <code>Run.extra.B</code> and predeployed at the following locations:</p>

<table><thead>
<tr>
<th>Network</th>
<th>Location</th>
</tr>
</thead><tbody>
<tr>
<td>main</td>
<td>6fe169894d313b44bd54154f88e1f78634c7f5a23863d1713342526b86a39b8b_o1</td>
</tr>
<tr>
<td>test</td>
<td>5435ae2760dc35f4329501c61c42e24f6a744861c22f8e0f04735637c20ce987_o1</td>
</tr>
</tbody></table>
<h4 id='api-reference-extras-b-load'>load()</h4>
<blockquote>
<p>Load B:// data into an img element</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">B</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s1">'2f3492ef5401d887a93ca09820dff952f355431cea306841a70d163e32b2acad'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">b</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">imgElement</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="s2">`data:</span><span class="p">${</span><span class="nx">b</span><span class="p">.</span><span class="nx">mediaType</span><span class="p">}</span><span class="s2">;base64, </span><span class="p">${</span><span class="nx">b</span><span class="p">.</span><span class="nx">base64Data</span><span class="p">}</span><span class="s2">`</span>
<span class="p">})</span>
</code></pre>
<p><code>load(txid: string): Promise&lt;B&gt;</code></p>

<p>Loads B:// data from the transaction with the ID passed.</p>
<h4 id='api-reference-extras-b-loadwithmetadata'>loadWithMetadata()</h4>
<blockquote>
<p>Load B:// data with attribution metadata</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">metadata</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'T Rex skull icon'</span><span class="p">,</span>
  <span class="na">license</span><span class="p">:</span> <span class="s1">'[CC BY 3.0](http://creativecommons.org/licenses/by/3.0)'</span><span class="p">,</span>
  <span class="na">author</span><span class="p">:</span> <span class="s1">'[Delapouite](https://delapouite.com/)'</span><span class="p">,</span>
  <span class="na">source</span><span class="p">:</span> <span class="s1">'[game-icons.net](https://game-icons.net/1x1/delapouite/t-rex-skull.html)'</span>
<span class="p">}</span>

<span class="nx">await</span> <span class="nx">B</span><span class="p">.</span><span class="nx">loadWithMetadata</span><span class="p">(</span><span class="s1">'ca64bd8d129332513540d15b73519bf905e0863982a2f00f63deb38c6a44f546_o1'</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">)</span>
</code></pre>
<p><code>loadWithMetadata(txid: string, metadata: ?object): Promise&lt;B&gt;</code></p>

<p>Loads B:// data and then attaches the provided metadata to the berry.</p>

<p>This is useful for adding attribution information to data that lacks it. See the <a href="#advanced-usage-standard-metadata">Standard Metadata</a> for information on metadata fields.</p>
<h4 id='api-reference-extras-b-base64data'>base64Data</h4>
<p><code>base64Data: string</code></p>

<p>The data stored using B:// represented in base 64.</p>
<h4 id='api-reference-extras-b-filename'>filename</h4>
<p><code>filename: string</code></p>

<p>The filename as declared by the B:// protocol data.</p>
<h4 id='api-reference-extras-b-mediatype'>mediaType</h4>
<p><code>mediaType: string</code></p>

<p>The W3 registered media type. Examples include <code>image/svg+xml</code> and <code>image/png</code>.</p>
<h3 id='api-reference-extras-expect'>expect</h3><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Post</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span>
  <span class="nx">init</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">message</span><span class="p">).</span><span class="nx">toBeString</span><span class="p">()</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">Post</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="na">expect</span><span class="p">:</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">extra</span><span class="p">.</span><span class="nx">expect</span> <span class="p">}</span>
</code></pre>
<p><code>function expect(subject) { ... }</code></p>

<p>The <code>expect</code> function is arbitrary code to help you check with parameters in Jigs. It is similar to Jest or Chai assertions. <code>expect</code> takes a single argument, <em>subject</em>, and then lets you execute one of its assertion methods on ithe subject. If the assertion passes, then nothing happens, but if it fails, an Error is thrown.</p>

<p>Each method takes an optional last parameter <em>message</em> that is the error message to throw. If none is specified, then a default error message will be created.</p>

<p>It is available via <code>Run.extra.expect</code> and predeployed at the following locations:</p>

<table><thead>
<tr>
<th>Network</th>
<th>Location</th>
</tr>
</thead><tbody>
<tr>
<td>main</td>
<td>71fba386341b932380ec5bfedc3a40bce43d4974decdc94c419a94a8ce5dfc23_o1</td>
</tr>
<tr>
<td>test</td>
<td>f97d4ac2a3d6f5ed09fad4a4f341619dc5a3773d9844ff95c99c5d4f8388de2f_o1</td>
</tr>
</tbody></table>
<h4 id='api-reference-extras-expect-not'>not</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">name</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBeNumber</span><span class="p">()</span>
</code></pre>
<p><code>not</code></p>

<p>The <code>not</code> property reverses the condition of any methods that follow.</p>
<h4 id='api-reference-extras-expect-tobe'>toBe()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">power</span> <span class="o">&gt;</span> <span class="mi">9999</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</code></pre>
<p><code>toBe(value: any, message: ?string)</code></p>

<p>Checks that the <em>subject</em> is equal to the <em>value</em>, using the javascript === operator. This does not, however, deeply compare values of an object, so for deep object comparison we recommend <code>toEqual</code>.</p>
<h4 id='api-reference-extras-expect-toequal'>toEqual()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">names</span><span class="p">).</span><span class="nx">toBe</span><span class="p">([</span><span class="s1">'Stevie'</span><span class="p">,</span> <span class="s1">'Wonder'</span><span class="p">])</span>
</code></pre>
<p><code>toEqual(value: any, message: ?string)</code></p>

<p>Deeply compares the <em>subject</em> to a <em>value</em>, which involves recursively traversing through every sub-property of objects to compare whether they are the same primitive values.</p>
<h4 id='api-reference-extras-expect-tobeinstanceof'>toBeInstanceOf()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">dragon</span><span class="p">).</span><span class="nx">toBeInstanceOf</span><span class="p">(</span><span class="nx">Dragon</span><span class="p">)</span>
</code></pre>
<p><code>toBeInstanceOf(Class: Class, message: ?string)</code></p>

<p>Checks that an object is an instance of a class or one of its parents.</p>
<h4 id='api-reference-extras-expect-tobedefined'>toBeDefined()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">message</span><span class="p">).</span><span class="nx">toBeDefined</span><span class="p">()</span>
</code></pre>
<p><code>toBeDefined(message: ?string)</code></p>

<p>Checks that a <em>value</em> is not undefined.</p>
<h4 id='api-reference-extras-expect-tobenull'>toBeNull()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">hat</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toBeNull</span><span class="p">()</span>
</code></pre>
<p><code>toBeNull(message: ?string)</code></p>

<p>Checks that a <em>value</em> is null. Often this is paired with <code>not</code> to check that a value is not null, as seen on the right.</p>
<h4 id='api-reference-extras-expect-tobenumber'>toBeNumber()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">health</span><span class="p">).</span><span class="nx">toBeNumber</span><span class="p">()</span>
</code></pre>
<p><code>toBeNumber(message: ?string)</code></p>

<p>Checks that a <em>value</em> is a numerical type. Numbers including all integers, floating point numbers, NaN, and Infinity.</p>
<h4 id='api-reference-extras-expect-tobeinteger'>toBeInteger()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">amount</span><span class="p">).</span><span class="nx">toBeInteger</span><span class="p">()</span>
</code></pre>
<p><code>toBeInteger(message: ?string)</code></p>

<p>Checks that a <em>value</em> is an integer number and does not have a decimal point.</p>
<h4 id='api-reference-extras-expect-tobelessthan'>toBeLessThan()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">damage</span><span class="p">).</span><span class="nx">toBeLessThan</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</code></pre>
<p><code>toBeLessThan(value: number, message: ?string)</code></p>

<p>Checks that a <em>value</em> is a number less than a particular number.</p>
<h4 id='api-reference-extras-expect-tobelessthanorequalto'>toBeLessThanOrEqualTo()</h4>
<p><code>toBeLessThanOrEqualTo(value: number, message: ?string)</code></p>

<p>Checks that a <em>value</em> is a number less than or equal to a particular number.</p>
<h4 id='api-reference-extras-expect-tobegreaterthan'>toBeGreaterThan()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nx">toBeGreaterThan</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre>
<p><code>toBeGreaterThan(value: number, message: ?string)</code></p>

<p>Checks that a <em>value</em> is a number greater than a particular number.</p>
<h4 id='api-reference-extras-expect-tobegreaterthanorequalto'>toBeGreaterThanOrEqualTo()</h4>
<p><code>toBeGreaterThanOrEqualTo(value: number, message: ?string)</code></p>

<p>Checks that a <em>value</em> is a number greater than or equal to a particular number.</p>
<h4 id='api-reference-extras-expect-tobeboolean'>toBeBoolean()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">weaponsEnabled</span><span class="p">).</span><span class="nx">toBeBoolean</span><span class="p">()</span>
</code></pre>
<p><code>toBeBoolean(message: ?string)</code></p>

<p>Checks that a <em>value</em> is either true or false.</p>
<h4 id='api-reference-extras-expect-tobestring'>toBeString()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">name</span><span class="p">).</span><span class="nx">toBeString</span><span class="p">()</span>
</code></pre>
<p><code>toBeString(message: ?string)</code></p>

<p>Checks that a <em>value</em> is a string. It may still be the empty string however.</p>
<h4 id='api-reference-extras-expect-tobeobject'>toBeObject()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">properties</span><span class="p">).</span><span class="nx">toBeObject</span><span class="p">()</span>
</code></pre>
<p><code>toBeObject(message: ?string)</code></p>

<p>Checks that a <em>value</em> is a non-null object or an Array. </p>
<h4 id='api-reference-extras-expect-tobearray'>toBeArray()</h4><pre class="highlight plaintext"><code>expect(tokens).toBeArray()
</code></pre>
<p><code>toBeArray(message: ?string)</code></p>

<p>Checks that a <em>value</em> is an array. It may be empty.</p>
<h4 id='api-reference-extras-expect-tobeset'>toBeSet()</h4><pre class="highlight plaintext"><code>expect(whitelist).toBeSet()
</code></pre>
<p><code>toBeSet(message: ?string)</code></p>

<p>Checks that a <em>value</em> is a Set instance. It may be empty.</p>
<h4 id='api-reference-extras-expect-tobemap'>toBeMap()</h4><pre class="highlight plaintext"><code>expect(users).toBeMap()
</code></pre>
<p><code>toBeMap(message: ?string)</code></p>

<p>Checks that a <em>value</em> is Map instance. It may be empty.</p>
<h4 id='api-reference-extras-expect-tobeuint8array'>toBeUint8Array()</h4><pre class="highlight plaintext"><code>expect(buffer).toBeUint8Array()
</code></pre>
<p><code>toBeUint8Array(message: ?string)</code></p>

<p>Checks that a <em>value</em> is a Uint8Array instance. It may be empty.</p>
<h4 id='api-reference-extras-expect-tobeclass'>toBeClass()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">CustomLock</span><span class="p">).</span><span class="nx">toBeClass</span><span class="p">()</span>
</code></pre>
<p><code>toBeClass(message: ?string)</code></p>

<p>Checks that a type is a class.</p>
<h4 id='api-reference-extras-expect-tobefunction'>toBeFunction()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">calculateDamage</span><span class="p">).</span><span class="nx">toBeFunction</span><span class="p">()</span>
</code></pre>
<p><code>toBeFunction(message: ?string)</code></p>

<p>Checks that a type is a function. Classes are not considered functions for this assert.</p>
<h4 id='api-reference-extras-expect-tobejigclass'>toBeJigClass()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">Dragon</span><span class="p">).</span><span class="nx">toBeJigClass</span><span class="p">()</span>
</code></pre>
<p><code>toBeJigClass(message: ?string)</code></p>

<p>Checks that a type is a class that extends from <code>Jig</code>.</p>
<h4 id='api-reference-extras-expect-toextendfrom'>toExtendFrom()</h4><pre class="highlight javascript tab-javascript"><code><span class="nx">expect</span><span class="p">(</span><span class="nx">MyToken</span><span class="p">).</span><span class="nx">toExtendFrom</span><span class="p">(</span><span class="nx">Token2</span><span class="p">)</span>
</code></pre>
<p><code>toExtendFrom(T: function)</code></p>

<p>Checks that a class extends from another class.</p>
<h3 id='api-reference-extras-group'>Group</h3>
<blockquote>
<p>Create and then sign a 2-3 multi-sig</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="c1">// Create a token owned by a 2-3 multi-sig</span>
<span class="nx">token</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">Group</span><span class="p">([</span><span class="nx">pubkey1</span><span class="p">,</span> <span class="nx">pubkey2</span><span class="p">,</span> <span class="nx">pubkey3</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1">// Begin a transaction to spend it and sign with key #1</span>
<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">owner</span><span class="p">:</span> <span class="nx">privkey1</span> <span class="p">})</span>
<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">()</span>
<span class="nx">tx</span><span class="p">.</span><span class="nx">update</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">token</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">address</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="nx">await</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">pay</span><span class="p">()</span>
<span class="nx">await</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">sign</span><span class="p">()</span>

<span class="c1">// Co-sign with key #2</span>
<span class="nx">run</span><span class="p">.</span><span class="nx">owner</span> <span class="o">=</span> <span class="nx">privkey2</span>
<span class="nx">await</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">sign</span><span class="p">()</span>
<span class="nx">await</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">publish</span><span class="p">()</span>
</code></pre>
<p><code>class Group implements Lock { ... }</code></p>

<p>A group lock is a m-of-n multi-sig output used to have more than one user own a resource. Combined with the <code>LocalOwner</code> and <code>TransactionAPI</code>, Run is able to sign group locks using its default <code>LocalOwner</code> in any order. See the example to the right.</p>

<p>A <code>Group</code> lock is as secure as bitcoins themselves. If some parties can update a jig, they can also destroy the jig.</p>

<p>It is available via <code>Run.extra.Group</code> and predeployed at the following locations:</p>

<table><thead>
<tr>
<th>Network</th>
<th>Location</th>
</tr>
</thead><tbody>
<tr>
<td>main</td>
<td>780ab8919cb89323707338070323c24ce42cdec2f57d749bd7aceef6635e7a4d_o1</td>
</tr>
<tr>
<td>test</td>
<td>63e0e1268d8ab021d1c578afb8eaa0828ccbba431ffffd9309d04b78ebeb6e56_o1</td>
</tr>
</tbody></table>
<h4 id='api-reference-extras-group-constructor-pubkeys-required'>constructor(pubkeys, required)</h4>
<p><code>constructor(pubkeys: Array&lt;string&gt;, required: number): Group</code></p>

<p>Creates a m-of-n <code>Group</code> for the set of public keys.</p>

<p>The maximum length of <code>pubkeys</code> is 16. If <code>required</code> is not specified, then it is the number of pubkeys.</p>
<h4 id='api-reference-extras-group-add-pubkey'>add(pubkey)</h4>
<p><code>add(pubkey: string)</code></p>

<p>Adds a pubkey to the pubkey list if it does not already exist.</p>
<h4 id='api-reference-extras-group-pubkeys-array'>pubkeys: Array<string></h4>
<p>Array of public keys that are partial owners. There can be no more than 16 and they must be hex strings.</p>
<h4 id='api-reference-extras-group-required-number'>required: number</h4>
<p>Number of signatures required to unlock the output. This is the m in m-of-n multi-sig.</p>
<h3 id='api-reference-extras-hex'>Hex</h3>
<p>It is available via <code>Run.extra.Hex</code> and predeployed at the following locations:</p>

<table><thead>
<tr>
<th>Network</th>
<th>Location</th>
</tr>
</thead><tbody>
<tr>
<td>main</td>
<td>727e7b423b7ee40c0b5be87fba7fa5673ea2d20a74259040a7295d9c32a90011_o1</td>
</tr>
<tr>
<td>test</td>
<td>1f0abf8d94477b1cb57629d861376616f6e1d7b78aba23a19da3e6169caf489e_o2</td>
</tr>
</tbody></table>
<h4 id='api-reference-extras-hex-static-stringtobytes'>static stringToBytes</h4>
<p><code>static bytesToString(b: Array&lt;number&gt;): string</code></p>

<p>Converts a array of bytes to a hex string. This method will throw if any entries in the array are not bytes.</p>

<p><code>static stringToBytes(s: string): Array&lt;number&gt;</code></p>

<p>Converts a hex string into an array of bytes. This method will throw if the string is not a a valid hex string.</p>
<h3 id='api-reference-extras-token'>Token</h3>
<p><code>class Token extends Jig { ... }</code></p>

<p><code>Token</code> is a standard base class for fungible tokens similar to ERC-20 or SLP. It may be used for shares, loyalty points, gift cards, and more. Each <code>Token</code> instance defines a numerical amount held by its owner. You extend from <code>Token</code> to define a new kind of token. As the owner of this new token <em>class</em>, only you can mint new token instances. The token instances you mint though may be sent, owned, traded, and combined together with others. Like bitcoins, they are permissionless and only require their owner&#39;s approval to use.</p>

<p><code>Token</code> supports integer amounts like ERC-20 in its <code>amount</code> field. In practice, you will often wish to display the token&#39;s amount with a decimal, like <code>1.50</code>. The <code>static decimals</code> property may be used to declare how many digits the amount is to be shifted when the amount is displayed. In the previous example, <code>amount</code> would be 150 and <code>decimals</code> would be 2.</p>

<p>It is available via <code>Run.extra.Token</code> and predeployed at the following locations:</p>

<table><thead>
<tr>
<th>Network</th>
<th>Location</th>
</tr>
</thead><tbody>
<tr>
<td>main</td>
<td>72a61eb990ffdb6b38e5f955e194fed5ff6b014f75ac6823539ce5613aea0be8_o1</td>
</tr>
<tr>
<td>test</td>
<td>7d14c868fe39439edffe6982b669e7b4d3eb2729eee7c262ec2494ee3e310e99_o1</td>
</tr>
</tbody></table>
<h4 id='api-reference-extras-token-static-mint-amount-to'>static mint(amount, to)</h4>
<blockquote>
<p>Minting a new token</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">MyCustomToken</span> <span class="kr">extends</span> <span class="nx">Token</span> <span class="p">{</span> <span class="p">}</span>

<span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">MyCustomToken</span><span class="p">.</span><span class="nx">mint</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</code></pre>
<p><code>mint(amount: number, to: ?(string|Lock)): Token</code></p>

<p><code>mint()</code> issues a new token with a specified amount. Only the owner of the extended token class is able to call this method. The newly minted token will be assigned to the <code>to</code> address if specified, or to to the token class&#39;s owner if not.</p>
<h4 id='api-reference-extras-token-send-to-amount'>send(to, amount)</h4><pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCustomToken</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">sent</span> <span class="o">=</span> <span class="nx">token</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sent</span><span class="p">.</span><span class="nx">amount</span><span class="p">)</span> <span class="c1">// 20</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">amount</span><span class="p">)</span> <span class="c1">// 80</span>
</code></pre>
<p><code>send(to: string|Lock, amount: ?number): Token</code></p>

<p>Sends amounts from this token to another user, creating a new Token in the process. The returned token will have the <code>amount</code> specified and the current token will have its <code>amount</code> decreased accordingly. When its <code>amount</code> becomes zero, the token is automatically destroyed. If <code>amount</code> is not specified, when the entire token amount is sent.</p>
<h4 id='api-reference-extras-token-combine-tokens'>combine(...tokens)</h4>
<blockquote>
<p>Combining three tokens newly minted</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">token1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCustomToken</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">token2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCustomToken</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">token3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCustomToken</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">combined</span> <span class="o">=</span> <span class="nx">token1</span><span class="p">.</span><span class="nx">combine</span><span class="p">(</span><span class="nx">token2</span><span class="p">,</span> <span class="nx">token3</span><span class="p">)</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">combine</span><span class="p">.</span><span class="nx">amount</span><span class="p">)</span> <span class="c1">// 60</span>
</code></pre>
<blockquote>
<p>Combining and sending tokens in a single transaction</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">tokens</span> <span class="o">=</span> <span class="nx">run</span><span class="p">.</span><span class="nx">inventory</span><span class="p">.</span><span class="nx">jigs</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">jig</span> <span class="o">=&gt;</span> <span class="nx">jig</span> <span class="k">instanceof</span> <span class="nx">MyCustomToken</span><span class="p">)</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">combined</span> <span class="o">=</span> <span class="nx">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">combine</span><span class="p">(...</span><span class="nx">tokens</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

  <span class="nx">combined</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">,</span> <span class="nx">amount</span><span class="p">)</span>
<span class="p">})</span>
</code></pre>
<p><code>combine(...tokens: Token): Token</code></p>

<p><code>combine</code> will merge the multiple tokens into a single token that has the combined amount. The tokens to combine must all be the same kind and the returned token object will be the same token that was called.</p>

<p>Tokens are like Bitcoin outputs. Every time you send some tokens, you split off an amount into a new output. Just like Bitcoins, you may later want to merge them back together. It is often useful to do this right before sending your tokens so that you can send their full amount. The example on the right shows how to combine and send tokens in a single transaction.</p>
<h4 id='api-reference-extras-token-amount'>amount</h4>
<p><code>amount: number</code></p>

<p>The integer value held within this token. The meaning of <code>amount</code> depends on the token.</p>
<h4 id='api-reference-extras-token-static-decimals'>static decimals</h4><pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">USDToken</span> <span class="kr">extends</span> <span class="nx">Token</span> <span class="p">{</span> <span class="p">}</span>

<span class="nx">USDToken</span><span class="p">.</span><span class="nx">decimals</span> <span class="o">=</span> <span class="mi">2</span>

<span class="kr">const</span> <span class="nx">dollars</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">USDToken</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>

<span class="kd">let</span> <span class="nx">displayAmount</span> <span class="o">=</span> <span class="nx">dollars</span><span class="p">.</span><span class="nx">amount</span>
<span class="k">while</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">USDToken</span><span class="p">.</span><span class="nx">decimals</span><span class="p">.</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">displayAmount</span> <span class="o">/=</span> <span class="mi">10</span>
<span class="p">}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">displayAmount</span><span class="p">)</span> <span class="c1">// 1.00</span>
</code></pre>
<p><code>static decimals: number</code></p>

<p>The number of decimal places to shift the <code>amount</code> when displaying it. <code>Token</code> uses integers by default for precision, just like ERC-20, but often times you will want to specify a decimals value to indicate a unit for display to the user. For example, a US Dollar coin might set decimals to 2 so that the base amount is cents but the display value is dollars.</p>
<h3 id='api-reference-extras-tx'>Tx</h3>
<blockquote>
<p>Load an OP_RETURN into a berry</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">OpReturn</span> <span class="kr">extends</span> <span class="nx">Berry</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="kr">static</span> <span class="nx">pluck</span><span class="p">(</span><span class="nx">txid</span><span class="p">,</span> <span class="nx">fetch</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">rawtx</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">txid</span><span class="p">)</span>
    <span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Tx</span><span class="p">(</span><span class="nx">rawtx</span><span class="p">)</span>
    <span class="kr">const</span> <span class="nx">script</span> <span class="o">=</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">script</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">script</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'6a'</span><span class="p">))</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">'No an OP_RETURN'</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">OpReturn</span><span class="p">(</span><span class="nx">tx</span><span class="p">.</span><span class="nx">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">script</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">init</span><span class="p">(</span><span class="nx">script</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">script</span> <span class="o">=</span> <span class="nx">script</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nx">OpReturn</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="na">Tx</span><span class="p">:</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">extra</span><span class="p">.</span><span class="nx">Tx</span> <span class="p">}</span>
</code></pre>
<p><code>class Tx { ... }</code></p>

<p>Parses a raw hex transactions into an object that can be inspected. This is often useful when creating berries from transactions.</p>

<p>It is available via <code>Run.extra.Tx</code> and predeployed at the following locations:</p>

<table><thead>
<tr>
<th>Network</th>
<th>Location</th>
</tr>
</thead><tbody>
<tr>
<td>main</td>
<td>312985bd960ae4c59856b3089b04017ede66506ea181333eec7c9bb88b11c490_o2</td>
</tr>
<tr>
<td>test</td>
<td>33e78fa7c43b6d7a60c271d783295fa180b7e9fce07d41ff1b52686936b3e6ae_o2</td>
</tr>
</tbody></table>
<h4 id='api-reference-extras-tx-constructor-rawtx'>constructor(rawtx)</h4>
<p><code>constructor(rawtx: string): Tx</code></p>

<p>Parses the raw transaction into a <code>Tx</code> object. The constructor will throw an error if <code>rawtx</code> is not a valid Bitcoin transaction.</p>
<h4 id='api-reference-extras-tx-inputs'>inputs</h4>
<p><code>inputs: Array&lt;{prevTxId: string, outputIndex: number, script: string, sequenceNumber: number}&gt;</code></p>

<p>Transaction inputs array.</p>
<h4 id='api-reference-extras-tx-outputs'>outputs</h4>
<p><code>outputs: Array&lt;{satoshis: number, script: string}</code></p>

<p>Transaction outputs array.</p>
<h4 id='api-reference-extras-tx-version'>version</h4>
<p><code>version: number</code></p>

<p>The version number of the transaction.</p>
<h4 id='api-reference-extras-tx-nlocktime'>nLockTime</h4>
<p><code>nLockTime: number</code></p>

<p>The lock time of the transaction.</p>
<h3 id='api-reference-extras-txo'>txo</h3>
<blockquote>
<p>Parse a Twetch transaction into a berry</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">txo</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">extra</span>

<span class="kr">class</span> <span class="nx">TwetchPost</span> <span class="kr">extends</span> <span class="nx">Berry</span> <span class="p">{</span>
  <span class="nx">init</span> <span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span>
  <span class="p">}</span>

  <span class="kr">static</span> <span class="nx">async</span> <span class="nx">pluck</span> <span class="p">(</span><span class="nx">txid</span><span class="p">,</span> <span class="nx">fetch</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">txo</span><span class="p">(</span><span class="nx">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="nx">txid</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s2</span> <span class="o">===</span> <span class="s1">'19HxigV4QyBv3tHpQVcUEQyq1pzZVdoAut'</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">TwetchPost</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s3</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">TwetchPost</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">txo</span> <span class="p">}</span>
</code></pre>
<p><code>function txo(rawtx: string): object</code></p>

<p>Parses a raw hex transaction into a <a href="https://github.com/interplanaria/txo">TXO</a> data structure. This is often an easy way to interpret a transaction for a Berry.</p>

<p>The following fields are supported:</p>

<ul>
<li>bN (base58)</li>
<li>hN (hex)</li>
<li>sN (utf8)</li>
<li>bN.op (opcode num)</li>
<li>e.h (txid)</li>
<li>e.i (output index)</li>
<li>e.v (satoshis)</li>
<li>seq</li>
<li>i</li>
</ul>

<p>It is available via <code>Run.extra.txo</code> and predeployed at the following locations:</p>

<table><thead>
<tr>
<th>Network</th>
<th>Location</th>
</tr>
</thead><tbody>
<tr>
<td>main</td>
<td>312985bd960ae4c59856b3089b04017ede66506ea181333eec7c9bb88b11c490_o1</td>
</tr>
<tr>
<td>test</td>
<td>33e78fa7c43b6d7a60c271d783295fa180b7e9fce07d41ff1b52686936b3e6ae_o1</td>
</tr>
</tbody></table>
<h2 id='api-reference-apis'>APIs</h2>
<blockquote>
<p>Check if a custom owner implementation will be accepted by Run</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">MyOwner</span> <span class="p">{</span> <span class="cm">/* implementation */</span> <span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nx">MyOwner</span><span class="p">()</span> <span class="k">instanceof</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">Owner</span><span class="p">)</span>
</code></pre>
<p>This section describes APIs that may be implemented by the developer to customize Run. Each API is available under <code>Run.api</code> and some commonly-used implementations of these APIs are provided via the built-in <a href="#api-reference-plugins">Plugins</a>. You may check that your implementation conforms to the interface by using <code>instanceof</code> on instances. You do not have to extend from the API classes for an implementation to be considered valid.</p>
<h3 id='api-reference-apis-blockchain'>Blockchain</h3>
<p><code>class Blockchain { ... }</code></p>

<p>The interface Run uses to communicate with the Bitcoin network. Run ships with several implementations: <a href="#api-reference-plugins-runconnect">RunConnect</a>, <a href="#api-reference-plugins-mattercloud">MatterCloud</a>, <a href="#api-reference-plugins-whatsonchain">WhatsOnChain</a>, and the <a href="#api-reference-plugins-mockchain">Mockchain</a>. Developers may implement <code>Blockchain</code> to connect to the Bitcoin network in custom ways.</p>
<h4 id='api-reference-apis-blockchain-network'>network</h4>
<p><code>network: string</code></p>

<p>A friendly network string. This is usually one of <code>main</code>, <code>test</code>, <code>stn</code>, or <code>mock</code>, however it may be any string. If the network starts with &#39;main&#39;, the Run library will use mainnet settings wherever it matters. For all other networks, Run will use testnet settings.</p>
<h4 id='api-reference-apis-blockchain-broadcast-rawtx'>broadcast(rawtx)</h4>
<blockquote>
<p>Create and broadcast a simple transaction</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">rawtx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">bsv</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">utxo</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">to</span><span class="p">(</span><span class="nx">address</span><span class="p">,</span> <span class="nx">amount</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="nx">privateKey</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">'hex'</span><span class="p">)</span>

<span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">(</span><span class="nx">rawtx</span><span class="p">)</span>
</code></pre>
<p><code>broadcast(rawtx: string): Promise&lt;string&gt;</code></p>

<p>Submits a raw transaction in hex format to the network. A promise is returned that must resolve with the transaction ID if the transaction was accepted. If the network did not accept the transaction, then the promise should be rejected with the error. This method should resolve successfully for broadcasts of transactions which are already in the mempool.</p>
<h4 id='api-reference-apis-blockchain-fetch-txid'>fetch(txid)</h4>
<blockquote>
<p>Downloads a transaction from the network</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">txid</span> <span class="o">=</span> <span class="s1">'afc557ef2970af0b5fb8bc1a70a320af425c7a45ca5d40eac78475109563c5f8'</span>

<span class="kr">const</span> <span class="nx">rawtx</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">txid</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">bsv</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">(</span><span class="nx">rawtx</span><span class="p">)</span>
</code></pre>
<p><code>fetch(txid: string): Promise&lt;string&gt;</code></p>

<p>Downloads a transaction from the network. A promise is returned that will resolve with the raw hex transaction or reject with the error if the transaction could not be retrieved.</p>
<h4 id='api-reference-apis-blockchain-utxos-script'>utxos(script)</h4>
<blockquote>
<p>Downloads the current UTXOs for a given address</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="nx">address</span> <span class="o">=</span> <span class="s1">'mpBU73vq9ajhkXknP1sNGe6wjXH7QtwmWm'</span>
<span class="kr">const</span> <span class="nx">script</span> <span class="o">=</span> <span class="nx">Script</span><span class="p">.</span><span class="nx">fromAddress</span><span class="p">(</span><span class="nx">address</span><span class="p">).</span><span class="nx">toHex</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">utxos</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">run</span><span class="p">.</span><span class="nx">blockchain</span><span class="p">.</span><span class="nx">utxos</span><span class="p">(</span><span class="nx">script</span><span class="p">)</span>
<span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">bsv</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">().</span><span class="nx">from</span><span class="p">(</span><span class="nx">utxos</span><span class="p">).</span><span class="nx">change</span><span class="p">(</span><span class="nx">address</span><span class="p">)</span>
</code></pre>
<p><code>utxos(script: string): Promise&lt;Array&lt;{txid: string, vout: number, script: string, satoshis: number}&gt;&gt;</code></p>

<p>Returns the unspent outputs for a given address. A promise is returned that will resolve with an array of UTXOs, which may be empty, or reject with an error. Each returned UTXO may be converted to a <code>bsv.Transaction.UnspentOutput</code>. The output script passed into <code>utxos</code> will be in hex format.</p>

<p>Usually, implementations will index UTXOs by the script&#39;s hash rather than the script itself. The <code>utxos</code> method takes a full script however to support partial compatibility for certain script patterns like P2PKH that often have dedicated query APIs. To calculate a script hash from a script using the bsv library, use the following: <code>sha256(new Script(script).toBuffer()).reverse().toString(&#39;hex&#39;)</code>.</p>
<h4 id='api-reference-apis-blockchain-time-txid'>time(txid)</h4>
<p><code>time(txid: string): Promise&lt;number&gt;</code></p>

<p>Returns the block time the transaction was confirmed, or the mempool acceptance time if not yet in a block, in milliseconds since the unix epoch.</p>
<h4 id='api-reference-apis-blockchain-spends-txid-vout'>spends(txid, vout)</h4>
<p><code>spends(txid: string, vout: number): Promise&lt;?string&gt;</code></p>

<p>Returns the ID of the transaction that spends the given output, or null if the output is unspent.</p>

<p>If the Blockchain API does not support <code>spends</code>, it may return a <code>Run.error.NotImplementedError</code>, however, Run will only partially work in this case.</p>
<h3 id='api-reference-apis-cache'>Cache</h3>
<blockquote>
<p>A cache implementation that stores data in the browser&#39;s local storage</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">LocalStorageCache</span> <span class="p">{</span>
  <span class="nx">async</span> <span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">async</span> <span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p><code>class Cache { ... }</code></p>

<p>The interface Run uses to cache jig state, transactions, and other data needed for fast use. The <code>Cache</code> API also enables third-party state servers to exist and provide the intermediate state of jigs. All values stored are immutable and JSON-serializable. They should not be modified or created by hand.</p>

<p>The following keys will be set by Run:</p>

<table><thead>
<tr>
<th>Key</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code>jig://&lt;location&gt;</code></td>
<td>Serialized state for jigs of any kind including objects, code, or berries</td>
</tr>
<tr>
<td><code>tx://&lt;txid&gt;</code></td>
<td>Raw transaction hex</td>
</tr>
<tr>
<td><code>time://&lt;txid&gt;</code></td>
<td>Transaction time in milliseconds since the unix epoch</td>
</tr>
<tr>
<td><code>spend://&lt;location&gt;</code></td>
<td>Transaction ID that spends the output</td>
</tr>
<tr>
<td><code>ban://&lt;location&gt;</code></td>
<td>Jig location that is known to be unloadable</td>
</tr>
</tbody></table>
<h4 id='api-reference-apis-cache-get-key'>get(key)</h4>
<p><code>get(key: string): Promise&lt;?object&gt;</code></p>

<p>Gets the value for a particular key. If this is an LRU cache, get() should also bump the key to the front.</p>

<p>Run will call this when loading jigs to see if it can short-circuit its loading. If a value exists and is valid state, Run will use it. This method is asyncronous to allow for third-party network calls.</p>
<h4 id='api-reference-apis-cache-set-key-value'>set(key, value)</h4>
<p><code>set(key: string, value: object): Promise&lt;void&gt;</code></p>

<p>Caches a value for a particular key.</p>

<p>Run will call this whenever a new transaction is published and also when a jig is loaded. This method is asyncronous to allow for third-party network calls.</p>
<h3 id='api-reference-apis-lock'>Lock</h3>
<blockquote>
<p>Send a token to a P2PK output script</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">asm</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">extra</span>

<span class="kr">class</span> <span class="nx">PayToPublicKeyLock</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">pubkey</span> <span class="o">=</span> <span class="nx">pubkey</span> <span class="p">}</span>
  <span class="nx">script</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">asm</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="k">this</span><span class="p">.</span><span class="nx">pubkey</span><span class="p">}</span><span class="s2"> OP_CHECKSIG`</span><span class="p">)</span> <span class="p">}</span>
  <span class="nx">domain</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">74</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nx">PayToPublicKeyLock</span><span class="p">.</span><span class="nx">deps</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">asm</span> <span class="p">}</span>

<span class="nx">token</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">PayToPublicKeyLock</span><span class="p">(</span><span class="nx">pubkey</span><span class="p">))</span>
</code></pre>
<p><code>class Lock { ... }</code></p>

<p>Locks are custom output scripts that may be assigned as owners to jigs. Every lock is an instance of a lock class that is deployed on-chain. The lock class&#39;s <code>script()</code> method defines how the output script is built from the lock instance&#39;s properties. Because the lock class is also deployed on-chain, jig code can use logic that relies on strongly typed owners. For example, perhaps a jig must be held by 3 people in a <a href="#api-reference-extras-group">Group</a> for it to be used.</p>
<h4 id='api-reference-apis-lock-script'>script()</h4>
<p><code>script(): string</code></p>

<p>Returns the output script for the current lock as a hex string.</p>

<p>Run will call this method when building your transactions. Run provides the <a href="#api-reference-extras-asm">asm</a> utility function to more easily build these scripts. For security reasons, this function should always rebuild the script when it&#39;s invoked and never cache the results.</p>
<h4 id='api-reference-apis-lock-domain'>domain()</h4>
<p><code>domain(): number</code></p>

<p>Returns the maximum size of this lock&#39;s unlocking script in bytes. Run uses this value to improve fee estimation for signatures exist by creating placeholders in unlocking scripts that are of size <code>domain()</code>.</p>

<p>Calculating the <code>domain</code> may depend on various properties of the lock. As a rule of thumb, Bitcoin signatures are at most 74 bytes in script, and public keys when compressed are 34 bytes in script. It is best to err on the conservative side.</p>
<h3 id='api-reference-apis-logger'>Logger</h3>
<blockquote>
<p>Write info, warn, and error messages to a file</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">FileLogger</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">stream</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createWriteStream</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="p">{</span> <span class="na">flags</span><span class="p">:</span> <span class="s1">'a'</span> <span class="p">})</span> <span class="p">}</span>

  <span class="nx">info</span><span class="p">(...</span><span class="nx">messages</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'INFO'</span><span class="p">,</span> <span class="p">...</span><span class="nx">messages</span><span class="p">)</span> <span class="p">}</span>
  <span class="nx">warn</span><span class="p">(...</span><span class="nx">messages</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'WARN'</span><span class="p">,</span> <span class="p">...</span><span class="nx">messages</span><span class="p">)</span> <span class="p">}</span>
  <span class="nx">error</span><span class="p">(...</span><span class="nx">messages</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'ERROR'</span><span class="p">,</span> <span class="p">...</span><span class="nx">messages</span><span class="p">)</span> <span class="p">}</span>

  <span class="nx">log</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="p">...</span><span class="nx">messages</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">stream</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">type</span><span class="p">}</span><span class="s2"> </span><span class="p">${</span><span class="nx">messages</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">' '</span><span class="p">)}</span><span class="s2"> \n`</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">logger</span><span class="p">:</span> <span class="k">new</span> <span class="nx">FileLogger</span><span class="p">(</span><span class="s1">'log.txt'</span><span class="p">)</span> <span class="p">})</span>
</code></pre>
<p><code>class Logger { ... }</code></p>

<p>A custom logger API that may be used to intercept Run logs and send them to a more appropriate place. By default, Run will log errors and warnings to the console, but you may wish to log them to a custom file, or enable the info and debug logs too. It is not necessary to implement all methods below; whichever methods are implemented, Run will call.</p>
<h4 id='api-reference-apis-logger-info-messages'>info(...messages)</h4>
<p><code>info(...messages)</code></p>

<p>Called when Run is performing a major action, such as loading a jig, or querying a REST API.</p>
<h4 id='api-reference-apis-logger-error-messages'>error(...messages)</h4>
<p><code>error(...messages)</code></p>

<p>Called when Run detects an error. These are recommended for production logs.</p>
<h4 id='api-reference-apis-logger-warn-messages'>warn(...messages)</h4>
<p><code>warn(...messages)</code></p>

<p>Called when Run detects a possible error. These are recommended for production logs.</p>
<h4 id='api-reference-apis-logger-debug-messages'>debug(...messages)</h4>
<p><code>debug(...messages)</code></p>

<p>Called when Run creates debug messages. These will be more far verbose than you would typically expect in production logs.</p>
<h3 id='api-reference-apis-owner'>Owner</h3>
<blockquote>
<p>An owner that runs on a REST server</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">RemoteWallet</span> <span class="p">{</span>
  <span class="nx">constructor</span><span class="p">(</span><span class="nx">host</span><span class="p">,</span> <span class="nx">address</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">host</span> <span class="o">=</span> <span class="nx">host</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">address</span> <span class="o">=</span> <span class="nx">address</span>
  <span class="p">}</span>

  <span class="nx">async</span> <span class="nx">nextOwner</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">address</span> <span class="p">}</span>

  <span class="nx">async</span> <span class="nx">sign</span><span class="p">(</span><span class="nx">tx</span><span class="p">,</span> <span class="nx">parents</span><span class="p">,</span> <span class="nx">locks</span><span class="p">)</span> <span class="p">{</span>
    <span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">method</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
        <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">'Content-Type'</span><span class="p">:</span> <span class="s1">'application/json'</span> <span class="p">},</span>
        <span class="na">body</span><span class="p">:</span> <span class="p">{</span> <span class="nx">tx</span><span class="p">,</span> <span class="nx">parents</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">const</span> <span class="nx">rawtx</span> <span class="o">=</span> <span class="nx">await</span> <span class="nx">fetch</span><span class="p">(</span><span class="s1">'/sign'</span><span class="p">,</span> <span class="nx">options</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">r</span> <span class="o">=&gt;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">json</span><span class="p">())</span>
    <span class="k">return</span> <span class="nx">rawtx</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<p><code>class Owner { ... }</code></p>

<p>An owner of jigs and other resources that is <code>run.owner</code>.</p>

<p>Run calls the <code>Owner API</code> to create new jigs and sign transactions for the user. It is different from the purse which is strictly for paying for transactions. This API supports both local and remote ownership via the <code>async</code> methods.</p>

<p>For a complete guide on implementing the <code>Owner API</code> for a third-party wallet, please reach out to @niv in the Atlantis slack.</p>
<h4 id='api-reference-apis-owner-nextowner'>nextOwner()</h4>
<p><code>nextOwner(): Promise&lt;string|Lock&gt;</code></p>

<p>The owner address, pubkey, or lock, used to assign to new jigs.</p>
<h4 id='api-reference-apis-owner-sign-rawtx-parents-locks'>sign(rawtx, parents, locks)</h4>
<blockquote>
<p>Sign all resources that are P2PK outputs</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">async</span> <span class="nx">sign</span><span class="p">(</span><span class="nx">rawtx</span><span class="p">,</span> <span class="nx">parents</span><span class="p">,</span> <span class="nx">locks</span><span class="p">)</span> <span class="p">{</span>
  <span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">bsv</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">(</span><span class="nx">rawtx</span><span class="p">)</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">inputs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">locks</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nx">PayToPublicKeyLock</span><span class="p">)</span> <span class="p">{</span>
      <span class="kr">const</span> <span class="nx">sig</span> <span class="o">=</span> <span class="nx">generateSignature</span><span class="p">(</span><span class="nx">tx</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">parents</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="k">this</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">)</span>

      <span class="nx">tx</span><span class="p">.</span><span class="nx">inputs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">setScript</span><span class="p">(</span><span class="nx">sig</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">'hex'</span><span class="p">))</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">'hex'</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<p><code>sign(rawtx: string, parents: Array&lt;?{satoshis: number, script: string}&gt;, locks: Array&lt;?Lock&gt;): Promise&lt;string&gt;</code></p>

<p>Signs the transaction for the current jig owner.</p>

<p>The parents array is the same size as the transaction&#39;s inputs and contains a list of the parent outputs that are inputs in this transaction. This information may be needed to generate sighash values.</p>

<p>The third parameter, <code>locks</code>, are the jig owners for each jig input. This is a higher-level representation of the parent output scripts that allows the <code>sign</code> method to more easily determine which inputs to sign. If an input is not a jig, then its value in the array will be undefined. If the jig&#39;s owner is an address or public key, then the lock will be a <a href="#api-reference-util-commonlock">CommonLock</a>.</p>
<h3 id='api-reference-apis-purse'>Purse</h3>
<p><code>class Purse { ... }</code></p>

<p>An interface to pay for transactions that is the purse in Run. Run&#39;s default <code>Purse</code> implementation is <a href="#api-reference-plugins-localpurse">LocalPurse</a></p>

<p>For a complete guide on implementing the <code>Purse API</code> for a third-party wallet, please reach out to @niv in the Atlantis slack.</p>
<h4 id='api-reference-apis-purse-pay-rawtx-parents'>pay(rawtx, parents)</h4>
<blockquote>
<p>Pay for a transaction using specific UTXOs</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">PayWithUtxos</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="p">(</span><span class="nx">utxos</span><span class="p">,</span> <span class="nx">privateKey</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">utxos</span> <span class="o">=</span> <span class="nx">utxos</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">privateKey</span> <span class="o">=</span> <span class="nx">privateKey</span>
    <span class="p">}</span>

    <span class="nx">async</span> <span class="nx">pay</span><span class="p">(</span><span class="nx">rawtx</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">const</span> <span class="nx">tx</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">bsv</span><span class="p">.</span><span class="nx">Transaction</span><span class="p">(</span><span class="nx">rawtx</span><span class="p">)</span>
        <span class="nx">tx</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">utxos</span><span class="p">)</span>
        <span class="nx">tx</span><span class="p">.</span><span class="nx">change</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">.</span><span class="nx">toAddress</span><span class="p">())</span>
        <span class="nx">tx</span><span class="p">.</span><span class="nx">sign</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">privateKey</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">tx</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s1">'hex'</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kr">const</span> <span class="nx">run</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Run</span><span class="p">({</span> <span class="na">purse</span><span class="p">:</span> <span class="k">new</span> <span class="nx">PayWithUtxos</span><span class="p">(</span><span class="nx">utxos</span><span class="p">,</span> <span class="nx">privateKey</span><span class="p">)</span> <span class="p">})</span>
</code></pre>
<p><code>pay(rawtx: string, parents: Array&lt;{satoshis: number, script: string}&gt;): Promise&lt;string&gt;</code></p>

<p>Pays for a transaction so that it is acceptable to miners.</p>

<p>The transaction is passed in raw hex format. Raw transaction do not have information about their parent outputs, so the second parameter is a parents array that is a 1-1 mapping with the inputs of the transaction. This method should return a paid transaction in raw hex format.</p>

<p>To pay for a transaction, the method should add inputs and outputs so that its fee is raised high enough to be accepted by miners, and then the purse should sign the inputs it adds. As of May 2020, an appropriate miner fee is 0.5 satoshis per byte. The transaction passed will include placeholder signatures for any jig inputs to help with fee estimation.</p>

<p>This method should not assume that all inputs and outputs are dust because there may be <a href="#jigs-backing">backed jigs</a> that were updated or created. A third-party implementation can check that there are no backed jigs by looking for any non-dust inputs or outputs. Otherwise, the purse should be prepared to pay more than the miner fee to back jigs and receive change from unbacked jigs. </p>

<p><code>pay()</code> is an asynchronous call that returns a promise. If an error is thrown, then the state of all jigs in the transaction will be reverted and the transaction will not be broadcasted. It is up to the purse to add retry logic if needed.</p>
<h4 id='api-reference-apis-purse-broadcast-rawtx'>broadcast(rawtx)</h4>
<p><code>broadcast(rawtx: string): Promise&lt;&gt;</code></p>

<p>A notification for purses when a transaction they paid for is being broadcast.</p>

<p>This method is optional for purses. It is designed for wallets to update their UTXOs. Wallets may also choose to broadcast the transaction themselves but if they do they should expect that the sometimes transaction might already be received by the network.</p>
<h2 id='api-reference-util'>Util</h2>
<p>This section describes various helper functionality made available via <code>Run.util</code>.</p>
<h3 id='api-reference-util-commonlock'>CommonLock</h3>
<blockquote>
<p>Send a token to a P2PKH address</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">token</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">new</span> <span class="nx">CommonLock</span><span class="p">(</span><span class="nx">address</span><span class="p">))</span>
</code></pre>
<p><code>class CommonLock implements Lock { ... }</code></p>

<p>The <code>CommonLock</code> generates a standard P2PKH output script for an address. It is created internally and automatically by Run whenever an address or public key is set as a jig owner. <code>CommonLock</code> instances are also passed into the <code>locks</code> array in the <a href="#api-reference-apis-owner">Owner API</a>&#39;s <code>sign</code> method, and they may be created and used on their own as seen on the right. <code>CommonLock</code> may be accessed via <code>Run.util.CommonLock</code>.</p>
<h4 id='api-reference-util-commonlock-constructor-address-testnet'>constructor(address, testnet)</h4>
<p><code>constructor(address: string, testnet: ?boolean): CommonLock</code></p>

<p>Creates a <code>CommonLock</code> for a specific address.</p>
<h4 id='api-reference-util-commonlock-address'>address</h4>
<p><code>address: string</code></p>

<p>The address string for this lock.</p>
<h4 id='api-reference-util-commonlock-testnet'>testnet</h4>
<p><code>testnet: ?boolean</code></p>

<p>Whether this address is intended for testnet (<code>true</code>), mainnet (<code>false</code>), or an unspecified network (<code>undefined</code>).</p>
<h3 id='api-reference-util-install-t'>install(T)</h3>
<blockquote>
<p>Preinstall a class with presets to share it in a library</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">class</span> <span class="nx">Token</span> <span class="kr">extends</span> <span class="nx">Jig</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>

<span class="nx">Token</span><span class="p">.</span><span class="nx">presets</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">main</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">location</span><span class="p">:</span> <span class="s1">'b17a9af70ab0f46809f908b2e900e395ba40996000bf4f00e3b27a1e93280cf1_o1'</span><span class="p">,</span>
    <span class="na">origin</span><span class="p">:</span> <span class="s1">'b17a9af70ab0f46809f908b2e900e395ba40996000bf4f00e3b27a1e93280cf1_o1'</span><span class="p">,</span>
    <span class="na">nonce</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="na">owner</span><span class="p">:</span> <span class="s1">'1PytriYokKN3GpKw84L4vvrGBwUvTYzCpx'</span><span class="p">,</span>
    <span class="na">satoshis</span><span class="p">:</span> <span class="mi">0</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">install</span><span class="p">(</span><span class="nx">Token</span><span class="p">)</span>
</code></pre>
<p><code>install (T: function): Code</code></p>

<p>Installs a class or function as <a href="#api-reference-code">Code</a> but does not deploy it nor require a Run instance to be created. If the resulting code is synced or referenced by another creation, it will automatically be deployed in the next transaction. This method is sometimes useful for providing sandboxed code to third-parties without requiring a Run instance to be created. For example, the built-in <a href="#api-reference-extras">extras</a> that ship with Run are pre-installed code.</p>
<h3 id='api-reference-util-metadata-rawtx'>metadata(rawtx)</h3>
<blockquote>
<p>Print out the Run metadata</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="nx">Run</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">metadata</span><span class="p">(</span><span class="nx">rawtx</span><span class="p">)</span>

<span class="p">{</span>
  <span class="s2">"app"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
  <span class="s2">"version"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
  <span class="s2">"in"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">"ref"</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">"native://Jig"</span>
  <span class="p">],</span>
  <span class="s2">"out"</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">"e494cd3d0c33615620c22f44cddf85f2bf613fd608dbfc53822664581205d198"</span><span class="p">,</span>
      <span class="s2">"9a99596f417e8925cb25f2acf99abe28f014aaad47ce93c427ee3afd3bcc5084"</span>
  <span class="p">],</span>
  <span class="s2">"del"</span><span class="p">:</span> <span class="p">[],</span>
  <span class="s2">"cre"</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">"mhhHzeLjRTD4cjuygJFjqmCHCFpDKGrp75"</span><span class="p">,</span>
      <span class="s2">"mhhHzeLjRTD4cjuygJFjqmCHCFpDKGrp75"</span>
  <span class="p">],</span>
  <span class="s2">"exec"</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">"op"</span><span class="p">:</span> <span class="s2">"DEPLOY"</span><span class="p">,</span>
        <span class="s2">"data"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"class A extends Jig { }"</span><span class="p">,</span> <span class="p">{</span> <span class="s2">"deps"</span><span class="p">:</span> <span class="p">{</span> <span class="s2">"Jig"</span><span class="p">:</span> <span class="p">{</span> <span class="s2">"$jig"</span><span class="p">:</span> <span class="mi">0</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}]</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">"op"</span><span class="p">:</span> <span class="s2">"NEW"</span><span class="p">,</span>
        <span class="s2">"data"</span><span class="p">:</span> <span class="p">[{</span> <span class="s2">"$jig"</span><span class="p">:</span> <span class="mi">1</span> <span class="p">},</span> <span class="p">[]]</span>
      <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre>
<p><code>metadata(rawtx: string): object</code></p>

<p>Extracts all Layer-2 metadata from a Run transaction. The <code>metadata</code> function will throw an error if not passed a valid Run transaction in hex format. This method may be useful for debugging purposes and to determine whether a transaction is a Run transaction. The metadata returned is not intended to be executed outside Run. This metadata is stored in the first output using <code>OP_RETURN</code>. For more about this data structure, see <a href="#how-it-works">How It Works</a>. The <code>metadata</code> function may be accessed via <code>Run.util.metadata</code>.</p>
<h3 id='api-reference-util-unify-creations'>unify(...creations)</h3>
<blockquote>
<p>Unify references so that two classes can be deployed together</p>
</blockquote>
<pre class="highlight javascript tab-javascript"><code><span class="kr">const</span> <span class="p">{</span> <span class="nx">unify</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">Run</span><span class="p">.</span><span class="nx">util</span>

<span class="nx">unify</span><span class="p">(</span><span class="nx">Axe</span><span class="p">,</span> <span class="nx">Sword</span><span class="p">)</span>

<span class="nx">run</span><span class="p">.</span><span class="nx">transaction</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">Axe</span><span class="p">)</span>
  <span class="nx">run</span><span class="p">.</span><span class="nx">deploy</span><span class="p">(</span><span class="nx">Sword</span><span class="p">)</span>
<span class="p">})</span>
</code></pre>
<p><code>unify(...creations: Array&lt;Creation&gt;)</code></p>

<p>Synchronizes all creations so that they refer to the same objects in the same state. Run&#39;s protocol requires that creations are unified within a single transaction. This is usually performed automatically by Run before each method is executed. However, it may be useful to unify manually when using a <a href="#api-reference-transaction">Transaction</a> when creations are used across multiple actions and cannot be automatically unified.</p>
<h1 id='tools'>Tools</h1><h2 id='tools-explorer'>Explorer</h2>
<p>Run ships with an explorer that you may use to view jigs and code. It is an excellent way to test that your objects are working. To give it a go, open <code>getting_started.html</code> and click <strong>Explorer</strong>. Then, paste any location or address into the search box.</p>
<h2 id='tools-deploy'>Deploy</h2>
<blockquote>
<p>Generate keys and deploy code to testnet</p>
</blockquote>
<pre class="highlight plaintext"><code>&gt; ./deploy --test lib/dragon.js 

No purse keys found. Generate new keys? (y/n) y

    Success!

    Your private keys are in this .env file. Please keep it safe.

    /home/yolanda/myproject/.env

Now send some funds to your testnet address

    mims9NN2AEdEQ8ULcTPdgU8TdE34oojky9

    ▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄▄
    █ ▄▄▄▄▄ █▄▀ ▀  ██▄▀▀█ █ ▄▄▄▄▄ █
    █ █   █ █   █▀  ▀▀█▄ ▀█ █   █ █
    █ █▄▄▄█ █▄█▀ ▄▄ ▄██▀  █ █▄▄▄█ █
    █▄▄▄▄▄▄▄█▄█ █ █▄▀▄▀▄█ █▄▄▄▄▄▄▄█
    █▄▄  █▀▄█ █ ▄ ▀▄██▄ ▄ ▄▀█ ▄▄▀ █
    █ ▄ █▄▀▄▄█  ▄▄ ▄█▄█▀▀▀▀ █▄▄█▄▀█
    █▄  ▄█▀▄ █ ▄▀   ▄▀▀▀████▄█▀▄▀▀█
    ██▄▀ █ ▄▄▀ ▀ ██▀▀ █ ▄▀ ▀ █▀▄▄▄█
    █▄▄█▀██▄▀▄▄▀█▄▄▀▀█▄ █ ▄▀ ▄▀▀█▄█
    █▄█▀▀  ▄█ ▄█▀███▄▀▀▄█▄█    ▀█▀█
    ██▄█▄██▄▄▀▄███▀▀▀▀▄ ▄ ▄▄▄   ▀ █
    █ ▄▄▄▄▄ ██▀▀▀▀▀ █▀▄▄█ █▄█ ▀█▄██
    █ █   █ █▀█▄ █▀▀▀▄ █▀ ▄▄  ▄▄▄ █
    █ █▄▄▄█ █   █ ▀▄▀▀▄▄▄█ █ ▀ ▄▀▄█
    █▄▄▄▄▄▄▄█▄▄█▄████▄▄▄▄▄█▄█▄██▄██


    Waiting for funds to be sent...

    Success! Received 3000000 satoshis

Deploying code to test

Dragon.presets.test.location = 'd9f9b15d73298bb807c3b22f62cb1f0b096d2a1c13678a9d29836a6fb538f901_o6'
Dragon.presets.test.origin = 'd9f9b15d73298bb807c3b22f62cb1f0b096d2a1c13678a9d29836a6fb538f901_o6'
Dragon.presets.test.nonce = 1
Dragon.presets.test.owner = 'mjs1rSdsm6tGAKdm79cUQ4rYXY1kvho34v'
Dragon.presets.test.satoshis = 0

Success! Presets saved.
</code></pre>
<p>Deploying your jig classes ahead of time is a great best practice. It allows code to be re-used across jigs, and jigs to safely rely on types. For example, an event may only accept tickets that are instances of a <code>SpecificTicket</code> class. Pre-deployed classes make this possible, and save blockchain space and fees too! 🌎</p>

<p>Deploying code yourself is possible, but to help, Run ships with a <code>deploy</code> tool. <code>deploy</code> is a command-line program to deploy your jig classes and update their presets. It can be found as <code>dist/deploy</code> and it is a self-contained app.</p>

<p>To use <code>deploy</code>, you&#39;ll specify:</p>

<ul>
<li><strong>files</strong> - which files you wish to deploy (ex. <code>my-jigs/**</code>)</li>
<li><strong>network</strong> - which networks to deploy to (ex. <code>main</code>)</li>
<li><strong>purse</strong> - which purses to use (ex. <code>&lt;private key&gt;</code>)</li>
</ul>

<p><code>deploy</code> will find which classes to deploy based on your module&#39;s exports, deploy them to each blockchain, print out your new presets, and then update your source code to save <a href="#advanced-usage-code-presets">the presets</a>. </p>

<p>To setup your purse keys, it is recommended that you create a <code>.env</code> file to persist them. If you run <code>deploy</code> without a purse, it&#39;ll prompt you to create a new <code>.env</code> file and fund your new keys, as seen to the right. You can also pass a pre-existing purse on the command line. For example: <code>deploy --purse=&lt;my key&gt; --main my-jigs.js</code>.</p>

<p>For more details, see <code>deploy --help</code>.</p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>

  <!-- Twemoji provides the emoji asset in one of the examples -->
  <script src="https://twemoji.maxcdn.com/2/twemoji.min.js?12.0.4" crossorigin="anonymous"></script>

  <script>
    twemoji.parse(document.body)
  </script>

</html>
